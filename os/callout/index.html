<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="http://mynewt.incubator.apache.org/os/callout/">
        <link rel="shortcut icon" href="../../img/favicon.ico">

	<title>Callout Functions - Apache Mynewt</title>

        <link href="../../css/bootstrap-3.0.3.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/base.css" rel="stylesheet">
        <link href="../../css/custom.css" rel="stylesheet">
        <link href='https://fonts.googleapis.com/css?family=Roboto:400,500,700,900,300,100' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
        <link href="../../extra.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
            <script>
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-72162311-1', 'mynewt.incubator.apache.org');
                ga('send', 'pageview');
            </script>
        
    </head>


    <body class="Callout Functions">


        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="logo-container">
        <img src="/img/logo.svg">
    </div>
    <div class="container-fluid">
        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                <li>
                    <a href="/documentation/">Docs</a>
                </li>
                <li>
                    <a href="/download/">Download</a>
                </li>
                <li>
                    <a href="/community/">Community</a>
                </li>
                <li>
                    <a href="/events/">Events</a>
                </li>
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
            </ul>
        </div>
    </div>
</div>

        <div class="container-fluid">
            
                <div class="row sm-extra-padding">
                    <div class="col-md-3 bg-grey sidebar-container"><div class="bs-sidebar hidden-print" role="complementary">
    <div class="sidebar-top">
        <img class="hidden-xs hidden-sm logo-small" src="/img/logo.svg" alt="MyNewt" title="MyNewt">
        <div class="small" role="search">
            <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
                <div class="form-group">
                    <input type="text" name="q" placeholder="Search documentation" />
                    <button class="search-button" type="submit"><i class="fa fa-search"></i></button>
                </div>
            </form>
        </div>
    </div>
    <ul class="nav bs-sidenav">
      
        
      
        
      
        
      
        
      
        
      
        
          
  
  <li><a href="
  ../../get_started/newt_concepts/
">Chapter 1 - Get Started</a>
    
  </li>

        
      
        
          
  
  <li><a href="
  ../../get_acclimated/vocabulary/
">Chapter 2 - Get Acclimated</a>
    
  </li>

        
      
        
          
  
  <li><a href="
  ../../newt/newt_ops/
">Chapter 3 - Newt Tool</a>
    
  </li>

        
      
        
          
  
  <li><a href="
  ../mynewt_os/
">Chapter 4 - Mynewt OS</a>
    
      <ul class="current-toc">
          
              
  
    <li>
      <a href="../mynewt_os/">Overview</a>
    </li>
  

          
              
  
    <li>
      <a href="../context_switch/">Scheduler/Context Switching</a>
    </li>
  

          
              
  
    <li>
      <a href="../time/">Time</a>
    </li>
  

          
              
  
    <li>
      <a href="../task/">Tasks</a>
    </li>
  

          
              
  
    <li>
      <a href="../event_queue/">Event Queues</a>
    </li>
  

          
              
  
    <li>
      <a href="../semaphore/">Semaphores</a>
    </li>
  

          
              
  
    <li>
      <a href="../mutex/">Mutexes</a>
    </li>
  

          
              
  
    <li>
      <a href="../memory_pool/">Memory Pools</a>
    </li>
  

          
              
  
    <li>
      <a href="../heap/">Heap</a>
    </li>
  

          
              
  
    <li>
      <a href="../mbufs/">Mbufs</a>
    </li>
  

          
              
  
    <li>
      <a href="../sanity/">Sanity</a>
    </li>
  

          
              
  
    <li class="active">
      Callout Functions
    </li>
  

          
              
  
    <li>
      <a href="../port_os/">Porting to other Platforms</a>
    </li>
  

          
      </ul>
    
  </li>

        
      
        
          
  
  <li><a href="
  
  
  ../../modules/console/console/

">Chapter 5 - Modules</a>
    
  </li>

        
      
        
          
  
  <li><a href="
  ../../newtmgr/overview/
">Chapter 6 - Newt Manager</a>
    
  </li>

        
      
        
          
  
  <li><a href="
  ../../packaging/dist/
">Chapter 7 - Packaging it</a>
    
  </li>

        
      
    </ul>
</div></div>
                    
                    <div class="show-sidebar-container">
                        <button class="show-sidebar">Docs Menu</button>
                    </div>
                    
                    <div class="col-md-9 documentation-viewer" role="main">
                        <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Chapter 4 - Mynewt OS &raquo;</li>
        
      
    
    <li>Callout Functions</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
                        
                            <h1 id="callout">Callout<a class="headerlink" href="#callout" title="Permanent link">&para;</a></h1>
<p>Callouts are MyNewt OS timers.</p>
<h2 id="description">Description<a class="headerlink" href="#description" title="Permanent link">&para;</a></h2>
<p>Callout is a way of setting up an OS timer. When the timer fires, it is delivered as an event to task's event queue.</p>
<p>User would initialize their callout structure using <em>os_callout_init()</em>, or <em>os_callout_func_init()</em> and then arm it with <em>os_callout_reset()</em>.</p>
<p>If user wants to cancel the timer before it expires, they can either use <em>os_callout_reset()</em> to arm it for later expiry, or stop it altogether by calling <em>os_callout_stop()</em>.</p>
<p>There are 2 different options for data structure to use. First is <em>struct os_callout</em>, which is a bare-bones version. You would initialize this with <em>os_callout_init()</em>.</p>
<p>Second option is <em>struct os_callout_func</em>. This you can use if you expect to have multiple different types of timers in your task, running concurrently. The structure contains a function pointer, and you would call that function from your task's event processing loop.</p>
<p>Time unit when arming the timer is OS ticks. This rate of this ticker depends on the platform this is running on. You should use OS define <em>OS_TICKS_PER_SEC</em> to convert wallclock time to OS  ticks.</p>
<p>Callout timer fires out just once. For periodic timer type of operation you need to rearm it once it fires.</p>
<h2 id="data-structures">Data structures<a class="headerlink" href="#data-structures" title="Permanent link">&para;</a></h2>
<pre><code class="no-highlight">struct os_callout {
    struct os_event c_ev;
    struct os_eventq *c_evq;
    uint32_t c_ticks;
    TAILQ_ENTRY(os_callout) c_next;
};
</code></pre>

<table>
<thead>
<tr>
<th>Element</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>c_ev</td>
<td>Event structure of this callout</td>
</tr>
<tr>
<td>c_evq</td>
<td>Event queue where this callout is placed on timer expiry</td>
</tr>
<tr>
<td>c_ticks</td>
<td>OS tick amount when timer fires</td>
</tr>
<tr>
<td>c_next</td>
<td>Linkage to other unexpired callouts</td>
</tr>
</tbody>
</table>
<pre><code class="no-highlight">struct os_callout_func {
    struct os_callout cf_c;
    os_callout_func_t cf_func;
    void *cf_arg;
};
</code></pre>

<table>
<thead>
<tr>
<th>Element</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>cf_c</td>
<td>struct os_callout. See above</td>
</tr>
<tr>
<td>cf_func</td>
<td>Function pointer which should be called by event queue processing</td>
</tr>
<tr>
<td>cf_arg</td>
<td>Generic void * argument to that function</td>
</tr>
</tbody>
</table>
<h2 id="list-of-functions">List of Functions<a class="headerlink" href="#list-of-functions" title="Permanent link">&para;</a></h2>
<p>The functions available in this OS feature are:</p>
<ul>
<li><a href="#os_callout_init">os_callout_init</a></li>
<li><a href="#os_callout_func_init">os_callout_func_init</a></li>
<li><a href="#os_callout_stop">os_callout_stop</a></li>
<li><a href="#os_callout_reset">os_callout_reset</a></li>
<li><a href="#os_callout_queued">os_callout_queued</a></li>
</ul>
<h2 id="function-reference">Function Reference<a class="headerlink" href="#function-reference" title="Permanent link">&para;</a></h2>
<hr />
<h2 id="os_callout_init"><font color="#F2853F" style="font-size:24pt">os_callout_init </font><a class="headerlink" href="#os_callout_init" title="Permanent link">&para;</a></h2>
<pre><code class="no-highlight">void os_callout_init(struct os_callout *c, struct os_eventq *evq, void *ev_arg)
</code></pre>

<p>Initializes <em>struct os_callout</em>. Event type will be set to <em>OS_EVENT_T_TIMER</em>.</p>
<h4 id="arguments">Arguments<a class="headerlink" href="#arguments" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Arguments</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>c</td>
<td>Pointer to os_callout to initialize</td>
</tr>
<tr>
<td>evq</td>
<td>Event queue where this gets delivered to</td>
</tr>
<tr>
<td>ev_arg</td>
<td>Generic argument which is filled in for the event</td>
</tr>
</tbody>
</table>
<h4 id="returned-values">Returned values<a class="headerlink" href="#returned-values" title="Permanent link">&para;</a></h4>
<p>N/A</p>
<h4 id="notes">Notes<a class="headerlink" href="#notes" title="Permanent link">&para;</a></h4>
<p>Be careful not to call this if the callout is armed, because that will mess up the list of pending callouts.
Or if the timer has already fired, it will mess up the event queue where the callout was delivered to.</p>
<h4 id="example">Example<a class="headerlink" href="#example" title="Permanent link">&para;</a></h4>
<p><Add text to set up the context for the example here></p>
<pre><code class="no-highlight">struct os_eventq my_evq;
struct os_callout my_callouts[8];

    for (i = 0; i &lt; 8; i++) {
        os_callout_init(&amp;my_callouts[i], &amp;my_evq, (void *)i);
    }
</code></pre>

<hr />
<h2 id="os_callout_func_init"><font color="#F2853F" style="font-size:24pt"> os_callout_func_init </font><a class="headerlink" href="#os_callout_func_init" title="Permanent link">&para;</a></h2>
<pre><code class="no-highlight">void os_callout_func_init(struct os_callout_func *cf, struct os_eventq *evq, os_callout_func_t timo_func, void *ev_arg)
</code></pre>

<p>Initializes the given <em>struct os_callout_func</em>. Data structure is filled in with elements given as argument.</p>
<h4 id="arguments_1">Arguments<a class="headerlink" href="#arguments_1" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Arguments</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>cf</td>
<td>Pointer to os_callout_func being initialized</td>
</tr>
<tr>
<td>evq</td>
<td>Event queue where this gets delivered to</td>
</tr>
<tr>
<td>timo_func</td>
<td>Timeout function. Event processing should call this</td>
</tr>
<tr>
<td>ev_arg</td>
<td>Generic argument for the event</td>
</tr>
</tbody>
</table>
<h4 id="returned-values_1">Returned values<a class="headerlink" href="#returned-values_1" title="Permanent link">&para;</a></h4>
<p>N/A</p>
<h4 id="notes_1">Notes<a class="headerlink" href="#notes_1" title="Permanent link">&para;</a></h4>
<p>The same notes as with <em>os_callout_init()</em>.</p>
<h4 id="example_1">Example<a class="headerlink" href="#example_1" title="Permanent link">&para;</a></h4>
<p><Add text to set up the context for the example here></p>
<pre><code class="no-highlight">struct os_callout_func g_native_cputimer;
struct os_eventq g_native_cputime_evq;
void native_cputimer_cb(void *arg);

    /* Initialize the callout function */
    os_callout_func_init(&amp;g_native_cputimer,
                         &amp;g_native_cputime_evq,
                         native_cputimer_cb,
                         NULL);

</code></pre>

<hr />
<h2 id="os_callout_stop"><font color="#F2853F" style="font-size:24pt"> os_callout_stop </font><a class="headerlink" href="#os_callout_stop" title="Permanent link">&para;</a></h2>
<pre><code class="no-highlight">void os_callout_stop(struct os_callout *c)
</code></pre>

<p>Disarms a timer.</p>
<h4 id="arguments_2">Arguments<a class="headerlink" href="#arguments_2" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Arguments</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>c</td>
<td>Pointer to os_callout being stopped</td>
</tr>
</tbody>
</table>
<h4 id="returned-values_2">Returned values<a class="headerlink" href="#returned-values_2" title="Permanent link">&para;</a></h4>
<p>N/A</p>
<h4 id="notes_2">Notes<a class="headerlink" href="#notes_2" title="Permanent link">&para;</a></h4>
<h4 id="example_2">Example<a class="headerlink" href="#example_2" title="Permanent link">&para;</a></h4>
<p><Add text to set up the context for the example here></p>
<pre><code class="no-highlight">struct os_callout_func g_native_cputimer;

     os_callout_stop(&amp;g_native_cputimer.cf_c);
</code></pre>

<hr />
<h2 id="os_callout_reset"><font color="#F2853F" style="font-size:24pt"> os_callout_reset </font><a class="headerlink" href="#os_callout_reset" title="Permanent link">&para;</a></h2>
<pre><code class="no-highlight">void os_callout_reset(struct os_callout *c, int32_t timo)
</code></pre>

<p>Resets the callout to happen <em>timo</em> in OS ticks.</p>
<h4 id="arguments_3">Arguments<a class="headerlink" href="#arguments_3" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Arguments</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>c</td>
<td>Pointer to os_callout being reset</td>
</tr>
<tr>
<td>timo</td>
<td>OS ticks the timer is being set to</td>
</tr>
</tbody>
</table>
<h4 id="returned-values_3">Returned values<a class="headerlink" href="#returned-values_3" title="Permanent link">&para;</a></h4>
<p>N/A</p>
<h4 id="notes_3">Notes<a class="headerlink" href="#notes_3" title="Permanent link">&para;</a></h4>
<h4 id="example_3">Example<a class="headerlink" href="#example_3" title="Permanent link">&para;</a></h4>
<p><Add text to set up the context for the example here></p>
<pre><code class="no-highlight">    /* Re-start the timer (run every 50 msecs) */
    os_callout_reset(&amp;g_bletest_timer.cf_c, OS_TICKS_PER_SEC / 20);
</code></pre>

<hr />
<h2 id="os_callout_queued"><font color="#F2853F" style="font-size:24pt">os_callout_queued</font><a class="headerlink" href="#os_callout_queued" title="Permanent link">&para;</a></h2>
<pre><code class="no-highlight">int os_callout_queued(struct os_callout *c)
</code></pre>

<p>Tells whether the callout has been armed or not.</p>
<h4 id="arguments_4">Arguments<a class="headerlink" href="#arguments_4" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Arguments</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>c</td>
<td>Pointer to callout being checked</td>
</tr>
</tbody>
</table>
<h4 id="returned-values_4">Returned values<a class="headerlink" href="#returned-values_4" title="Permanent link">&para;</a></h4>
<p>0: timer is not armed
non-zero: timer is armed</p>
<h4 id="notes_4">Notes<a class="headerlink" href="#notes_4" title="Permanent link">&para;</a></h4>
<h4 id="example_4">Example<a class="headerlink" href="#example_4" title="Permanent link">&para;</a></h4>
<p><Add text to set up the context for the example here></p>
<pre><code class="no-highlight">&lt;Insert the code snippet here&gt;
</code></pre>

<hr />
                        
                    </div>
                </div>
            
            <div class="row">    
                <footer>
    <div class="row">
        <div class="col-md-12">
            
                <p class="copyright">Copyright &copy; 2015 The Apache Software Foundation, Licensed under the Apache License, Version 2.0 Apache and the Apache feather logo are trademarks of The Apache Software Foundation.<br>The Apache Software Foundation Apache Incubator</p>
            
        </div>
    </div>
    <div class="copyright-logos">
        <div class="row">
            <div class="col-xs-6 text-right">
                <img src="/img/apache-feather.png" alt="Apache" title="Apache">
            </div>
            <div class="col-xs-6 text-left">
                <img src="/img/apache-logo.png" alt="Apache Incubator" title="Apache Incubator">
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <small class="footnote">
                MyNewt is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.
            </small>
        </div>
    </div>
</footer>
            </div>
        </div>

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script src="../../js/base.js"></script>
        <script src="../../js/custom.js"></script>

    </body>
</html>