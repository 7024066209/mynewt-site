<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="http://127.0.0.1:8000/os/core_os/semaphore/semaphore/">
        <link rel="shortcut icon" href="../../../../img/favicon.ico">

	<title>semaphore overview - Apache Mynewt</title>

        <link href="../../../../css/bootstrap-3.0.3.min.css" rel="stylesheet">
        <link href="../../../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../../../css/highlight.css">
        <link href="../../../../css/base.css" rel="stylesheet">
        <link href="../../../../css/custom.css" rel="stylesheet">
        <link href='https://fonts.googleapis.com/css?family=Roboto:400,500,700,900,300,100' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
        <link href="../../../../extra.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
            <script>
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-72162311-1', 'mynewt.incubator.apache.org');
                ga('send', 'pageview');
            </script>
        
    </head>


    <body class="semaphore overview">


        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="logo-container">
        <img src="/img/logo.svg">
    </div>
    <div class="container-fluid">
        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                <li>
                    <a href="/documentation/">Docs</a>
                </li>
                <li>
                    <a href="/download/">Download</a>
                </li>
                <li>
                    <a href="/community/">Community</a>
                </li>
                <li>
                    <a href="/events/">Events</a>
                </li>
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
            </ul>
        </div>
    </div>
</div>

        <div class="container-fluid">
            
                <div class="row sm-extra-padding">
                    <div class="col-md-3 bg-grey sidebar-container"><div class="bs-sidebar hidden-print" role="complementary">
    <div class="sidebar-top">
        <img class="hidden-xs hidden-sm logo-small" src="/img/logo.svg" alt="MyNewt" title="MyNewt">
        <div class="small" role="search">
            <form id ="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
                <div class="form-group">
                    <input type="text" name="q" placeholder="Search documentation" />
                    <button class="search-button" type="submit"><i class="fa fa-search"></i></button>
                </div>
            </form>
        </div>
    </div>
    <ul class="nav bs-sidenav">
      
        
      
        
      
        
      
        
      
        
      
        
          
  
  <li><a href="
  
  
  ../../../get_started/newt_concepts/

">Manual for Mynewt OS</a>
    
      <ul class="current-toc">
          
              
  
  <li><a href="
  ../../../get_started/newt_concepts/
">Get Started</a>
    
  </li>

          
              
  
  <li><a href="
  ../../../get_acclimated/project2/
">More Projects</a>
    
  </li>

          
              
  
  <li><a href="
  
  
  ../../mynewt_os/

">Mynewt OS</a>
    
      <ul class="current-toc">
          
              
  
  <li><a href="
  ../../mynewt_os/
">OS Fundamentals</a>
    
  </li>

          
              
  
  <li><a href="
  ../../context_switch/context_switch/
">Scheduler/Context Switching</a>
    
  </li>

          
              
  
  <li><a href="
  ../../time/time/
">Time</a>
    
  </li>

          
              
  
  <li><a href="
  ../../task/task/
">Tasks</a>
    
  </li>

          
              
  
  <li><a href="
  ../../event_queue/event_queue/
">Event Queues</a>
    
  </li>

          
              
  
  <li><a href="
  ./
">Semaphores</a>
    
      <ul class="current-toc">
          
              
  
    <li class="active">
      semaphore overview
    </li>
  

          
              
  
    <li>
      <a href="../os_sem_delete/">os_sem_delete</a>
    </li>
  

          
              
  
    <li>
      <a href="../os_sem_init/">os_sem_init</a>
    </li>
  

          
              
  
    <li>
      <a href="../os_sem_pend/">os_sem_pend</a>
    </li>
  

          
              
  
    <li>
      <a href="../os_sem_release/">os_sem_release</a>
    </li>
  

          
      </ul>
    
  </li>

          
              
  
  <li><a href="
  ../../mutex/mutex/
">Mutexes</a>
    
  </li>

          
              
  
  <li><a href="
  ../../memory_pool/memory_pool/
">Memory Pools</a>
    
  </li>

          
              
  
  <li><a href="
  ../../heap/heap/
">Heap</a>
    
  </li>

          
              
  
  <li><a href="
  ../../mbuf/mbuf/
">Mbufs</a>
    
  </li>

          
              
  
  <li><a href="
  ../../sanity/sanity/
">Sanity</a>
    
  </li>

          
              
  
  <li><a href="
  ../../callout/callout/
">Callout Functions</a>
    
  </li>

          
              
  
    <li>
      <a href="../../port_os/">Porting to other Platforms</a>
    </li>
  

          
      </ul>
    
  </li>

          
              
  
  <li><a href="
  
  
  ../../../modules/console/console/

">Modules</a>
    
  </li>

          
      </ul>
    
  </li>

        
      
        
          
  
  <li><a href="
  
  
  ../../../../newt/newt_ops/

">Manual for Newt Tool</a>
    
  </li>

        
      
        
          
  
  <li><a href="
  ../../../../newtmgr/overview/
">Manual for Newt Manager</a>
    
  </li>

        
      
    </ul>
</div></div>
                    
                    <div class="show-sidebar-container">
                        <button class="show-sidebar">Docs Menu</button>
                    </div>
                    
                    <div class="col-md-9 documentation-viewer" role="main">
                        <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../..">Docs</a> &raquo;</li>
    
      
        
          <li>Mynewt OS &raquo;</li>
        
      
        
          <li>Semaphores &raquo;</li>
        
      
    
    <li>semaphore overview</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
                        
                            <h1 id="semaphore">Semaphore<a class="headerlink" href="#semaphore" title="Permanent link">&para;</a></h1>
<p>A semaphore is a structure used for gaining exclusive access (much like a mutex), synchronizing task operations and/or use in a "producer/consumer" roles. Semaphores like the ones used by the myNewt OS are called "counting" semaphores as they are allowed to have more than one token (explained below).</p>
<h2 id="description">Description<a class="headerlink" href="#description" title="Permanent link">&para;</a></h2>
<p>A semaphore is a fairly simple construct consisting of a queue for waiting tasks and the number of tokens currently owned by the semaphore. A semaphore can be obtained as long as there are tokens in the semaphore. Any task can add tokens to the semaphore and any task can request the semaphore, thereby removing tokens. When creating the semaphore, the initial number of tokens can be set as well.</p>
<p>When used for exclusive access to a shared resource the semaphore only needs a single token. In this case, a single task "creates" the semaphore by calling <em>os_sem_init</em> with a value of one (1) for the token. When a task desires exclusive access to the shared resource it requests the semaphore by calling <em>os_sem_pend</em>. If there is a token the requesting task will acquire the semaphore and continue operation. If no tokens are available the task will be put to sleep until there is a token. A common "problem" with using a semaphore for exclusive access is called <em>priority inversion</em>. Consider the following scenario: a high and low priority task both share a resource which is locked using a semaphore. If the low priority task obtains the semaphore and then the high priority task requests the semaphore, the high priority task is now blocked until the low priority task releases the semaphore. Now suppose that there are tasks between the low priority task and the high priority task that want to run. These tasks will preempt the low priority task which owns the semaphore. Thus, the high priority task is blocked waiting for the low priority task to finish using the semaphore but the low priority task cannot run since other tasks are running. Thus, the high priority tasks is "inverted" in priority; in effect running at a much lower priority as normally it would preempt the other (lower priority) tasks. If this is an issue a mutex should be used instead of a semaphore.</p>
<p>Semaphores can also be used for task synchronization. A simple example of this would be the following. A task creates a semaphore and initializes it with no tokens. The task then waits on the semaphore, and since there are no tokens, the task is put to sleep. When other tasks want to wake up the sleeping task they simply add a token by calling <em>os_sem_release</em>. This will cause the sleeping task to wake up (instantly if no other higher priority tasks want to run).</p>
<p>The other common use of a counting semaphore is in what is commonly called a "producer/consumer" relationship. The producer adds tokens (by calling <em>os_sem_release</em>) and the consumer consumes them by calling <em>os_sem_pend</em>. In this relationship, the producer has work for the consumer to do. Each token added to the semaphore will cause the consumer to do whatever work is required. A simple example could be the following: every time a button is pressed there is some work to do (ring a bell). Each button press causes the producer to add a token. Each token consumed rings the bell. There will exactly the same number of bell rings as there are button presses. In other words, each call to <em>os_sem_pend</em> subtracts exactly one token and each call to <em>os_sem_release</em> adds exactly one token.</p>
<h2 id="data-structures">Data structures<a class="headerlink" href="#data-structures" title="Permanent link">&para;</a></h2>
<pre><code class="no-highlight">struct os_sem
{
    SLIST_HEAD(, os_task) sem_head;     /* chain of waiting tasks */
    uint16_t    _pad;
    uint16_t    sem_tokens;             /* # of tokens */
};
</code></pre>

<table>
<thead>
<tr>
<th>Element</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>sem_head</td>
<td>Queue head for list of tasks waiting on semaphore</td>
</tr>
<tr>
<td>_pad</td>
<td>Padding for alignment</td>
</tr>
<tr>
<td>sem_tokens</td>
<td>Current number of tokens</td>
</tr>
</tbody>
</table>
<h2 id="list-of-functions">List of Functions<a class="headerlink" href="#list-of-functions" title="Permanent link">&para;</a></h2>
<p>The functions available in semaphore are:</p>
<ul>
<li><a href="../os_sem_delete">os_sem_delete</a></li>
<li><a href="../os_sem_init">os_sem_init</a></li>
<li><a href="../os_sem_pend">os_sem_pend</a></li>
<li><a href="../os_sem_release">os_sem_release</a></li>
</ul>
                        
                    </div>
                </div>
            
            <div class="row">    
                <footer>
    <div class="row">
        <div class="col-md-12">
            
                <p class="copyright">Copyright &copy; 2015 The Apache Software Foundation, Licensed under the Apache License, Version 2.0 Apache and the Apache feather logo are trademarks of The Apache Software Foundation.<br>The Apache Software Foundation Apache Incubator</p>
            
        </div>
    </div>
    <div class="copyright-logos">
        <div class="row">
            <div class="col-xs-6 text-right">
                <img src="/img/apache-feather.png" alt="Apache" title="Apache">
            </div>
            <div class="col-xs-6 text-left">
                <img src="/img/apache-logo.png" alt="Apache Incubator" title="Apache Incubator">
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <small class="footnote">
                MyNewt is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.
            </small>
        </div>
    </div>
</footer>
            </div>
        </div>

        <script src="../../../../js/jquery-1.10.2.min.js"></script>
        <script src="../../../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../../../js/highlight.pack.js"></script>
        <script src="../../../../js/base.js"></script>
        <script src="../../../../js/custom.js"></script>

    </body>
</html>