<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="http://mynewt.apache.org/os/core_os/mutex/mutex/">
        <link rel="shortcut icon" href="../../../../img/favicon.ico">

	<title>Overview - Apache Mynewt</title>

        <link href="../../../../css/bootstrap-3.0.3.min.css" rel="stylesheet">
        <link href="../../../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../../../css/highlight.css">
        <link href="../../../../css/base.css" rel="stylesheet">
        <link href="../../../../css/custom.css" rel="stylesheet">
        <link href='https://fonts.googleapis.com/css?family=Roboto:400,500,700,900,300,100' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
        <link href="../../../../extra.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
            <script>
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-72162311-1', 'mynewt.incubator.apache.org');
                ga('send', 'pageview');
            </script>
        
    </head>


    <body class="Overview">


        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="logo-container">
        <img src="/img/logo.svg">
    </div>
    <div class="container-fluid">
        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                <li>
                    <a href="/documentation/">Docs</a>
                </li>
                <li>
                    <a href="/download/">Download</a>
                </li>
                <li>
                    <a href="/community/">Community</a>
                </li>
                <li>
                    <a href="/events/">Events</a>
                </li>
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
            </ul>
        </div>
    </div>
</div>

        <div class="container-fluid">
            
                <div class="row sm-extra-padding">
                    <div class="col-md-3 bg-grey sidebar-container"><div class="bs-sidebar hidden-print" role="complementary">
    <div class="sidebar-top">
        <img class="hidden-xs hidden-sm logo-small" src="/img/logo.svg" alt="MyNewt" title="MyNewt">
        <div class="small" role="search">
            <form id ="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
                <div class="form-group">
                    <input type="text" name="q" placeholder="Search documentation" />
                    <button class="search-button" type="submit"><i class="fa fa-search"></i></button>
                </div>
            </form>
        </div>
    </div>
    <ul class="nav bs-sidenav">
      
        
      
        
      
        
      
        
      
        
      
        
          
  
  <li><a href="
  ../../../get_started/introduction/
">Apache Mynewt Manual</a>
    
      <ul class="current-toc">
          
              
  
    <li>
      <a href="../../../get_started/introduction/">Introduction</a>
    </li>
  

          
              
  
  <li><a href="
  ../../../get_started/project1/
">Get Started</a>
    
  </li>

          
              
  
  <li><a href="
  ../../../tutorials/STM32F303/
">Tutorials</a>
    
  </li>

          
              
  
  <li><a href="
  
  
  
  
  ../../mynewt_os/


">OS User Guide</a>
    
      <ul class="current-toc">
          
              
  
  <li><a href="
  
  
  ../../mynewt_os/

">OS Core</a>
    
      <ul class="current-toc">
          
              
  
  <li><a href="
  ../../mynewt_os/
">OS Fundamentals</a>
    
  </li>

          
              
  
  <li><a href="
  ../../context_switch/context_switch/
">Scheduler</a>
    
  </li>

          
              
  
  <li><a href="
  ../../time/os_time/
">Time</a>
    
  </li>

          
              
  
  <li><a href="
  ../../task/task/
">Tasks</a>
    
  </li>

          
              
  
  <li><a href="
  ../../event_queue/event_queue/
">Event Queues</a>
    
  </li>

          
              
  
  <li><a href="
  ../../semaphore/semaphore/
">Semaphores</a>
    
  </li>

          
              
  
  <li><a href="
  ./
">Mutexes</a>
    
      <ul class="current-toc">
          
              
  
    <li class="active">
      Overview
    </li>
  

          
              
  
  <li><a href="
  ../os_mutex_delete/
">Functions</a>
    
  </li>

          
      </ul>
    
  </li>

          
              
  
  <li><a href="
  ../../memory_pool/memory_pool/
">Memory Pools</a>
    
  </li>

          
              
  
  <li><a href="
  ../../heap/heap/
">Heap</a>
    
  </li>

          
              
  
  <li><a href="
  
  
  ../../mbuf/mbuf/

">Memory Buffers</a>
    
  </li>

          
              
  
  <li><a href="
  ../../sanity/sanity/
">Sanity</a>
    
  </li>

          
              
  
  <li><a href="
  ../../callout/callout/
">Callouts</a>
    
  </li>

          
              
  
    <li>
      <a href="../../port_os/">Porting to other Platforms</a>
    </li>
  

          
      </ul>
    
  </li>

          
              
  
  <li><a href="
  ../../../modules/console/console/
">Console</a>
    
  </li>

          
              
  
  <li><a href="
  ../../../modules/shell/shell/
">Shell</a>
    
  </li>

          
              
  
  <li><a href="
  ../../../modules/bootloader/bootloader/
">Bootloader</a>
    
  </li>

          
              
  
    <li>
      <a href="../../../modules/filesystem/">File System Abstraction</a>
    </li>
  

          
              
  
    <li>
      <a href="../../../modules/nffs/">Newtron Flash File System</a>
    </li>
  

          
              
  
  <li><a href="
  ../../../modules/hal/hal/
">Hardware Abstraction Layer</a>
    
  </li>

          
              
  
  <li><a href="
  ../../../modules/testutil/testutil/
">Test Utilities</a>
    
  </li>

          
              
  
  <li><a href="
  ../../../modules/imgmgr/imgmgr/
">Image Manager</a>
    
  </li>

          
              
  
    <li>
      <a href="../../../modules/baselibc/">Baselibc library</a>
    </li>
  

          
              
  
  <li><a href="
  ../../../modules/elua/elua/
">Embedded Lua</a>
    
  </li>

          
              
  
  <li><a href="
  ../../../modules/json/json/
">JSON</a>
    
  </li>

          
      </ul>
    
  </li>

          
              
  
  <li><a href="
  
  
  ../../../../network/ble/ble_intro/

">Networking User Guide</a>
    
  </li>

          
      </ul>
    
  </li>

        
      
        
          
  
  <li><a href="
  ../../../../newt/newt_intro/
">Newt Tool Manual</a>
    
  </li>

        
      
        
          
  
  <li><a href="
  ../../../../newtmgr/overview/
">Newt Manager Manual</a>
    
  </li>

        
      
    </ul>
</div></div>
                    
                    <div class="show-sidebar-container">
                        <button class="show-sidebar">Docs Menu</button>
                    </div>
                    
                    <div class="col-md-9 documentation-viewer" role="main">
                        <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../..">Docs</a> &raquo;</li>
    
      
        
          <li>OS Core &raquo;</li>
        
      
        
          <li>Mutexes &raquo;</li>
        
      
    
    <li>Overview</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
                        
                            <h1 id="mutex">Mutex<a class="headerlink" href="#mutex" title="Permanent link">&para;</a></h1>
<p>Mutex is short for "mutual exclusion"; a mutex provides mutually exclusive access to a shared resource. A mutex provides <em>priority inheritance</em> in order to prevent <em>priority inversion</em>. Priority inversion occurs when a higher priority task is waiting on a resource owned by a lower priority task. Using a mutex, the lower priority task will inherit the highest priority of any task waiting on the mutex. </p>
<h2 id="description">Description<a class="headerlink" href="#description" title="Permanent link">&para;</a></h2>
<p>The first order of business when using a mutex is to declare the mutex globally. The mutex needs to be initialized before it is used (see the examples). It is generally a good idea to initialize the mutex before tasks start running in order to avoid a task possibly using the mutex before it is initialized.</p>
<p>When a task wants exclusive access to a shared resource it needs to obtain the mutex by calling <em>os_mutex_pend</em>. If the mutex is currently owned by a different task (a lower priority task), the requesting task will be put to sleep and the owners priority will be elevated to the priority of the requesting task. Note that multiple tasks can request ownership and the current owner is elevated to the highest priority of any task waitin on the mutex. When the task is done using the shared resource, it needs to release the mutex by called <em>os_mutex_release</em>. There needs to be one release per call to pend. Note that nested calls to <em>os_mutex_pend</em> are allowed but there needs to be one release per pend.</p>
<p>The following example will illustrate how priority inheritance works. In this example, the task number is the same as its priority. Remember that the lower the number, the higher the priority (i.e. priority 0 is higher priority than priority 1). Suppose that task 5 gets ownership of a mutex but is preempted by task 4. Task 4 attempts to gain ownership of the mutex but cannot as it is owned by task 5. Task 4 is put to sleep and task 5 is temporarily raised to priority 4. Before task 5 can release the mutex, task 3 runs and attempts to acquire the mutex. At this point, both task 3 and task 4 are waiting on the mutex (sleeping). Task 5 now runs at priority 3 (the highest priority of all the tasks waiting on the mutex). When task 5 finally releases the mutex it will be preempted as two higher priority tasks are waiting for it. </p>
<p>Note that when multiple tasks are waiting on a mutex owned by another task, once the mutex is released the highest priority task waiting on the mutex is run. </p>
<h2 id="data-structures">Data structures<a class="headerlink" href="#data-structures" title="Permanent link">&para;</a></h2>
<pre><code class="no-highlight">struct os_mutex
{
    SLIST_HEAD(, os_task) mu_head;
    uint8_t     _pad;
    uint8_t     mu_prio;
    uint16_t    mu_level;
    struct os_task *mu_owner;
};
</code></pre>

<table>
<thead>
<tr>
<th>Element</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>mu_head</td>
<td>Queue head for list of tasks waiting on mutex</td>
</tr>
<tr>
<td>_pad</td>
<td>Padding</td>
</tr>
<tr>
<td>mu_prio</td>
<td>Default priority of owner of mutex. Used to reset priority of task when mutex released</td>
</tr>
<tr>
<td>mu_level</td>
<td>Call nesting level (for nested calls)</td>
</tr>
<tr>
<td>mu_owner</td>
<td>Pointer to task structure which owns mutex</td>
</tr>
</tbody>
</table>
<h2 id="list-of-functions">List of Functions<a class="headerlink" href="#list-of-functions" title="Permanent link">&para;</a></h2>
<p><List all the functions here. Note how the anchors work. You put the text you want to show up as a link within [] and the relevant #heading within (). Note that the words of the heading need to be connected with a dash for the anchor to work. Hence the word "function" and the function name is connected with a dash, not underscore! And the header has to have at least 2 words for the anchor to work - that's how it is.></p>
<p>The functions available in this OS feature are:</p>
<ul>
<li><a href="../os_mutex_delete">os_mutex_delete</a></li>
<li><a href="../os_mutex_init">os_mutex_init</a></li>
<li><a href="../os_mutex_pend">os_mutex_pend</a></li>
<li><a href="../os_mutex_release">os_mutex_release</a></li>
</ul>
                        
                    </div>
                </div>
            
            <div class="row">    
                <footer>
    <div class="row">
        <div class="col-md-12">
            
                <p class="copyright">Copyright &copy; 2015 The Apache Software Foundation, Licensed under the Apache License, Version 2.0 Apache and the Apache feather logo are trademarks of The Apache Software Foundation.<br>The Apache Software Foundation Apache Incubator</p>
            
        </div>
    </div>
    <div class="copyright-logos">
        <div class="row">
            <div class="col-xs-6 text-right">
                <img src="/img/apache-feather.png" alt="Apache" title="Apache">
            </div>
            <div class="col-xs-6 text-left">
                <img src="/img/apache-logo.png" alt="Apache Incubator" title="Apache Incubator">
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <small class="footnote">
                MyNewt is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.
            </small>
        </div>
    </div>
</footer>
            </div>
        </div>

        <script src="../../../../js/jquery-1.10.2.min.js"></script>
        <script src="../../../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../../../js/highlight.pack.js"></script>
        <script src="../../../../js/base.js"></script>
        <script src="../../../../js/custom.js"></script>

    </body>
</html>