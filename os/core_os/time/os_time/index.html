<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="http://mynewt.apache.org/os/core_os/time/os_time/">
        <link rel="shortcut icon" href="../../../../img/favicon.ico">

	<title>toc - Apache Mynewt</title>

        <link href="../../../../css/bootstrap-3.0.3.min.css" rel="stylesheet">
        <link href="../../../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../../../css/highlight.css">
        <link href="../../../../css/base.css" rel="stylesheet">
        <link href="../../../../css/custom.css" rel="stylesheet">
        <link href='https://fonts.googleapis.com/css?family=Roboto:400,500,700,900,300,100' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
        <link href="../../../../extra.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
            <script>
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-72162311-1', 'mynewt.incubator.apache.org');
                ga('send', 'pageview');
            </script>
        
    </head>


    <body class="toc">


        <div id="navbar" class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="logo-container">
        <img src="/img/logo.svg">
    </div>
    <div class="container-fluid">
        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                <li>
                    <a href="/about/">About</a>
                </li>
                <li class="dropdown">
                    <a href="/documentation/" class="dropdown-toggle" data-toggle="dropdown">Docs <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        
                        
                        
                        
                        <li >
                            <a href="../../../../documentation/">
                                Overview
                            </a>
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <li class="active">
                            <a href="../../../get_started/introduction/">
                                Mynewt OS Manual
                            </a>
                        </li>
                        
                        
                        
                        <li >
                            <a href="../../../../newt/newt_intro/">
                                Newt Tool Manual
                            </a>
                        </li>
                        
                        
                        
                        <li >
                            <a href="../../../../newtmgr/overview/">
                                Newt Manager Manual
                            </a>
                        </li>
                        
                        
                        
                        <li >
                            <a href="../../../../faq/answers/">
                                Appendix
                            </a>
                        </li>
                        
                        
                    </ul>
                </li>
                <li>
                    <a href="/download/">Download</a>
                </li>
                <li>
                    <a href="/community/">Community</a>
                </li>
                <li>
                    <a href="/events/">Events</a>
                </li>
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
            </ul>
        </div>
    </div>
</div>

        

        <div class="container-fluid">
            
                <div class="row sm-extra-padding">
                    <div id="docSidebar" class="col-md-3 bg-grey sidebar-container"><div class="bs-sidebar hidden-print" role="complementary">
    <div class="sidebar-top">
        <img class="hidden-xs hidden-sm logo-small" src="/img/logo.svg" alt="MyNewt" title="MyNewt">
        <div class="small" role="search">
            <form id ="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
                <div class="form-group">
                    <input type="text" name="q" placeholder="Search documentation" />
                    <button class="search-button" type="submit"><i class="fa fa-search"></i></button>
                </div>
            </form>
        </div>
    </div>
    <ul class="nav bs-sidenav">
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          
  
  
    <li><a href="
  ../../../get_started/introduction/
">Mynewt OS Manual</a>
  
    
      <ul class="current-toc">
          
              
                
  
    <li>
      <a href="../../../get_started/introduction/">Introduction</a>
    </li>
  

              
          
              
                
  
  
    <li ><a href="../../../get_started/get_started/">Get Started</a></li>
  
    
  </li>

              
          
              
                
  
  
    <li ><a href="../../../get_started/vocabulary/">Concepts</a></li>
  
    
  </li>

              
          
              
                
  
  
    <li ><a href="../../../tutorials/tutorials/">Tutorials</a></li>
  
    
  </li>

              
          
              
                
  
  
    <li><a href="
  
  
  ../../mynewt_os/

">OS User Guide</a>
  
    
      <ul class="current-toc">
          
              
                
  
  
    <li ><a href="../../mynewt_os/">OS Core</a></li>
  
    
      <ul class="current-toc">
          
              
          
              
                
  
  
    <li><a href="
  ../../os_init/
">System-level Functions</a>
  
    
  </li>

              
          
              
                
  
  
    <li ><a href="../../context_switch/context_switch/">Scheduler</a></li>
  
    
  </li>

              
          
              
                
  
  
    <li class="active"><a href="./">Time</a></li>
  
    
      <ul class="current-toc">
          
              
          
              
                
  
  
    <li><a href="
  ../os_time_delay/
">Functions</a>
  
    
  </li>

              
          
      </ul>
    
  </li>

              
          
              
                
  
  
    <li ><a href="../../task/task/">Tasks</a></li>
  
    
  </li>

              
          
              
                
  
  
    <li ><a href="../../event_queue/event_queue/">Event Queues</a></li>
  
    
  </li>

              
          
              
                
  
  
    <li ><a href="../../semaphore/semaphore/">Semaphores</a></li>
  
    
  </li>

              
          
              
                
  
  
    <li ><a href="../../mutex/mutex/">Mutexes</a></li>
  
    
  </li>

              
          
              
                
  
  
    <li ><a href="../../memory_pool/memory_pool/">Memory Pools</a></li>
  
    
  </li>

              
          
              
                
  
  
    <li ><a href="../../heap/heap/">Heap</a></li>
  
    
  </li>

              
          
              
                
  
  
    <li><a href="
  
  
  ../../mbuf/mbuf/

">Memory Buffers</a>
  
    
  </li>

              
          
              
                
  
  
    <li ><a href="../../sanity/sanity/">Sanity</a></li>
  
    
  </li>

              
          
              
                
  
  
    <li ><a href="../../callout/callout/">Callouts</a></li>
  
    
  </li>

              
          
      </ul>
    
  </li>

              
          
              
                
  
  
    <li ><a href="../../porting/port_os/">Porting to your Platform</a></li>
  
    
  </li>

              
          
              
                
  
  
    <li ><a href="../../../modules/console/console/">Console</a></li>
  
    
  </li>

              
          
              
                
  
  
    <li ><a href="../../../modules/shell/shell/">Shell</a></li>
  
    
  </li>

              
          
              
                
  
  
    <li ><a href="../../../modules/bootloader/bootloader/">Bootloader</a></li>
  
    
  </li>

              
          
              
                
  
  
    <li><a href="
  
  
  ../../../modules/fs/fs/fs/

">File System</a>
  
    
  </li>

              
          
              
                
  
  
    <li ><a href="../../../modules/hal/hal/">Hardware Abstraction Layer</a></li>
  
    
  </li>

              
          
              
                
  
  
    <li ><a href="../../../modules/testutil/testutil/">Test Utilities</a></li>
  
    
  </li>

              
          
              
                
  
  
    <li ><a href="../../../modules/imgmgr/imgmgr/">Image Manager</a></li>
  
    
  </li>

              
          
              
                
  
    <li>
      <a href="../../../modules/baselibc/">Baselibc library</a>
    </li>
  

              
          
              
                
  
  
    <li ><a href="../../../modules/elua/elua/">Embedded Lua</a></li>
  
    
  </li>

              
          
              
                
  
  
    <li ><a href="../../../modules/json/json/">JSON</a></li>
  
    
  </li>

              
          
      </ul>
    
  </li>

              
          
              
                
  
  
    <li><a href="
  
  
  ../../../../network/ble/ble_intro/

">Networking User Guide</a>
  
    
  </li>

              
          
      </ul>
    
  </li>

        
      
        
          
  
  
    <li><a href="
  ../../../../newt/newt_intro/
">Newt Tool Manual</a>
  
    
  </li>

        
      
        
          
  
  
    <li><a href="
  ../../../../newtmgr/overview/
">Newt Manager Manual</a>
  
    
  </li>

        
      
        
          
  
  
    <li><a href="
  ../../../../faq/answers/
">Appendix</a>
  
    
  </li>

        
      
    </ul>
</div></div>

                    <div class="show-sidebar-container">
                        <button class="show-sidebar">Docs Menu</button>
                    </div>

                    <div class="col-md-offset-3 col-md-9 documentation-viewer" role="main">
                        <div class="row doc-header">
                            <div class="col-sm-6">
                                
<ul class="nav nav-pills">
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li class="active" role="presentation"><a href="../../../get_started/introduction/">Mynewt OS</a></li>
    
    
    
    <li  role="presentation"><a href="../../../../newt/newt_intro/">Newt Tool</a></li>
    
    
    
    <li  role="presentation"><a href="../../../../newtmgr/overview/">Newt Mgr</a></li>
    
    
    
    
</ul>
                            </div>
                            <div class="col-sm-6">
                                <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="/documentation/">Docs</a></li>
    
    
        
          <li>&raquo; <a href="../../mynewt_os/">OS Core</a></li>
        
      
        
          <li>&raquo; Time</li>
        
      
      
    
    
  </ul>
</div>
                            </div>
                        </div>
                        
                            <h1 id="os_time">OS_Time<a class="headerlink" href="#os_time" title="Permanent link">&para;</a></h1>
<p>The system time for the Mynewt OS.</p>
<h2 id="description">Description<a class="headerlink" href="#description" title="Permanent link">&para;</a></h2>
<p>The Mynewt OS contains an incrementing time that drives the OS scheduler and time delays. The time is a fixed size (e.g. 32 bits) and will eventually wrap back to zero. The time to wrap from zero back to zero is called the <strong>OS time epoch</strong>. </p>
<p>The frequency of the OS time tick is specified in the architecture-specific OS code <code>os_arch.h</code> and is named <code>OS_TICKS_PER_SEC</code>.</p>
<p>The Mynewt OS also provides APIs for setting and retrieving the wallclock time (also known as local time or time-of-day in other operating systems).</p>
<h2 id="data-structures">Data Structures<a class="headerlink" href="#data-structures" title="Permanent link">&para;</a></h2>
<p>Time is stored in Mynewt as an <code>os_time_t</code> value. </p>
<p>Wallclock time is represented using the <code>struct os_timeval</code> and <code>struct os_timezone</code> tuple.</p>
<p><code>struct os_timeval</code> represents the number of seconds elapsed since 00:00:00 Jan 1, 1970 UTC.
<pre>
struct os_timeval {
    int64_t tv_sec;  /<em> seconds since Jan 1 1970 UTC </em>/
    int32_t tv_usec; /<em> fractional seconds </em>/
};</p>
<p>struct os_timeval tv = { 1457400000, 0 };  /<em> 01:20:00 Mar 8 2016 UTC </em>/
</pre></p>
<p><code>struct os_timezone</code> is used to specify the offset of local time from UTC and whether daylight savings is in effect. Note that <code>tz_minuteswest</code> is a positive number if the local time is <em>behind</em> UTC and a negative number if the local time is <em>ahead</em> of UTC.
<pre>
struct os_timezone {
    int16_t tz_minuteswest;
    int16_t tz_dsttime;
};</p>
<p>/<em> Pacific Standard Time is 08:00 hours west of UTC </em>/
struct os_timezone PST = { 480, 0 };
struct os_timezone PDT = { 480, 1 };</p>
<p>/<em> Indian Standard Time is 05:30 hours east of UTC </em>/
struct os_timezone IST = { -330, 0 };
</pre></p>
<h2 id="list-of-functions">List of Functions<a class="headerlink" href="#list-of-functions" title="Permanent link">&para;</a></h2>
<p>The functions available in time are:</p>
<ul>
<li><a href="../os_time_delay/">os_time_delay</a></li>
<li><a href="../os_time_get/">os_time_get</a></li>
<li><a href="../os_time_tick/">os_time_tick</a></li>
<li><a href="../os_settimeofday/">os_settimeofday</a></li>
<li><a href="../os_gettimeofday/">os_gettimeofday</a></li>
</ul>
<h2 id="list-of-macros">List of Macros<a class="headerlink" href="#list-of-macros" title="Permanent link">&para;</a></h2>
<p>Several macros help with the evalution of times with respect to each other.</p>
<ul>
<li><code>OS_TIME_TICK_LT(t1,t2)</code> -- evaluates to true if t1 is before t2 in time.</li>
<li><code>OS_TIME_TICK_GT(t1,t2)</code> -- evaluates to true if t1 is after t2 in time </li>
<li><code>OS_TIME_TICK_GEQ(t1,t2)</code> -- evaluates to true if t1 is on or after t2 in time.</li>
</ul>
<p>NOTE:  For all of these macros the calculations are done modulo 'os_time_t'.  </p>
<p>Ensure that comparison of OS time always uses the macros above (to compensate for the possible wrap of OS time).</p>
<p>The following macros help adding or subtracting time when represented as <code>struct os_timeval</code>. All parameters to the following macros are pointers to <code>struct os_timeval</code>.</p>
<ul>
<li><code>os_timeradd(tvp, uvp, vvp)</code> --  Add <code>uvp</code> to <code>tvp</code> and store result in <code>vvp</code>.</li>
<li><code>os_timersub(tvp, uvp, vvp)</code> -- Subtract <code>uvp</code> from <code>tvp</code> and store result in <code>vvp</code>.</li>
</ul>
<h2 id="special-notes">Special Notes<a class="headerlink" href="#special-notes" title="Permanent link">&para;</a></h2>
<p>Its important to understand how quickly the time wraps especially when doing time comparison using the macros above (or by any other means). </p>
<p>For example, if a tick is 1 millisecond and <code>os_time_t</code> is 32-bits the OS time will wrap back to zero in about 49.7 days or stated another way, the OS time epoch is 49.7 days.</p>
<p>If two times are more than 1/2 the OS time epoch apart, any time comparison will be incorrect.  Ensure at design time that comparisons will not occur between times that are more than half the OS time epoch.</p>
                        
                        <div class="row">
                            <footer>
    <div class="row">
        <div class="col-md-12">
            
                <p class="copyright">Copyright &copy; 2015 The Apache Software Foundation, Licensed under the Apache License, Version 2.0 Apache and the Apache feather logo are trademarks of The Apache Software Foundation.<br>The Apache Software Foundation Apache Incubator</p>
            
        </div>
    </div>
    <div class="copyright-logos">
        <div class="row">
            <div class="col-xs-6 text-right">
                <img src="/img/apache-feather.png" alt="Apache" title="Apache">
            </div>
            <div class="col-xs-6 text-left">
                <img src="/img/apache-logo.png" alt="Apache Incubator" title="Apache Incubator">
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <small class="footnote">
                MyNewt is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.
            </small>
        </div>
    </div>
</footer>
                        </div>
                    </div>
                </div>
            
            
        </div>

        <script src="../../../../js/jquery-1.10.2.min.js"></script>
        <script src="../../../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../../../js/highlight.pack.js"></script>
        <script src="../../../../js/base.js"></script>
        <script src="../../../../js/custom.js"></script>

    </body>
</html>