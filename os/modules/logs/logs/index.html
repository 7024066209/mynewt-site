<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="http://mynewt.apache.org/os/modules/logs/logs/">
        <link rel="shortcut icon" href="../../../../img/favicon.ico">

	<title>toc - Apache Mynewt</title>

        <link href="../../../../css/bootstrap-3.0.3.min.css" rel="stylesheet">
        <link href="../../../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../../../css/highlight.css">
        <link href="../../../../css/base.css" rel="stylesheet">
        <link href="../../../../css/custom.css" rel="stylesheet">
        <link href='https://fonts.googleapis.com/css?family=Roboto:400,500,700,900,300,100' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
        <link href="../../../../extra.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
            <script>
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-72162311-1', 'mynewt.incubator.apache.org');
                ga('send', 'pageview');
            </script>
        
    </head>


    <body class="toc">


        <div id="navbar" class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="logo-container">
        <img src="/img/logo.svg">
    </div>
    <div class="container-fluid">
        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                <li>
                    <a href="/about/">About</a>
                </li>
                <li class="dropdown">
                    <a href="/documentation/" class="dropdown-toggle" data-toggle="dropdown">Docs <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        
                        
                        
                        
                        <li >
                            <a href="../../../../documentation/">
                                Overview
                            </a>
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <li class="active">
                            <a href="../../../get_started/introduction/">
                                Mynewt OS Manual
                            </a>
                        </li>
                        
                        
                        
                        <li >
                            <a href="../../../../newt/newt_intro/">
                                Newt Tool Manual
                            </a>
                        </li>
                        
                        
                        
                        <li >
                            <a href="../../../../newtmgr/overview/">
                                Newt Manager Manual
                            </a>
                        </li>
                        
                        
                        
                        <li >
                            <a href="../../../../faq/answers/">
                                Appendix
                            </a>
                        </li>
                        
                        
                    </ul>
                </li>
                <li>
                    <a href="/download/">Download</a>
                </li>
                <li>
                    <a href="/community/">Community</a>
                </li>
                <li>
                    <a href="/events/">Events</a>
                </li>
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
            </ul>
        </div>
    </div>
</div>

        

        <div class="container-fluid">
            
                <div class="row sm-extra-padding">
                    <div id="docSidebar" class="col-md-3 bg-grey sidebar-container"><div class="bs-sidebar hidden-print" role="complementary">
    <div class="sidebar-top">
        <img class="hidden-xs hidden-sm logo-small" src="/img/logo.svg" alt="MyNewt" title="MyNewt">
        <div class="small" role="search">
            <form id ="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
                <div class="form-group">
                    <input type="text" name="q" placeholder="Search documentation" />
                    <button class="search-button" type="submit"><i class="fa fa-search"></i></button>
                </div>
            </form>
        </div>
    </div>
    <ul class="nav bs-sidenav">
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          
  
  
    <li><a href="
  ../../../get_started/introduction/
">Mynewt OS Manual</a>
  
    
      <ul class="current-toc">
          
              
                
  
    <li>
      <a href="../../../get_started/introduction/">Introduction</a>
    </li>
  

              
          
              
                
  
  
    <li ><a href="../../../get_started/get_started/">Quick Start</a></li>
  
    
  </li>

              
          
              
                
  
  
    <li ><a href="../../../get_started/vocabulary/">Concepts</a></li>
  
    
  </li>

              
          
              
                
  
  
    <li ><a href="../../../tutorials/tutorials/">Tutorials</a></li>
  
    
  </li>

              
          
              
                
  
  
    <li ><a href="../../../os_user_guide/">OS User Guide</a></li>
  
    
      <ul class="current-toc">
          
              
          
              
                
  
  
    <li ><a href="../../../core_os/mynewt_os/">OS Core</a></li>
  
    
  </li>

              
          
              
                
  
  
    <li ><a href="../../../core_os/porting/port_os/">Porting to your Platform</a></li>
  
    
  </li>

              
          
              
                
  
  
    <li ><a href="../../console/console/">Console</a></li>
  
    
  </li>

              
          
              
                
  
  
    <li ><a href="../../shell/shell/">Shell</a></li>
  
    
  </li>

              
          
              
                
  
  
    <li ><a href="../../bootloader/bootloader/">Bootloader</a></li>
  
    
  </li>

              
          
              
                
  
  
    <li><a href="
  
  
  ../../fs/fs/fs/

">File System</a>
  
    
  </li>

              
          
              
                
  
  
    <li ><a href="../../hal/hal/">Hardware Abstraction Layer</a></li>
  
    
  </li>

              
          
              
                
  
  
    <li ><a href="../../testutil/testutil/">Test Utilities</a></li>
  
    
  </li>

              
          
              
                
  
  
    <li ><a href="../../imgmgr/imgmgr/">Image Manager</a></li>
  
    
  </li>

              
          
              
                
  
    <li>
      <a href="../../baselibc/">Baselibc library</a>
    </li>
  

              
          
              
                
  
  
    <li ><a href="../../elua/elua/">Embedded Lua</a></li>
  
    
  </li>

              
          
              
                
  
  
    <li ><a href="../../json/json/">JSON</a></li>
  
    
  </li>

              
          
              
                
  
  
    <li ><a href="../../stats/stats/">Stats</a></li>
  
    
  </li>

              
          
              
                
  
  
    <li class="active"><a href="./">Logs</a></li>
  
    
      <ul class="current-toc">
          
              
          
      </ul>
    
  </li>

              
          
      </ul>
    
  </li>

              
          
              
                
  
  
    <li><a href="
  
  
  ../../../../network/ble/ble_intro/

">Networking User Guide</a>
  
    
  </li>

              
          
      </ul>
    
  </li>

        
      
        
          
  
  
    <li><a href="
  ../../../../newt/newt_intro/
">Newt Tool Manual</a>
  
    
  </li>

        
      
        
          
  
  
    <li><a href="
  ../../../../newtmgr/overview/
">Newt Manager Manual</a>
  
    
  </li>

        
      
        
          
  
  
    <li><a href="
  ../../../../faq/answers/
">Appendix</a>
  
    
  </li>

        
      
    </ul>
</div></div>

                    <div class="show-sidebar-container">
                        <button class="show-sidebar">Docs Menu</button>
                    </div>

                    <div class="col-md-offset-3 col-md-9 documentation-viewer" role="main">
                        <div class="row doc-header">
                            <div class="col-sm-6">
                                
<ul class="nav nav-pills">
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li class="active" role="presentation"><a href="../../../get_started/introduction/">Mynewt OS</a></li>
    
    
    
    <li  role="presentation"><a href="../../../../newt/newt_intro/">Newt Tool</a></li>
    
    
    
    <li  role="presentation"><a href="../../../../newtmgr/overview/">Newt Mgr</a></li>
    
    
    
    
</ul>
                            </div>
                            <div class="col-sm-6">
                                <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="/documentation/">Docs</a></li>
    
    
        
          <li>&raquo; <a href="../../../os_user_guide/">OS User Guide</a></li>
        
      
        
          <li>&raquo; Logs</li>
        
      
      
    
    
  </ul>
</div>
                            </div>
                        </div>
                        
                            <h2 id="mynewt-logging">Mynewt Logging<a class="headerlink" href="#mynewt-logging" title="Permanent link">&para;</a></h2>
<p>Apache Mynewt has a logging package (<code>apache-mynewt-core/sys/log</code>) to support
logging of information within a Mynewt application.</p>
<p><br></p>
<h3 id="description">Description<a class="headerlink" href="#description" title="Permanent link">&para;</a></h3>
<p>Logging API is provided in <code>apache-mynewt-core/sys/log/include/log/log.h</code>.</p>
<p>It allows packages to define their own log streams with separate 
names.  It also allows an application to control the output destinations
of logs. </p>
<p><br></p>
<h4 id="compile-time-settings">Compile Time Settings<a class="headerlink" href="#compile-time-settings" title="Permanent link">&para;</a></h4>
<p>To save space at compile time, there is a compile time log level that
includes/excludes certain logs at compile time, saving image space.  For 
example, during debug, you can have significant logs present, but disable
these at compile time to ensure the code size limits are met.</p>
<p>A compiler flag <code>LOG_LEVEL</code> can be set  in your <code>target.cflags</code> or within
your app <code>pkg.cflags</code> files to set the compile time log level.   The 
log level are defined in <code>apache-mynewt-core/sys/log/include/log/log.h</code>
but must be added by number to your <code>yml</code> file.</p>
<p>For example:</p>
<div class="codehilite" style="background: #ffffff"><pre style="line-height: 125%">    pkg.cflags -DLOG_LEVEL=8
</pre></div>


<p>or </p>
<div class="codehilite" style="background: #ffffff"><pre style="line-height: 125%">    newt target set my_target cflags=-DLOG_LEVEL=8
</pre></div>


<p>would both set the compile-time log level to <code>LOG_LEVEL_ERROR</code>.  All logs
of less than <code>LOG_LEVEL_ERROR</code> severity would be disabled at compile 
time and take no space within the Mynewt application image.</p>
<p>These compile time settings are applicable to all logs registered with the
system.</p>
<p><br></p>
<h3 id="log">Log<a class="headerlink" href="#log" title="Permanent link">&para;</a></h3>
<p>Each log stream requires a log structure to define its  logging properties.
It is typical for modules to extern this structure.</p>
<p><br></p>
<h3 id="log-handler">Log Handler<a class="headerlink" href="#log-handler" title="Permanent link">&para;</a></h3>
<p>To use logs, a log-handler is required, which is responsible for handling
the I/O from the log.  The log package comes with two pre-built log handlers.</p>
<ul>
<li>console -- streams log events directly to the console port.  Does
not support walking and reading.</li>
<li>cbmem -- writes/reads log events to a circular buffer.  Supports walking 
and reading for access by <code>newtmgr</code> and shell commands.</li>
</ul>
<p>In addition, it is possible to create custom log handlers for other methods.
Examples may include</p>
<ul>
<li>Flash file system</li>
<li>Flat flash buffer</li>
<li>Streamed over some other interface</li>
</ul>
<p>To use logging, you will not typically need to create your own log handler.
You can use one of the two supplied above. </p>
<p>In Mynewt today, each module will register its logs with a default log handler.
Its up to the application to use or override this log handler for its 
specific purposes.  See below for an example.</p>
<p><br></p>
<h3 id="typical-use-of-logging-when-writing-an-application">Typical use of logging when writing an application<a class="headerlink" href="#typical-use-of-logging-when-writing-an-application" title="Permanent link">&para;</a></h3>
<p>When writing an application that is using other's log modules, you 
may want to override their log handlers and log levels.</p>
<p>Add the logging to your package file.</p>
<div class="codehilite" style="background: #ffffff"><pre style="line-height: 125%">    pkg.deps:
        - &quot;@apache-mynewt-core/sys/log&quot;
</pre></div>


<p><br></p>
<p>Initialize the logs in your startup code. It may look like this </p>
<div class="codehilite" style="background: #ffffff"><pre style="line-height: 125%"><span style="color: #633820">#include &lt;module1/module1.h&gt;</span>
<span style="color: #633820">#include &lt;module3/module2.h&gt;</span>
<span style="color: #633820">#include &lt;module3/module3.h&gt;</span>
<span style="color: #633820">#include &lt;log/log.h&gt;</span>

<span style="color: #177500">/* log to console */</span>
<span style="color: #A90D91">static</span> <span style="color: #A90D91">struct</span> <span style="color: #000000">log_handler</span> <span style="color: #000000">app_log_handler</span>;

<span style="color: #177500">/* this has to be after all the modules are </span>
<span style="color: #177500"> * initialized and have registered</span>
<span style="color: #177500"> * their log modules */</span>
<span style="color: #A90D91">void</span> <span style="color: #000000">app_log_init</span>(<span style="color: #A90D91">void</span>)
{

    <span style="color: #177500">/* create a log handler for all logs . FOr this application</span>
<span style="color: #177500">    ** send them directly to the console port */</span>
    <span style="color: #000000">log_console_handler_init</span>(<span style="color: #000000">&amp;app_log_handler</span>);
    ...
    <span style="color: #177500">/* set up logging for the modules appropriately */</span>
    <span style="color: #000000">module1_log</span>.<span style="color: #000000">log_level</span> <span style="color: #000000">=</span> <span style="color: #000000">LOG_LEVEL_WARN</span>;
    <span style="color: #000000">module2_log</span>.<span style="color: #000000">log_level</span> <span style="color: #000000">=</span> <span style="color: #000000">LOG_LEVEL_INFO</span>;
    <span style="color: #000000">module3_log</span>.<span style="color: #000000">log_level</span> <span style="color: #000000">=</span> <span style="color: #000000">LOG_LEVEL_DEBUG</span>;

    <span style="color: #177500">/* set up a single handler for all modules */</span>
    <span style="color: #000000">module1_log</span>.<span style="color: #000000">log_handler</span> <span style="color: #000000">=</span> <span style="color: #000000">&amp;app_log_handler</span>;
    <span style="color: #000000">module2_log</span>.<span style="color: #000000">log_handler</span> <span style="color: #000000">=</span> <span style="color: #000000">&amp;app_log_handler</span>;
    <span style="color: #000000">module3_log</span>.<span style="color: #000000">log_handler</span> <span style="color: #000000">=</span> <span style="color: #000000">&amp;app_log_handler</span>;
}
</pre></div>


<p><br></p>
<h3 id="typical-use-of-logging-when-writing-a-module">Typical use of Logging when writing a module<a class="headerlink" href="#typical-use-of-logging-when-writing-a-module" title="Permanent link">&para;</a></h3>
<p>When creating a package using its own logging, you can have this type of
structure.  </p>
<div class="codehilite" style="background: #ffffff"><pre style="line-height: 125%"><span style="color: #177500">/* my_package.h*/</span>

<span style="color: #177500">/* pick a unique name here */</span>
<span style="color: #A90D91">extern</span> <span style="color: #A90D91">struct</span> <span style="color: #000000">log</span> <span style="color: #000000">my_log</span>;
</pre></div>


<p><br></p>
<p>with an implementation in your module that looks like this: </p>
<div class="codehilite" style="background: #ffffff"><pre style="line-height: 125%"><span style="color: #177500">/* my_package.c */</span>

<span style="color: #A90D91">struct</span> <span style="color: #000000">log_handler</span> <span style="color: #000000">log_console_handler</span>;
<span style="color: #A90D91">struct</span> <span style="color: #000000">log</span> <span style="color: #000000">my_log</span>;

{
    ...
    <span style="color: #177500">/* create a default handler for this log stream */</span>
    <span style="color: #000000">log_console_handler_init</span>(<span style="color: #000000">&amp;log_console_handler</span>);

    <span style="color: #177500">/* register my log with a name to the system */</span>
    <span style="color: #000000">log_register</span>(<span style="color: #C41A16">&quot;log&quot;</span>, <span style="color: #000000">&amp;my_log</span>, <span style="color: #000000">&amp;log_console_handler</span>);

    <span style="color: #177500">/* set up default log level for my package */</span>
    <span style="color: #000000">my_log</span>.<span style="color: #000000">log_level</span> <span style="color: #000000">=</span> <span style="color: #000000">LOG_LEVEL_DEBUG</span>;

    <span style="color: #000000">LOG_DEBUG</span>(<span style="color: #000000">&amp;my_log</span>, <span style="color: #000000">LOG_MODULE_DEFAULT</span>, <span style="color: #C41A16">&quot;bla&quot;</span>);
    <span style="color: #000000">LOG_DEBUG</span>(<span style="color: #000000">&amp;my_log</span>, <span style="color: #000000">LOG_MODULE_DEFAULT</span>, <span style="color: #C41A16">&quot;bab&quot;</span>);
}
</pre></div>
                        
                        <div class="row">
                            
<ul class="nav nav-pills" style="margin-bottom: 10px">
    <li>
    
    <a href=../../stats/stats/><span class="fa fa-arrow-left"></span>  Previous: toc</a>
    
    </li>
    <li class="pull-right">
    
    <a href=../../../../network/ble/ble_intro/></span>Next: toc  <span class="fa fa-arrow-right">
    
    </li>
</ul>
                        </div>
                        <div class="row">
                            <footer>
    <div class="row">
        <div class="col-md-12">
            
                <p class="copyright">Copyright &copy; 2015 The Apache Software Foundation, Licensed under the Apache License, Version 2.0 Apache and the Apache feather logo are trademarks of The Apache Software Foundation.<br>The Apache Software Foundation Apache Incubator</p>
            
        </div>
    </div>
    <div class="copyright-logos">
        <div class="row">
            <div class="col-xs-6 text-right">
                <img src="/img/apache-feather.png" alt="Apache" title="Apache">
            </div>
            <div class="col-xs-6 text-left">
                <img src="/img/apache-logo.png" alt="Apache Incubator" title="Apache Incubator">
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <small class="footnote">
                MyNewt is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.
            </small>
        </div>
    </div>
</footer>
                        </div>
                    </div>
                </div>
            
            
        </div>

        <script src="../../../../js/jquery-1.10.2.min.js"></script>
        <script src="../../../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../../../js/highlight.pack.js"></script>
        <script src="../../../../js/base.js"></script>
        <script src="../../../../js/custom.js"></script>

    </body>
</html>