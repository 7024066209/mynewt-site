<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="http://mynewt.apache.org/os/modules/fs/fs/fs/">
        <link rel="shortcut icon" href="../../../../../img/favicon.ico">

	<title>Overview - Apache Mynewt</title>

        <link href="../../../../../css/bootstrap-3.0.3.min.css" rel="stylesheet">
        <link href="../../../../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../../../../css/highlight.css">
        <link href="../../../../../css/base.css" rel="stylesheet">
        <link href="../../../../../css/custom.css" rel="stylesheet">
        <link href='https://fonts.googleapis.com/css?family=Roboto:400,500,700,900,300,100' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
        <link href="../../../../../extra.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
            <script>
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-72162311-1', 'mynewt.incubator.apache.org');
                ga('send', 'pageview');
            </script>
        
    </head>


    <body class="Overview">


        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="logo-container">
        <img src="/img/logo.svg">
    </div>
    <div class="container-fluid">
        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                <li>
                    <a href="/about/">About</a>
                </li>
                <li>
                    <a href="/documentation/">Docs</a>
                </li>
                <li>
                    <a href="/download/">Download</a>
                </li>
                <li>
                    <a href="/community/">Community</a>
                </li>
                <li>
                    <a href="/events/">Events</a>
                </li>
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
            </ul>
        </div>
    </div>
</div>

        <div class="container-fluid">
            
                <div class="row sm-extra-padding">
                    <div class="col-md-3 bg-grey sidebar-container"><div class="bs-sidebar hidden-print" role="complementary">
    <div class="sidebar-top">
        <img class="hidden-xs hidden-sm logo-small" src="/img/logo.svg" alt="MyNewt" title="MyNewt">
        <div class="small" role="search">
            <form id ="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
                <div class="form-group">
                    <input type="text" name="q" placeholder="Search documentation" />
                    <button class="search-button" type="submit"><i class="fa fa-search"></i></button>
                </div>
            </form>
        </div>
    </div>
    <ul class="nav bs-sidenav">
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          
  
  <li><a href="
  ../../../../get_started/introduction/
">Apache Mynewt Manual</a>
    
      <ul class="current-toc">
          
              
  
    <li>
      <a href="../../../../get_started/introduction/">Introduction</a>
    </li>
  

          
              
  
  <li><a href="
  ../../../../get_started/project1/
">Get Started</a>
    
  </li>

          
              
  
  <li><a href="
  ../../../../tutorials/STM32F303/
">Tutorials</a>
    
  </li>

          
              
  
  <li><a href="
  
  
  
  
  ../../../../core_os/mynewt_os/


">OS User Guide</a>
    
      <ul class="current-toc">
          
              
  
  <li><a href="
  
  
  ../../../../core_os/mynewt_os/

">OS Core</a>
    
  </li>

          
              
  
  <li><a href="
  ../../../../core_os/porting/port_os/
">Porting to your Platform</a>
    
  </li>

          
              
  
  <li><a href="
  ../../../console/console/
">Console</a>
    
  </li>

          
              
  
  <li><a href="
  ../../../shell/shell/
">Shell</a>
    
  </li>

          
              
  
  <li><a href="
  ../../../bootloader/bootloader/
">Bootloader</a>
    
  </li>

          
              
  
  <li><a href="
  
  
  ./

">File System</a>
    
      <ul class="current-toc">
          
              
  
  <li><a href="
  ./
">File System Abstraction</a>
    
      <ul class="current-toc">
          
              
  
    <li class="active">
      Overview
    </li>
  

          
              
  
    <li>
      <a href="../fs_return_codes/">Return Codes</a>
    </li>
  

          
              
  
  <li><a href="
  ../fs_ops/
">Data Structures</a>
    
  </li>

          
              
  
  <li><a href="
  ../fs_close/
">Functions</a>
    
  </li>

          
      </ul>
    
  </li>

          
              
  
  <li><a href="
  ../../nffs/nffs/
">Newtron Flash File System</a>
    
  </li>

          
              
  
    <li>
      <a href="../../otherfs/">Other File Systems</a>
    </li>
  

          
      </ul>
    
  </li>

          
              
  
  <li><a href="
  ../../../hal/hal/
">Hardware Abstraction Layer</a>
    
  </li>

          
              
  
  <li><a href="
  ../../../testutil/testutil/
">Test Utilities</a>
    
  </li>

          
              
  
  <li><a href="
  ../../../imgmgr/imgmgr/
">Image Manager</a>
    
  </li>

          
              
  
    <li>
      <a href="../../../baselibc/">Baselibc library</a>
    </li>
  

          
              
  
  <li><a href="
  ../../../elua/elua/
">Embedded Lua</a>
    
  </li>

          
              
  
  <li><a href="
  ../../../json/json/
">JSON</a>
    
  </li>

          
      </ul>
    
  </li>

          
              
  
  <li><a href="
  
  
  ../../../../../network/ble/ble_intro/

">Networking User Guide</a>
    
  </li>

          
      </ul>
    
  </li>

        
      
        
          
  
  <li><a href="
  ../../../../../newt/newt_intro/
">Newt Tool Manual</a>
    
  </li>

        
      
        
          
  
  <li><a href="
  ../../../../../newtmgr/overview/
">Newt Manager Manual</a>
    
  </li>

        
      
    </ul>
</div></div>
                    
                    <div class="show-sidebar-container">
                        <button class="show-sidebar">Docs Menu</button>
                    </div>
                    
                    <div class="col-md-9 documentation-viewer" role="main">
                        <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../../..">Docs</a> &raquo;</li>
    
      
        
          <li>File System &raquo;</li>
        
      
        
          <li>File System Abstraction &raquo;</li>
        
      
    
    <li>Overview</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
                        
                            <h1 id="file-system-abstraction">File System Abstraction<a class="headerlink" href="#file-system-abstraction" title="Permanent link">&para;</a></h1>
<p>Mynewt provides a file system abstraction layer (<code>fs/fs</code>) to allow client code to be file system agnostic.  By accessing the file system via the <code>fs/fs</code> API, client code can perform file system operations without being tied to a particular implementation.  When possible, library code should use the <code>fs/fs</code> API rather than accessing the underlying file system directly.</p>
<h2 id="description">Description<a class="headerlink" href="#description" title="Permanent link">&para;</a></h2>
<p>Applications should aim to minimize the amount of code which depends on a particular file system implementation.  When possible, only depend on the <code>fs/fs</code> package.  In the simplest case, the only code which needs to know which file system is in use is the code which initializes the file system.  In terms of the Mynewt hierarchy, the <strong>project</strong> package must depend on a specific file system package, while <strong>library</strong> packages should only depend on <code>fs/fs</code>.</p>
<p>The following example illustrates how file system dependencies should be managed.  In the slinky application, the project is responsible for initializing the file system, so it depends on a concrete file system package called <code>fs/nffs</code> (Newtron Flash File System). The project explicitly initializes nffs via calls to <code>nffs_init()</code>, <code>nffs_detect()</code> and <code>nffs_format()</code>.</p>
<pre><code class="no-highlight"># project/slinky/pkg.yml

pkg.name: project/slinky
pkg.vers: 0.8.0
pkg.deps:
    - fs/nffs

# [...]
</code></pre>

<pre><code class="no-highlight">// project/slinky/src/main.c

#include &quot;nffs/nffs.h&quot;

int
main(int argc, char **argv)
{
    int rc;
    int cnt;
    struct nffs_area_desc descs[NFFS_AREA_MAX];

    rc = nffs_init();
    assert(rc == 0);

    cnt = NFFS_AREA_MAX;
    rc = flash_area_to_nffs_desc(FLASH_AREA_NFFS, &amp;cnt, descs);
    assert(rc == 0);
    if (nffs_detect(descs) == FS_ECORRUPT) {
        rc = nffs_format(descs);
        assert(rc == 0);
    }
    // [...]
}
</code></pre>

<p>On the other hand, code which uses the file system after it has been initialized need only depend on <code>fs/fs</code>.  For example, the <code>libs/imgmgr</code> package is a library which provides firmware upload and download functionality via the use of a file system.  This library is only used after the main project has initialized the file system, and therefore only depends on the <code>fs/fs</code> package.</p>
<pre><code class="no-highlight"># libs/imgmgr/pkg.yml
pkg.name: libs/imgmgr
pkg.vers: 0.8.0
pkg.deps:
    - fs/fs

# [...]
</code></pre>

<p>The <code>libs/imgmgr</code> package uses the <code>fs/fs</code> API for all file system operations.</p>
<h2 id="thread-safety">Thread Safety<a class="headerlink" href="#thread-safety" title="Permanent link">&para;</a></h2>
<p>All <code>fs/fs</code> functions are thread safe.</p>
<h2 id="header-files">Header Files<a class="headerlink" href="#header-files" title="Permanent link">&para;</a></h2>
<p>All code which uses the <code>fs/fs</code> package needs to include the following header:</p>
<pre><code class="no-highlight">#include &quot;fs/fs.h&quot;
</code></pre>

<h2 id="data-structures">Data Structures<a class="headerlink" href="#data-structures" title="Permanent link">&para;</a></h2>
<p>All <code>fs/fs</code> data structures are opaque to client code.</p>
<pre><code class="no-highlight">struct fs_file;
struct fs_dir;
struct fs_dirent;
</code></pre>

<h2 id="api">API<a class="headerlink" href="#api" title="Permanent link">&para;</a></h2>
<p>Functions in <code>fs/fs</code> that indicate success or failure do so with the following set of return codes:</p>
<ul>
<li><a href="../fs_return_codes/">Return Codes</a></li>
</ul>
<p>The functions available in this OS feature are:</p>
<ul>
<li><a href="../fs_close/">fs_close</a></li>
<li><a href="../fs_closedir/">fs_closedir</a></li>
<li><a href="../fs_dirent_is_dir/">fs_dirent_is_dir</a></li>
<li><a href="../fs_dirent_name/">fs_dirent_name</a></li>
<li><a href="../fs_filelen/">fs_filelen</a></li>
<li><a href="../fs_getpos/">fs_getpos</a></li>
<li><a href="../fs_mkdir/">fs_mkdir</a></li>
<li><a href="../fs_open/">fs_open</a></li>
<li><a href="../fs_opendir/">fs_opendir</a></li>
<li><a href="../fs_read/">fs_read</a></li>
<li><a href="../fs_readdir/">fs_readdir</a></li>
<li><a href="../fs_rename/">fs_rename</a></li>
<li><a href="../fs_seek/">fs_seek</a></li>
<li><a href="../fs_unlink/">fs_unlink</a></li>
<li><a href="../fs_write/">fs_write</a></li>
</ul>
<p>Additional file system utilities that bundle some of the basic functions above are:</p>
<ul>
<li><a href="../fsutil_read_file/">fsutil_read_file</a></li>
<li><a href="../fsutil_write_file/">fsutil_write_file</a></li>
</ul>
                        
                    </div>
                </div>
            
            <div class="row">    
                <footer>
    <div class="row">
        <div class="col-md-12">
            
                <p class="copyright">Copyright &copy; 2015 The Apache Software Foundation, Licensed under the Apache License, Version 2.0 Apache and the Apache feather logo are trademarks of The Apache Software Foundation.<br>The Apache Software Foundation Apache Incubator</p>
            
        </div>
    </div>
    <div class="copyright-logos">
        <div class="row">
            <div class="col-xs-6 text-right">
                <img src="/img/apache-feather.png" alt="Apache" title="Apache">
            </div>
            <div class="col-xs-6 text-left">
                <img src="/img/apache-logo.png" alt="Apache Incubator" title="Apache Incubator">
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <small class="footnote">
                MyNewt is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.
            </small>
        </div>
    </div>
</footer>
            </div>
        </div>

        <script src="../../../../../js/jquery-1.10.2.min.js"></script>
        <script src="../../../../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../../../../js/highlight.pack.js"></script>
        <script src="../../../../../js/base.js"></script>
        <script src="../../../../../js/custom.js"></script>

    </body>
</html>