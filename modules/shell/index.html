<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="http://mynewt.incubator.apache.org/modules/shell/">
        <link rel="shortcut icon" href="../../img/favicon.ico">

	<title>Shell - Apache Mynewt</title>

        <link href="../../css/bootstrap-3.0.3.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/base.css" rel="stylesheet">
        <link href="../../css/custom.css" rel="stylesheet">
        <link href='https://fonts.googleapis.com/css?family=Roboto:400,500,700,900,300,100' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
        <link href="../../extra.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
            <script>
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-72162311-1', 'mynewt.incubator.apache.org');
                ga('send', 'pageview');
            </script>
        
    </head>


    <body class="Shell">


        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="logo-container">
        <img src="http://mynewt.incubator.apache.org/img/logo.svg">
    </div>
    <div class="container-fluid">
        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="http://mynewt.incubator.apache.org/">Home</a>
                </li>
                <li>
                    <a href="http://mynewt.incubator.apache.org/documentation/">Docs</a>
                </li>
                <li>
                    <a href="http://mynewt.incubator.apache.org/download/">Download</a>
                </li>
                <li>
                    <a href="http://mynewt.incubator.apache.org/community/">Community</a>
                </li>
                <li>
                    <a href="http://mynewt.incubator.apache.org/events/">Events</a>
                </li>
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
            </ul>
        </div>
    </div>
</div>

        <div class="container-fluid">
            
                <div class="row sm-extra-padding">
                    <div class="col-md-3 bg-grey sidebar-container"><div class="bs-sidebar hidden-print" role="complementary">    
    <div class="sidebar-top">
        <img class="hidden-xs hidden-sm logo-small" src="http://mynewt.incubator.apache.org/img/logo.svg" alt="MyNewt" title="MyNewt">
        <div class="small" role="search">
            <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
                <div class="form-group">
                    <input type="text" name="q" placeholder="Search documentation" />
                    <button class="search-button" type="submit"><i class="fa fa-search"></i></button>
                </div>
            </form>
        </div>
    </div>
    <ul class="nav bs-sidenav">
        
            
        
            
        
            
        
            
        
            
        
            
                <li class="main"><a href="../../get_started/newt_concepts/">Chapter 1 - Get Started</a></li>
                
            
        
            
                <li class="main"><a href="../../get_acclimated/vocabulary/">Chapter 2 - Get Acclimated</a></li>
                
            
        
            
                <li class="main"><a href="../../newt/newt_ops/">Chapter 3 - Newt Tool</a></li>
                
            
        
            
                <li class="main"><a href="../../os/mynewt_os/">Chapter 4 - Mynewt OS</a></li>
                
            
        
            
                <li class="main"><a href="../console/">Chapter 5 - Modules</a></li>
                
                    <ul class="current-toc">
                        
                            <li class="toctree-l2"><a href="../console/">Console</a></li>
                            
                        
                            <li class="toctree-l2"><a href="./">Shell</a></li>
                            
                                
                                    
                                        <li class="toctree-l3"><a href="#description">Description</a></li>
                                    
                                        <li class="toctree-l3"><a href="#data-structures">Data structures</a></li>
                                    
                                        <li class="toctree-l3"><a href="#list-of-functions">List of Functions</a></li>
                                    
                                        <li class="toctree-l3"><a href="#function-reference">Function Reference</a></li>
                                    
                                        <li class="toctree-l3"><a href="#shell_cmd_register"> shell_cmd_register </a></li>
                                    
                                
                            
                        
                            <li class="toctree-l2"><a href="../bootloader/">Bootloader</a></li>
                            
                        
                            <li class="toctree-l2"><a href="../filesystem/">File System Abstraction</a></li>
                            
                        
                            <li class="toctree-l2"><a href="../nffs/">Newtron Flash File System</a></li>
                            
                        
                            <li class="toctree-l2"><a href="../testutil/">Test Utilities</a></li>
                            
                        
                            <li class="toctree-l2"><a href="../imgmgr/">Image Manager</a></li>
                            
                        
                            <li class="toctree-l2"><a href="../baselibc/">Baselibc library</a></li>
                            
                        
                            <li class="toctree-l2"><a href="../elua/">Embedded Lua</a></li>
                            
                        
                            <li class="toctree-l2"><a href="../json/">JSON</a></li>
                            
                        
                    </ul>
                
            
        
            
                <li class="main"><a href="../../newtmgr/overview/">Chapter 6 - Newt Manager</a></li>
                
            
        
            
                <li class="main"><a href="../../packaging/dist/">Chapter 7 - Packaging it</a></li>
                
            
        
    </ul>
</div></div>
                    
                    <div class="show-sidebar-container">
                        <button class="show-sidebar">Docs Menu</button>
                    </div>
                    
                    <div class="col-md-9 documentation-viewer" role="main">
                        <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Chapter 5 - Modules &raquo;</li>
        
      
    
    <li>Shell</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
                        
                            <h1 id="shell">Shell<a class="headerlink" href="#shell" title="Permanent link">&para;</a></h1>
<p>The shell is the program which puts up a prompt for a command, processes commands, and returns output. Interacting with the console of a device is done using a shell program.</p>
<h2 id="description">Description<a class="headerlink" href="#description" title="Permanent link">&para;</a></h2>
<p>Shell processes console input one line at a time. Eggs can register handlers for their commands. Shell parses the input, matches it against the set of registered commands, and then calls the handler it finds.</p>
<p>A few commands are currently available in the shell - <code>tasks</code>, <code>log</code>, and <code>stat stat</code>. A $ prompt sign will be coming soon!</p>
<p>Create a sim target to check out these commands available in shell.</p>
<pre><code class="no-highlight">user@~/dev/larva$ newt target create blinky_sim
Creating target blinky_sim
Target blinky_sim successfully created!
user@~/dev/larva$ newt target set blinky_sim name=blinky_sim
Target blinky_sim successfully set name to blinky_sim
user@~/dev/larva$ newt target set blinky_sim arch=sim
Target blinky_sim successfully set arch to sim
user@~/dev/larva$ newt target set blinky_sim project=blinky
Target blinky_sim successfully set project to blinky
user@~/dev/larva$ newt target set blinky_sim bsp=hw/bsp/native
Target blinky_sim successfully set bsp to hw/bsp/native
user@~/dev/larva$ newt target set blinky_sim compiler_def=sim
Target blinky_sim successfully set compiler_def to sim
user@~/dev/larva$ newt target set blinky_sim compiler_def=debug
Target blinky_sim successfully set compiler_def to debug
user@~/dev/larva$ newt target set blinky_sim compiler=sim
Target blinky_sim successfully set compiler to sim
user@~/dev/larva$ newt target show
blinky_sim
    arch: sim
    bsp: hw/bsp/native
    compiler: sim
    compiler_def: debug
    name: blinky_sim
    project: blinky
user@~/dev/larva$ newt target build blinky_sim
Building target blinky_sim (project = blinky)
Compiling case.c
Compiling suite.c
Compiling testutil.c
..
..
Building project blinky
Linking blinky.elf
Successfully run!

user@~/dev/larva$ ./project/blinky/bin/blinky_sim/blinky.elf
uart0 at /dev/ttys005

</code></pre>

<p>Open up a new terminal to run minicom, a text-based serial port control and terminal emulation program. Set device name to the serial port of the target. </p>
<pre><code class="no-highlight">user@~$ minicom -D /dev/ttys005
Welcome to minicom 2.7

OPTIONS: 
Compiled on Nov 24 2015, 16:14:21.
Port /dev/ttys005, 11:32:17

Press Meta-Z for help on special keys

log 
174578:[0] bla
174578:[0] bab

tasks
217809:6 tasks: 
217809:  shell (prio: 3, nw: 0, flags: 0x0, ssize: 0, cswcnt: 59, tot_run_time: 0ms)
217840:  idle (prio: 255, nw: 0, flags: 0x0, ssize: 0, cswcnt: 18763, tot_run_time: 217809ms)
217878:  uart_poller (prio: 0, nw: 217819, flags: 0x0, ssize: 0, cswcnt: 18667, tot_run_time: 0ms)
217923:  task1 (prio: 1, nw: 218710, flags: 0x0, ssize: 0, cswcnt: 218, tot_run_time: 0ms)
217953:  os_sanity (prio: 254, nw: 218710, flags: 0x0, ssize: 0, cswcnt: 218, tot_run_time: 0ms)
218010:  task2 (prio: 2, nw: 217709, flags: 0x3, ssize: 0, cswcnt: 218, tot_run_time: 0ms)

stat stat
229881:s0: 1

</code></pre>

<h2 id="data-structures">Data structures<a class="headerlink" href="#data-structures" title="Permanent link">&para;</a></h2>
<p>Replace this with the list of data structures used, why, any neat features</p>
<h2 id="list-of-functions">List of Functions<a class="headerlink" href="#list-of-functions" title="Permanent link">&para;</a></h2>
<p><Comments such as these instructions are placed within angle brackets. List all the functions here. Note how the anchors work. You put the text you want to show up as a link within [] and the relevant #heading within (). Note that the header has to have at least 2 words for the anchor to work - that's how it is. "no-highlight" disables syntax highlighting. You can enable it for a particular language by specifying what the language is instead of "no-highlight". Be warned that this highlighting or no-highlighting specification may not show up nicely on Mou.></p>
<p>The functions available in this OS feature are:</p>
<ul>
<li><a href="#shell_cmd_register">shell_cmd_register</a></li>
<li>add the rest</li>
</ul>
<h2 id="function-reference">Function Reference<a class="headerlink" href="#function-reference" title="Permanent link">&para;</a></h2>
<hr />
<h2 id="shell_cmd_register"><font color="F2853F" style="font-size:24pt"> shell_cmd_register </font><a class="headerlink" href="#shell_cmd_register" title="Permanent link">&para;</a></h2>
<pre><code class="no-highlight">    int 
    shell_cmd_register(struct shell_cmd *sc, char *cmd, shell_cmd_func_t func)
</code></pre>

<p>Register a shell command. When shell reads a line of input which starts with <code>cmd</code>, it calls the handler <code>func</code>. Caller must allocate data structure <code>sc</code>. Shell internally links this to it's list of command handlers.</p>
<h4 id="arguments">Arguments<a class="headerlink" href="#arguments" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Arguments</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>sc</td>
<td>Pointer to data structure shell egg uses to store info about the registered command</td>
</tr>
<tr>
<td>cmd</td>
<td>Command getting registered</td>
</tr>
<tr>
<td>func</td>
<td>Function to call when command is received from console</td>
</tr>
</tbody>
</table>
<h4 id="returned-values">Returned values<a class="headerlink" href="#returned-values" title="Permanent link">&para;</a></h4>
<p>List any values returned.
Error codes?</p>
<h4 id="notes">Notes<a class="headerlink" href="#notes" title="Permanent link">&para;</a></h4>
<p>Shell splits the arguments following the command into an array of character pointers, and passes these to registered handler. The function will be called in shell task's context, so the command handler should look out for possible issues due to concurrency.</p>
<h4 id="example">Example<a class="headerlink" href="#example" title="Permanent link">&para;</a></h4>
<p>Here is FS registering command for 'ls'.</p>
<pre><code class="no-highlight">static struct shell_cmd fs_ls_struct;

static int
fs_ls_cmd(int argc, char **argv)
{
    /* XXX do some stuff */
    console_printf(&quot;%d files\n&quot;, file_cnt);
    return 0;
}

void
fs_cli_init(void)
{
    int rc;

    rc = shell_cmd_register(&amp;fs_ls_struct, &quot;ls&quot;, fs_ls_cmd);
    if (rc != 0) {
        return;
    }
}

</code></pre>

<hr />
                        
                    </div>
                </div>
            
            <div class="row">    
                <footer>
    <div class="row">
        <div class="col-md-12">
            
                <p class="copyright">Copyright &copy; 2015 The Apache Software Foundation, Licensed under the Apache License, Version 2.0 Apache and the Apache feather logo are trademarks of The Apache Software Foundation.<br>The Apache Software Foundation Apache Incubator</p>
            
        </div>
    </div>
    <div class="copyright-logos">
        <div class="row">
            <div class="col-xs-6 text-right">
                <img src="http://mynewt.incubator.apache.org/img/apache-feather.png" alt="Apache" title="Apache">
            </div>
            <div class="col-xs-6 text-left">
                <img src="http://mynewt.incubator.apache.org/img/apache-logo.png" alt="Apache Incubator" title="Apache Incubator">
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <small class="footnote">
                MyNewt is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.
            </small>
        </div>
    </div>
</footer>
            </div>
        </div>

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script src="../../js/base.js"></script>
        <script src="../../js/custom.js"></script>

    </body>
</html>