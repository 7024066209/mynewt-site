

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    

    
    <title>Mynewt OS related FAQ &mdash; Apache Mynewt 1.3.0 documentation</title>
    

    
    
      <link rel="shortcut icon" href="_static/mynewt-logo-only-newt32x32.png"/>
    

    

    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

    
      <link rel="stylesheet" href="_static/css/sphinx_theme.css" type="text/css" />
    
      <link rel="stylesheet" href="_static/css/bootstrap-3.0.3.min.css" type="text/css" />
    
      <link rel="stylesheet" href="_static/css/v2.css" type="text/css" />
    
      <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
    
      <link rel="stylesheet" href="_static/css/restructuredtext.css" type="text/css" />
    

    

    <link rel="stylesheet" href="_static/css/overrides.css" type="text/css" />
          <link rel="index" title="Index"
                href="genindex.html"/>
          <link rel="search" title="Search" href="search.html"/>
      <link rel="top" title="Apache Mynewt 1.3.0 documentation" href="index.html"/>
          <link rel="next" title="Appendix" href="misc/index.html"/>
          <link rel="prev" title="Installing Previous Releases of Newtmgr" href="newtmgr/install/prev_releases.html"/> 

    
    <script src="_static/js/modernizr.min.js"></script>

    
    <script>
    (function(i, s, o, g, r, a, m) {
	i["GoogleAnalyticsObject"] = r;
	(i[r] =
		i[r] ||
		function() {
			(i[r].q = i[r].q || []).push(arguments);
		}),
		(i[r].l = 1 * new Date());
	(a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
	a.async = 1;
	a.src = g;
	m.parentNode.insertBefore(a, m);
})(window, document, "script", "//www.google-analytics.com/analytics.js", "ga");

ga("create", "UA-72162311-1", "auto");
ga("send", "pageview");
</script>
    

  </head>

  <body class="not-front page-documentation" role="document" >
    <div id="wrapper">
      <div class="container">
    <div id="banner" class="row v2-main-banner">
        <a class="logo-cell" href="/">
            <img class="logo" src="_static/img/logo.png">
        </a>
        <div class="tagline-cell">
            <h4 class="tagline">An OS to build, deploy and securely manage billions of devices</h4>
        </div>
        <div class="news-cell">
            <div class="well">
              <h4>Latest News:</h4> <a href="/download">Apache Mynewt 1.4.1, Apache NimBLE 1.0.0 </a> released (July 1, 2018)
            </div>
        </div>
    </div>
</div>
      
<header>
    <nav id="navbar" class="navbar navbar-inverse" role="navigation">
        <div class="container">
            <!-- Collapsed navigation -->
            <div class="navbar-header">
                <!-- Expander button -->
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>

            </div>

            <!-- Expanded navigation -->
            <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/"><i class="fa fa-home" style="font-size: larger;"></i></a>
                    </li>
                    <li class="important">
                        <a href="/quick-start/">Quick Start</a>
                    </li>
                    <li>
                        <a href="/about/">About</a>
                    </li>
                    <li>
                        <a href="/talks/">Talks</a>
                    </li>
                    <li class="active">
                        <a href="/documentation/">Documentation</a>
                    </li>
                    <li>
                        <a href="/download/">Download</a>
                    </li>
                    <li>
                        <a href="/community/">Community</a>
                    </li>
                    <li>
                        <a href="/events/">Events</a>
                    </li>
                </ul>

                <!-- Search, Navigation and Repo links -->
                <ul class="nav navbar-nav navbar-right">
                    
                </ul>
            </div>
        </div>
    </nav>
</header>
      <!-- STARTS MAIN CONTENT -->
      <div id="main-content">
        





<div id="breadcrumb">
  <div class="container">
    <a href="/documentation/">Docs</a> /
    
    Mynewt OS related FAQ
    
  <div class="sourcelink">
    <a href="https://github.com/apache/mynewt-documentation/edit/master/docs/mynewt_faq.rst" class="icon icon-github"
           rel="nofollow"> Edit on GitHub</a>
</div>
  </div>
</div>
        <!-- STARTS CONTAINER -->
        <div class="container">
          <!-- STARTS .content -->
          <div id="content" class="row">
            
            <!-- STARTS .container-sidebar -->
<div class="container-sidebar col-xs-12 col-sm-3">
  <div id="docSidebar" class="sticky-container">
    <div role="search" class="sphinx-search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search documentation" class="search-documentation" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
    
<!-- Note: only works when deployed -->
<select class="form-control" onchange="if (this.value) window.location.href=this.value">
    <option
      value="/latest"
      selected
      >
      Version: latest
    </option>
    <option
      value="/v1_3_0/os/introduction"
      >
      Version: 1.3.0
    </option>
    <option
      value="/v1_2_0/os/introduction"
      >
      Version: 1.2.0
    </option>
    <option
      value="/v1_1_0/os/introduction">
      Version: 1.1.0
    </option>
    <option
      value="/v1_0_0/os/introduction">
      Version: 1.0.0
    </option>
    <option
      value="/v0_9_0/os/introduction">
      Version: 0_9_0
    </option>
</select>
    <div class="region region-sidebar">
      <div class="docs-menu">
      
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="get_started/index.html">Setup &amp; Get Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="concepts.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="os/os_user_guide.html">OS User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="network/docs/index.html">BLE User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="newt/index.html">Newt Tool Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="newtmgr/index.html">Newt Manager Guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Mynewt OS related FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="misc/index.html">Appendix</a></li>
</ul>

        
      
      </div>
    </div>
  </div>
  <!-- ENDS STICKY CONTAINER -->
</div>
<!-- ENDS .container-sidebar -->

            <div class="col-xs-12 col-sm-9">
              
              <div class="">
                <div class="rst-content">
                  <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
                   <div itemprop="articleBody">
                    
  <div class="section" id="mynewt-os-related-faq">
<span id="mynewt-faq"></span><h1>Mynewt OS related FAQ<a class="headerlink" href="#mynewt-os-related-faq" title="Permalink to this headline">Â¶</a></h1>
<p>Here are some lists, grouped by categories, of frequently asked
questions when working with Mynewt OS and tools.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#bluetooth" id="id1">Bluetooth</a><ul>
<li><a class="reference internal" href="#nimble-on-nrf52840" id="id2">NimBLE on nRF52840</a></li>
<li><a class="reference internal" href="#trigger-exactly-one-ble-advertisement-immediately" id="id3">Trigger Exactly One BLE Advertisement Immediately</a></li>
<li><a class="reference internal" href="#supported-bluetooth-radio-transceivers" id="id4">Supported Bluetooth Radio Transceivers</a></li>
<li><a class="reference internal" href="#nimble-operational-questions" id="id5">NimBLE Operational Questions</a></li>
<li><a class="reference internal" href="#blemesh-forgets-all-keys-on-restart" id="id6"><code class="docutils literal notranslate"><span class="pre">blemesh</span></code> Forgets All Keys on Restart</a></li>
<li><a class="reference internal" href="#l2cap-connection" id="id7">L2CAP Connection</a></li>
<li><a class="reference internal" href="#bitbang-ble-mesh-ble-advertising" id="id8">Bitbang, BLE Mesh, BLE Advertising</a></li>
<li><a class="reference internal" href="#extended-advertising-with-btshell" id="id9">Extended Advertising with <code class="docutils literal notranslate"><span class="pre">btshell</span></code></a></li>
<li><a class="reference internal" href="#configuring-maximum-number-of-connections-for-blehci" id="id10">Configuring Maximum Number of Connections for <code class="docutils literal notranslate"><span class="pre">blehci</span></code></a></li>
<li><a class="reference internal" href="#disconnect-crash-while-writing-analog-value-from-central-module" id="id11">Disconnect/Crash While Writing Analog Value From Central Module</a></li>
</ul>
</li>
<li><a class="reference internal" href="#bootloader-and-firmware-upgrade" id="id12">Bootloader and Firmware Upgrade</a></li>
<li><a class="reference internal" href="#file-system" id="id13">File System</a><ul>
<li><a class="reference internal" href="#nffs-setup" id="id14"><code class="docutils literal notranslate"><span class="pre">nffs</span></code> Setup</a></li>
</ul>
</li>
<li><a class="reference internal" href="#nfc" id="id15">NFC</a></li>
<li><a class="reference internal" href="#newt" id="id16">Newt</a><ul>
<li><a class="reference internal" href="#difference-between-newt-commands-install-upgrade-and-sync" id="id17">Difference Between <code class="docutils literal notranslate"><span class="pre">newt</span></code> Commands <code class="docutils literal notranslate"><span class="pre">install</span></code>, <code class="docutils literal notranslate"><span class="pre">upgrade</span></code>, and <code class="docutils literal notranslate"><span class="pre">sync</span></code></a></li>
<li><a class="reference internal" href="#newt-size-command-vs-elf-file-size" id="id18"><code class="docutils literal notranslate"><span class="pre">newt</span> <span class="pre">size</span></code> Command vs. Elf File Size</a></li>
</ul>
</li>
<li><a class="reference internal" href="#newtmgr" id="id19">Newtmgr</a><ul>
<li><a class="reference internal" href="#connection-profile-using-newtmgr" id="id20">Connection Profile using newtmgr</a></li>
<li><a class="reference internal" href="#nmp" id="id21">NMP</a></li>
<li><a class="reference internal" href="#newtmgr-with-the-adafruit-nrf52dk" id="id22">Newtmgr with the Adafruit nRF52DK</a></li>
</ul>
</li>
<li><a class="reference internal" href="#porting-mynewt" id="id23">Porting Mynewt</a><ul>
<li><a class="reference internal" href="#porting-mynewt-to-core-m3-mcu" id="id24">Porting Mynewt to Core-M3 MCU</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mynewt-syntax-and-semantics" id="id25">Mynewt Syntax and Semantics</a><ul>
<li><a class="reference internal" href="#ending-the-delay-of-a-task-blocking-a-call-early" id="id26">Ending the Delay of a Task Blocking a Call Early</a></li>
<li><a class="reference internal" href="#random-function-device" id="id27">Random Function / Device</a></li>
<li><a class="reference internal" href="#setting-serial-and-mfghash" id="id28">Setting <code class="docutils literal notranslate"><span class="pre">serial</span></code> and <code class="docutils literal notranslate"><span class="pre">mfghash</span></code></a></li>
<li><a class="reference internal" href="#leading-zeros-format-in-printf" id="id29">Leading Zeros Format in <code class="docutils literal notranslate"><span class="pre">printf</span></code></a></li>
<li><a class="reference internal" href="#mynewt-equivalent-of-unix-sleep-3" id="id30">Mynewt Equivalent of UNIX <code class="docutils literal notranslate"><span class="pre">sleep(3)</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#modules-in-mynewt" id="id31">Modules in Mynewt</a></li>
<li><a class="reference internal" href="#troubleshooting" id="id32">Troubleshooting</a><ul>
<li><a class="reference internal" href="#error-unsatisfied-apis-detected" id="id33">Error: Unsatisfied APIs detected</a></li>
<li><a class="reference internal" href="#greyed-out-files-on-ios-11" id="id34">Greyed out files on iOS 11</a></li>
<li><a class="reference internal" href="#arm-none-eabi-gcc-build-error-for-project" id="id35"><code class="docutils literal notranslate"><span class="pre">arm-none-eabi-gcc</span></code> Build Error for Project</a></li>
<li><a class="reference internal" href="#issues-running-image-on-boot" id="id36">Issues Running Image on Boot</a></li>
</ul>
</li>
<li><a class="reference internal" href="#miscellaneous" id="id37">Miscellaneous</a><ul>
<li><a class="reference internal" href="#enable-trace-in-mynewt" id="id38">Enable Trace in Mynewt</a></li>
<li><a class="reference internal" href="#version-control-applications-with-git" id="id39">Version Control Applications with Git</a></li>
<li><a class="reference internal" href="#alternatives-to-cmsis-nvic-c" id="id40">Alternatives to <code class="docutils literal notranslate"><span class="pre">cmsis_nvic.c</span></code></a></li>
<li><a class="reference internal" href="#inverted-pin-value-on-nrf52-dk" id="id41">Inverted Pin Value on nRF52-DK</a></li>
<li><a class="reference internal" href="#documentation-on-correct-values-for-ble-gap-disc-params" id="id42">Documentation on Correct Values for <code class="docutils literal notranslate"><span class="pre">ble_gap_disc_params</span></code></a></li>
<li><a class="reference internal" href="#time-precision-on-nrf52" id="id43">Time Precision on nRF52</a></li>
<li><a class="reference internal" href="#multicast-messaging-and-group-messaging" id="id44">Multicast Messaging and Group Messaging</a></li>
<li><a class="reference internal" href="#difference-between-compiler-yml-vs-pkg-yml" id="id45">Difference between <code class="docutils literal notranslate"><span class="pre">compiler.yml</span></code> vs. <code class="docutils literal notranslate"><span class="pre">pkg.yml</span></code></a></li>
<li><a class="reference internal" href="#drivers-in-mynewt" id="id46">Drivers in Mynewt</a></li>
<li><a class="reference internal" href="#reduce-code-size-for-mynewt-image" id="id47">Reduce Code Size for Mynewt Image</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="bluetooth">
<h2><a class="toc-backref" href="#id1">Bluetooth</a><a class="headerlink" href="#bluetooth" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="nimble-on-nrf52840">
<h3><a class="toc-backref" href="#id2">NimBLE on nRF52840</a><a class="headerlink" href="#nimble-on-nrf52840" title="Permalink to this headline">Â¶</a></h3>
<p><strong>Q</strong>: Is the nRF52840 supported by NimBLE?</p>
<p><strong>A</strong>: The nRF52840 is supported, including Bluetooth 5 features.</p>
</div>
<div class="section" id="trigger-exactly-one-ble-advertisement-immediately">
<h3><a class="toc-backref" href="#id3">Trigger Exactly One BLE Advertisement Immediately</a><a class="headerlink" href="#trigger-exactly-one-ble-advertisement-immediately" title="Permalink to this headline">Â¶</a></h3>
<p><strong>Q</strong>: Is there a way to trigger exactly one BLE advertisement immediately? I basically want to use BLE as a means to advertise to a whole group of devices and it needs to be relatively time-precise. Hoping for about 1ms precision, but itâs okay if thereâs a delay as long as itâs deterministic.</p>
<p><strong>A</strong>: With extended advertising you can enable an advertising instance for exactly 1 advertising event but there will be some delay before controller starts advertising which depends on the level of precision. The NimBLE controller always schedules the 1st advertising event with a constant 5ms delay. However, if there are other things scheduled in the controller it may need to schedule it later so itâs not guaranteed to be deterministic. Periodic advertising is currently not supported.</p>
</div>
<div class="section" id="supported-bluetooth-radio-transceivers">
<h3><a class="toc-backref" href="#id4">Supported Bluetooth Radio Transceivers</a><a class="headerlink" href="#supported-bluetooth-radio-transceivers" title="Permalink to this headline">Â¶</a></h3>
<p><strong>Q</strong>: Are there any other Bluetooth radio transceivers that are supported already or anyone working on? If there is a Bluetooth radio that can be integrated using the HCI, we can use the NimBLE host? If so, I suppose we donât need detailed specs of the Bluetooth radio?</p>
<p><strong>A</strong>: You should be able to run the NimBLE host against pretty much any controller using HCI. We have a BLE controller implementation for Nordic only, but host (in theory) should work with all. More likely, it will work with 5.0 controller. For 4.x controllers it may fail on initialization since we do not check controller features - but this can be fixed as for other radio transceivers. For example, thereâs NXP KW41Z which has BLE-compatible radio documented. However, NXP documentation is more or less a description of zillions of different registers so not as friendly as the one from Nordic which explains how to actually use it.</p>
</div>
<div class="section" id="nimble-operational-questions">
<h3><a class="toc-backref" href="#id5">NimBLE Operational Questions</a><a class="headerlink" href="#nimble-operational-questions" title="Permalink to this headline">Â¶</a></h3>
<p><strong>Q</strong>: Can I update firmware via BLE for multiple devices simultaneously using a single device/phone supporting Bluetooth?</p>
<p><strong>A</strong>: Yes, it is possible to update several Nimble devices simultaneously from a single phone (e.g., central) as long as the central can handle all the simultaneous Bluetooth connections. You can also do it using your computer as a central with newtmgr.  Just open two terminals and initiate a newtmgr image upload command in each, each to a different device.  You will, however, get better overall throughput if you limit yourself to one upgrade at a time.</p>
<p><strong>Q</strong>: I have the following doubts on NimBLE: The document says 32+ concurrent connections, multiple connections in simultaneous central and peripheral roles. Does that mean the âdevice running NimBLEâ can connect to 32 different other devices like phones?</p>
<p><strong>A</strong>: Yes, with one caveat: each of the 32 centrals needs to be sufficiently cooperative in choosing connection partners (<a class="reference external" href="http://www.novelbits.io/ble-connection-intervals/">http://www.novelbits.io/ble-connection-intervals/</a>). Your app might need to request different connection parameters from the centrals (using <code class="docutils literal notranslate"><span class="pre">ble_gap_update_params</span></code>).</p>
<p>Of course, you will also need to build the Mynewt image device with a configuration suitable for 32 concurrent connections (e.g., <code class="docutils literal notranslate"><span class="pre">NIMBLE_MAX_CONNECTIONS=32</span></code>, etc.)</p>
</div>
<div class="section" id="blemesh-forgets-all-keys-on-restart">
<h3><a class="toc-backref" href="#id6"><code class="docutils literal notranslate"><span class="pre">blemesh</span></code> Forgets All Keys on Restart</a><a class="headerlink" href="#blemesh-forgets-all-keys-on-restart" title="Permalink to this headline">Â¶</a></h3>
<p><strong>Q</strong>: Is it expected that the blemesh example forgets all the keys on restart and needs to be provisioned again? If so, how can I implement key persistence myself? Is there any API to obtain / provide mesh keys before the mesh node is started? I found bt_mesh_provision, but the comment there seems to indicate that this is not the right way to use it.</p>
<p><strong>A</strong>: Mesh implementations do not persist keys at the moment. There is a plan to add it but not sure about timeline. It probably needs to be implemented inside mesh implementation so thereâs no API, but if youâd like to hack something I suggest taking a look at shell.c and testing.c - there are some testing functions to add/display keys. Another area to look if you actually want to persist keys to flash is <code class="docutils literal notranslate"><span class="pre">net/nimble/host/store/config/src/ble_store_config.c</span></code>.  This is the code that persists and restores security material for (non-mesh) Bluetooth.</p>
</div>
<div class="section" id="l2cap-connection">
<h3><a class="toc-backref" href="#id7">L2CAP Connection</a><a class="headerlink" href="#l2cap-connection" title="Permalink to this headline">Â¶</a></h3>
<p><strong>Q</strong>: I want to do an L2CAP connection, and am trying the auth-passkey command, but am not sure about the parameters <code class="docutils literal notranslate"><span class="pre">psm</span></code>, <code class="docutils literal notranslate"><span class="pre">action</span></code>, and <code class="docutils literal notranslate"><span class="pre">oob</span></code>. What is <code class="docutils literal notranslate"><span class="pre">psm</span></code>, and what is the value of that parameter in the btshell command <code class="docutils literal notranslate"><span class="pre">l2cap-connect</span></code>? How do I set the parameters <code class="docutils literal notranslate"><span class="pre">action</span></code> and <code class="docutils literal notranslate"><span class="pre">oob</span></code>?</p>
<p><strong>A</strong>: <code class="docutils literal notranslate"><span class="pre">psm</span></code> stands for Protocol Service Multiplexer. You pass the <code class="docutils literal notranslate"><span class="pre">psm</span></code> value to either <code class="docutils literal notranslate"><span class="pre">l2-cap-connect</span></code> or <code class="docutils literal notranslate"><span class="pre">l2cap-create-server</span></code>. The parameters <code class="docutils literal notranslate"><span class="pre">action</span></code> and <code class="docutils literal notranslate"><span class="pre">oob</span></code> are just passing constant values as defined in the API.</p>
</div>
<div class="section" id="bitbang-ble-mesh-ble-advertising">
<h3><a class="toc-backref" href="#id8">Bitbang, BLE Mesh, BLE Advertising</a><a class="headerlink" href="#bitbang-ble-mesh-ble-advertising" title="Permalink to this headline">Â¶</a></h3>
<p><strong>Q</strong>: Is it possible to run bitbanging and BLE mesh at the same time? How about running BLE Mesh and BLE advertising at the same time?</p>
<p><strong>A</strong>: It is possible to run bitbanging and BLE mesh at the same time, but the bitbanging UART takes a lot of CPU on Nordic. Weâve run it at 9600 which would probably be okay for lower rate devices, but for reliability it is recommended to run at 4800. If this is just for the console and your UART port is tied up, <code class="docutils literal notranslate"><span class="pre">rtt</span></code> is recommended. Visit <a class="reference internal" href="tutorials/tooling/segger_rtt.html"><span class="doc">Segger RTT Console</span></a> for more information. However, bitbanger can be handy given limited UARTs.</p>
<p>You can certainly continue advertisements during connections, if you are using the GATT bearer for mesh. Mesh is also tied into the ext-adv bearer in Mynewt, which also allows for interleaving, even if youâre transmitting mesh data on advertising channels.</p>
</div>
<div class="section" id="extended-advertising-with-btshell">
<h3><a class="toc-backref" href="#id9">Extended Advertising with <code class="docutils literal notranslate"><span class="pre">btshell</span></code></a><a class="headerlink" href="#extended-advertising-with-btshell" title="Permalink to this headline">Â¶</a></h3>
<p><strong>Q</strong>: I am using <code class="docutils literal notranslate"><span class="pre">btshell</span></code> for advertising with nRF52. When I use 31 bytes, <code class="docutils literal notranslate"><span class="pre">mfg_data</span></code> accepts the data with extended advertising. But when I use more bytes than that, <code class="docutils literal notranslate"><span class="pre">mfg_data</span></code> doesnât accept it. Is 251 byte payload supported in extended advertising? How can I send more than a 251 byte payload on extended advertising?</p>
<p><strong>A</strong>: You need to set the <code class="docutils literal notranslate"><span class="pre">BLE_EXT_ADV_MAX_SIZE</span></code> syscfg to your required value. For example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">newt target amend &lt;your_target&gt; syscfg=BLE_EXT_ADV=1:BLE_EXT_ADV_MAX_SIZE=1650</span>
</pre></div>
</div>
<p>The default is 31 bytes, and the max is 1650.</p>
<p>Keep in mind that with extended advertising, you cannot set advertising data for an instance configured as scannable (e.g. <code class="docutils literal notranslate"><span class="pre">advertise-configure</span> <span class="pre">scannable=1</span></code>). Either set scan response data using <code class="docutils literal notranslate"><span class="pre">advertise-set-scan-rsp</span></code> command (parameters are the same as for <code class="docutils literal notranslate"><span class="pre">advertise-set-adv-data</span></code>) or configure the instance as non-scannable. For example, <code class="docutils literal notranslate"><span class="pre">advertise-configure</span></code> alone will configure the instance as non-connectable and non-scannable which means you can set advertising data. Also note that if you continue to use a scannable instance you will need to perform active scanning in order to get scan response data.</p>
<p>FYI, legacy advertising instances can accept both advertising and scan response data but since they use legacy PDUs the limit is still 31 bytes.</p>
</div>
<div class="section" id="configuring-maximum-number-of-connections-for-blehci">
<h3><a class="toc-backref" href="#id10">Configuring Maximum Number of Connections for <code class="docutils literal notranslate"><span class="pre">blehci</span></code></a><a class="headerlink" href="#configuring-maximum-number-of-connections-for-blehci" title="Permalink to this headline">Â¶</a></h3>
<p><strong>Q</strong>: How do I set the maximum number of connections for the <code class="docutils literal notranslate"><span class="pre">blehci</span></code> <a class="reference internal" href="tutorials/ble/blehci_project.html"><span class="doc">example</span></a>? I see there is a <code class="docutils literal notranslate"><span class="pre">MYNEWT_VAL_BLE_MAX_CONNECTIONS</span></code>, but I donât know how to set it.</p>
<p><strong>A</strong>:  You can to set it in target settings:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">newt target amend &lt;target&gt; syscfg=BLE_MAX_CONNECTIONS=2</span>
</pre></div>
</div>
<p>and then rebuild using <code class="docutils literal notranslate"><span class="pre">newt</span> <span class="pre">build</span> <span class="pre">&lt;target&gt;</span></code>. <code class="docutils literal notranslate"><span class="pre">MYNEWT_VAL_BLE_MAX_CONNECTIONS</span></code> is just a symbol that is defined in <code class="docutils literal notranslate"><span class="pre">syscfg.h</span></code> which is autogenerated by <code class="docutils literal notranslate"><span class="pre">newt</span></code> tool and contains all the settings set at package/app/target level.</p>
<p><strong>Q</strong>: What if I need to set 2 constants? Whatâs the syntax?</p>
<p><strong>A</strong>: You can set each setting in separate commands or separate <code class="docutils literal notranslate"><span class="pre">key=value</span></code> pairs with colon:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">newt target amend &lt;target&gt; syscfg=FOO=1:BAR=2</span>
</pre></div>
</div>
<p><strong>Q</strong>: How do you know the constant is <code class="docutils literal notranslate"><span class="pre">BLE_MAX_CONNECTIONS</span></code> and not <code class="docutils literal notranslate"><span class="pre">MYNEWT_VAL_BLE_MAX_CONNECTIONS</span></code>? Is there a place I can see those names?</p>
<p><strong>A</strong>: This is actually one of NimBLEâs settings - you can find these settings available for different packages in the <code class="docutils literal notranslate"><span class="pre">syscfg.yml</span></code> files in the repository. You can also use <code class="docutils literal notranslate"><span class="pre">newt</span> <span class="pre">target</span> <span class="pre">config</span> <span class="pre">show</span> <span class="pre">&lt;target&gt;</span></code> to show all settings with their current values, and then change any of these settings accordingly. Each setting will get a symbol prefixed by <code class="docutils literal notranslate"><span class="pre">MYNEWT_VAL_</span></code> in the autogenerated <code class="docutils literal notranslate"><span class="pre">syscfg.h</span></code> file so you can get the actual setting name from this symbol. For more info on System Configuration and Initialization, please visit the <span class="xref std std-doc">Compile-Time Configuration and Initialization</span> page in the OS User Guide.</p>
</div>
<div class="section" id="disconnect-crash-while-writing-analog-value-from-central-module">
<h3><a class="toc-backref" href="#id11">Disconnect/Crash While Writing Analog Value From Central Module</a><a class="headerlink" href="#disconnect-crash-while-writing-analog-value-from-central-module" title="Permalink to this headline">Â¶</a></h3>
<p><strong>Q</strong>: Iâm trying to write analog sensor data from my central module to my peripheral module. I can receive the values from the ADC callback perfectly, but Iâm not able to write them to the peripheral module. The peripheral module disconnects right when the <code class="docutils literal notranslate"><span class="pre">ble_gattc_write_flat</span></code> command is called. What could be causing the issue?</p>
<p><strong>A</strong>: First, check the reason for the disconnect. The gap event callback should indicate the reason in <code class="docutils literal notranslate"><span class="pre">disconnect.reason</span></code>. If the code never reaches the disconnect callback, then the code most likely crashed. If so, check whether <code class="docutils literal notranslate"><span class="pre">ble_gattc_write_flat</span></code> is called from an interrupt context. Calling into the BLE host from within an interrupt is a bad idea in general, and may cause a crash to occur because the Bluetooth host attempts to log to the console during the write procedure. Logging to the console uses quite a bit of stack space, so it is likely that the interrupt stack is overflowing.</p>
<p>Instead, you should send an event to the event queue and handle this in a task context. Youâll need to associate the characteristic data with the event so that your event callback knows what payload to pass to the <code class="docutils literal notranslate"><span class="pre">ble_gattc_write_flat()</span></code> function. If you donât need to perform multiple writes in rapid succession, then you can just use a single global event and single global buffer. However, you will still need to make sure your buffer doesnât become corrupted by a subsequent ADC interrupt while you are in mid-write.</p>
</div>
</div>
<div class="section" id="bootloader-and-firmware-upgrade">
<h2><a class="toc-backref" href="#id12">Bootloader and Firmware Upgrade</a><a class="headerlink" href="#bootloader-and-firmware-upgrade" title="Permalink to this headline">Â¶</a></h2>
<p><strong>Q</strong>: I wanted to check if the stack provides firmware upgrade capability and if so, is there an example you can provide on how it is being done?</p>
<p><strong>A</strong>: The newtmgr tool is used to upgrade Mynewt devices. Newtmgr is a command line tool, but there are other client libraries available. There is some information listed under the âImage Upgradeâ header in the <a class="reference internal" href="os/modules/split/split.html"><span class="doc">Split Image documentation</span></a>.</p>
<p><strong>Q</strong>: Is there any documentation on using the bootloader? It sounds like it has baked-in support for serial loading, but I canât find any details on serial protocol, or how to do a serial boot load. I assume we set a GPREGRET flag that tells the bootloader to expect to be flashed by serial, then it handles the rest. Is that true?</p>
<p><strong>A</strong>: The serial bootloader would inspect a GPIO to see whether to wait for image upload commands or not. The protocol is the same newtmgr protocol we use for usual image uploads. For some the state reporting is simplified (omitted), and image upload goes to slot 0 instead of slot 1. The serial bootloading is built into newtmgr. For more information, refer to the documentation on the <a class="reference internal" href="os/modules/bootloader/bootloader.html"><span class="doc">Mynewt bootloader</span></a>.</p>
<p><strong>Q</strong>: Is there any major difference between MCUboot and the Mynewt bootloader?</p>
<p><strong>A</strong>: They use different formats. The header is different as well, since you need to pass an extra flag (e.g. -2 to newt for <code class="docutils literal notranslate"><span class="pre">create-image</span></code>).</p>
<p><strong>Q</strong>: What is the difference between <code class="docutils literal notranslate"><span class="pre">boot_serial</span></code> and <code class="docutils literal notranslate"><span class="pre">bootutil</span></code>?</p>
<p><strong>A</strong>: <code class="docutils literal notranslate"><span class="pre">boot_serial</span></code> is used only for downloading images over the serial port. If you are using newtmgr to upload image over serial, it is handled in <code class="docutils literal notranslate"><span class="pre">boot_serial</span></code>. All other bootloader code is in <code class="docutils literal notranslate"><span class="pre">bootutil</span></code>.</p>
</div>
<div class="section" id="file-system">
<h2><a class="toc-backref" href="#id13">File System</a><a class="headerlink" href="#file-system" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="nffs-setup">
<h3><a class="toc-backref" href="#id14"><code class="docutils literal notranslate"><span class="pre">nffs</span></code> Setup</a><a class="headerlink" href="#nffs-setup" title="Permalink to this headline">Â¶</a></h3>
<p><strong>Q</strong>: Iâm struggling to find any examples for <code class="docutils literal notranslate"><span class="pre">nffs</span></code>, especially how do I setup the <code class="docutils literal notranslate"><span class="pre">nffs_area_desc</span></code> correctly. Where do I set it up in the BSP especially?</p>
<p><strong>A</strong>: Itâs all taken care of in <code class="docutils literal notranslate"><span class="pre">nffs_pkg_init</span></code>. As long as the <code class="docutils literal notranslate"><span class="pre">nffs</span></code> package is included in the project, it should initialize itself.  A few things you might find helpful:</p>
<ol class="arabic simple">
<li>The <code class="docutils literal notranslate"><span class="pre">NFFS_FLASH_AREA</span></code> syscfg setting specifies the flash area that contains the file system.</li>
<li>The BSPâs <code class="docutils literal notranslate"><span class="pre">bsp.yml</span></code> file defines all the flash areas in the system, including the one specified in â1.â above.</li>
</ol>
</div>
</div>
<div class="section" id="nfc">
<h2><a class="toc-backref" href="#id15">NFC</a><a class="headerlink" href="#nfc" title="Permalink to this headline">Â¶</a></h2>
<p>The NFC stack is work in progress.</p>
</div>
<div class="section" id="newt">
<h2><a class="toc-backref" href="#id16">Newt</a><a class="headerlink" href="#newt" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="difference-between-newt-commands-install-upgrade-and-sync">
<h3><a class="toc-backref" href="#id17">Difference Between <code class="docutils literal notranslate"><span class="pre">newt</span></code> Commands <code class="docutils literal notranslate"><span class="pre">install</span></code>, <code class="docutils literal notranslate"><span class="pre">upgrade</span></code>, and <code class="docutils literal notranslate"><span class="pre">sync</span></code></a><a class="headerlink" href="#difference-between-newt-commands-install-upgrade-and-sync" title="Permalink to this headline">Â¶</a></h3>
<p><strong>Q</strong>: Whatâs the difference between <code class="docutils literal notranslate"><span class="pre">newt</span> <span class="pre">install</span></code>, <code class="docutils literal notranslate"><span class="pre">newt</span> <span class="pre">upgrade</span></code>, and <code class="docutils literal notranslate"><span class="pre">newt</span> <span class="pre">sync</span></code>?</p>
<p><strong>A</strong>:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">newt</span> <span class="pre">install</span></code>: downloads repos that arenât installed yet.  The downloaded version matches what <code class="docutils literal notranslate"><span class="pre">project.yml</span></code> specifies.</li>
<li><code class="docutils literal notranslate"><span class="pre">newt</span> <span class="pre">upgrade</span></code>: performs an install, but also applies to repos that are already installed.</li>
<li><code class="docutils literal notranslate"><span class="pre">newt</span> <span class="pre">sync</span></code>: fetches and pulls the latest for each repo, but does not change the branch (version).</li>
</ul>
</div>
<div class="section" id="newt-size-command-vs-elf-file-size">
<h3><a class="toc-backref" href="#id18"><code class="docutils literal notranslate"><span class="pre">newt</span> <span class="pre">size</span></code> Command vs. Elf File Size</a><a class="headerlink" href="#newt-size-command-vs-elf-file-size" title="Permalink to this headline">Â¶</a></h3>
<p><strong>Q</strong>: I did a test build of blinky for nrf52 and got an elf-file of size 295424 bytes. If I use the newt size command for the application it says something like: 18764 bytes. What does this mean?</p>
<p><strong>A</strong>: Elfs have a lot of extra information. newt size will show the are in flash that is used which better matches the <code class="docutils literal notranslate"><span class="pre">blinky.elf.bin</span></code> file. Try <code class="docutils literal notranslate"><span class="pre">running</span> <span class="pre">newt</span> <span class="pre">-ldebug</span> <span class="pre">build</span> <span class="pre">-v</span> <span class="pre">&lt;your-target&gt;</span></code> and you will see something like this:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">arm-none-eabi-objcopy -R .bss -R .bss.core -R .bss.core.nz -O binary ...</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="newtmgr">
<h2><a class="toc-backref" href="#id19">Newtmgr</a><a class="headerlink" href="#newtmgr" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="connection-profile-using-newtmgr">
<h3><a class="toc-backref" href="#id20">Connection Profile using newtmgr</a><a class="headerlink" href="#connection-profile-using-newtmgr" title="Permalink to this headline">Â¶</a></h3>
<p><strong>Q</strong>: Iâm trying to connect to an Adafruit nRF52 Feather Pro running Mynewt via the newtmgr tool on MacOS.  I have the device powered via micro USB to my Mac.  How do I find the âconnection profileâ of the device so I can connect to it? I want to communicate over BLE and not serial.</p>
<p><strong>A</strong>: A connection profile tells newtmgr how to communicate with your device. You can create one using the <code class="docutils literal notranslate"><span class="pre">newtmgr</span> <span class="pre">conn</span> <span class="pre">add</span></code> command. Try talking to your device without a connection profile first. If that works, you can create a profile to make it easier to communicate with the device going forward.</p>
<p>For BLE, you can send an echo command to your device with something like this:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">newtmgr --conntype ble --connstring peer_name=nimble-bleprph echo Hello</span>
</pre></div>
</div>
<p>That <code class="docutils literal notranslate"><span class="pre">peer_name</span> <span class="pre">string</span></code> is correct if your device is running the <code class="docutils literal notranslate"><span class="pre">bleprph</span></code> app.  Youâll need to adjust it if your device has a different BLE name. The <code class="docutils literal notranslate"><span class="pre">--conntype</span> <span class="pre">ble</span> <span class="pre">--connstring</span> <span class="pre">peer_name=nimble-bleprph</span></code> part is what would go in a connection profile. If you create one, then you can just specify the profileâs name rather than typing that long string each time you send a command.</p>
</div>
<div class="section" id="nmp">
<h3><a class="toc-backref" href="#id21">NMP</a><a class="headerlink" href="#nmp" title="Permalink to this headline">Â¶</a></h3>
<p><strong>Q</strong>: What does NMP stand for?</p>
<p><strong>A</strong>: Newtmgr Management Protocol</p>
</div>
<div class="section" id="newtmgr-with-the-adafruit-nrf52dk">
<h3><a class="toc-backref" href="#id22">Newtmgr with the Adafruit nRF52DK</a><a class="headerlink" href="#newtmgr-with-the-adafruit-nrf52dk" title="Permalink to this headline">Â¶</a></h3>
<p><strong>Q</strong>: Iâm having issues using Newt Manager with the Adafruit nRF52DK. What do I do?</p>
<p>You can specify the reduced MTU by adding <code class="docutils literal notranslate"><span class="pre">mtu=128</span></code> to your connection string. The reason for this change is that MTU is the serial boot loader used to have a smaller receive buffer (128 bytes). The newtmgr tool sends larger image chunks by default, so specifying the MTU will reduce the image size.</p>
<dl class="docutils">
<dt><strong>A</strong>: There are two things you will need to do to fix any issues you encounter when working with the Adafruit nRF52DK and Newt Manager:</dt>
<dd>You can specify the reduced MTU by adding <code class="docutils literal notranslate"><span class="pre">mtu=128</span></code> to your connection string. The reason for this change is that MTU is the serial boot loader used to have a smaller receive buffer (128 bytes). The newtmgr tool sends larger image chunks by default, so specifying the MTU will reduce the image size.</dd>
</dl>
<p>1. Specify a reduced MTU:
You can specify the reduced MTU by adding <code class="docutils literal notranslate"><span class="pre">mtu=128</span></code> to your connection string. The reason for this change is that MTU is the serial boot loader used to have a smaller receive buffer (128 bytes). The newtmgr tool sends larger image chunks by default, so specifying the MTU will reduce the image size.</p>
<p>2. Indicate that the existing image should not be erased:
This is accomplished with the <code class="docutils literal notranslate"><span class="pre">-e</span></code> command line option. Your command line should look similar to the following:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> newtmgr --conntype serial --connextra <span class="s1">&#39;dev=/dev/ttyUSB0,mtu=128&#39;</span> image upload -e &lt;image-path&gt;
</pre></div>
</div>
<p>This change is needed because the serial boot loader doesnât support the standalone âerase imageâ command - as a result, it drops the request. The newtmgr image upload command starts by sending an erase command, then times out when it doesnât receive a response. The older version of newtmgr would use smaller chunk size for images, and it did not send the standalone erase command. When newtmgr was changed in versions 1.2 and 1.3, the serial boot loader changed along with it. The latest newtmgr is not compatible with an older version of the boot loader (which your board will probably ship with) without the above workarounds.</p>
</div>
</div>
<div class="section" id="porting-mynewt">
<h2><a class="toc-backref" href="#id23">Porting Mynewt</a><a class="headerlink" href="#porting-mynewt" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="porting-mynewt-to-core-m3-mcu">
<h3><a class="toc-backref" href="#id24">Porting Mynewt to Core-M3 MCU</a><a class="headerlink" href="#porting-mynewt-to-core-m3-mcu" title="Permalink to this headline">Â¶</a></h3>
<p><strong>Q</strong>: I have a weird OS tick issue with a Core-M3 MCU port. The tick rate is set up identically to most ARM MCUs by setting up a hardware interrupt to trigger SysClock / <code class="docutils literal notranslate"><span class="pre">os_tick_per_sec</span></code>. SysClock is correct and <code class="docutils literal notranslate"><span class="pre">os_tick_per_sec</span></code> is set to 1000, but the tick rate seems to be significantly higher. What am I doing wrong?</p>
<p><strong>A</strong>: Check whether the LED is actually staying on or it is flickering really fast by debugging through the loop. If it is staying on, you may be getting into an <code class="docutils literal notranslate"><span class="pre">assert()</span></code>. Otherwise, it is due to the fact that the OS timer wasnât created, which is done by <code class="docutils literal notranslate"><span class="pre">hal_bsp.c</span></code>. The OS timer needs a hardware timer to be running, so you will need to call <code class="docutils literal notranslate"><span class="pre">hal_timer_init</span></code> for timer 0 at one point.</p>
</div>
</div>
<div class="section" id="mynewt-syntax-and-semantics">
<h2><a class="toc-backref" href="#id25">Mynewt Syntax and Semantics</a><a class="headerlink" href="#mynewt-syntax-and-semantics" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="ending-the-delay-of-a-task-blocking-a-call-early">
<h3><a class="toc-backref" href="#id26">Ending the Delay of a Task Blocking a Call Early</a><a class="headerlink" href="#ending-the-delay-of-a-task-blocking-a-call-early" title="Permalink to this headline">Â¶</a></h3>
<p><strong>Q</strong>: I have a task which is blocking on a call to <code class="docutils literal notranslate"><span class="pre">os_time_delay()</span></code>. What is the recommended way to end the delay early in an ISR (e.g. button press)?</p>
<p><strong>A</strong>: The best way would be to use a semaphore. Initialize the semaphore with a count of 0 (<code class="docutils literal notranslate"><span class="pre">os_sem_init()</span></code>), then block on the semaphore with the maximum delay you want to wait for (<code class="docutils literal notranslate"><span class="pre">os_sem_pend()</span></code>).  The button press event would wake the first task up early by calling <code class="docutils literal notranslate"><span class="pre">os_sem_release()</span></code>.</p>
</div>
<div class="section" id="random-function-device">
<h3><a class="toc-backref" href="#id27">Random Function / Device</a><a class="headerlink" href="#random-function-device" title="Permalink to this headline">Â¶</a></h3>
<p><strong>Q</strong>: Does Mynewt have a random function or random device?</p>
<p><strong>A</strong>: <code class="docutils literal notranslate"><span class="pre">baselibc</span></code> has <code class="docutils literal notranslate"><span class="pre">rand()</span></code>, and <code class="docutils literal notranslate"><span class="pre">crypto/tinycrypt</span></code> has <code class="docutils literal notranslate"><span class="pre">hmac-prng</span></code>.</p>
</div>
<div class="section" id="setting-serial-and-mfghash">
<h3><a class="toc-backref" href="#id28">Setting <code class="docutils literal notranslate"><span class="pre">serial</span></code> and <code class="docutils literal notranslate"><span class="pre">mfghash</span></code></a><a class="headerlink" href="#setting-serial-and-mfghash" title="Permalink to this headline">Â¶</a></h3>
<p><strong>Q</strong>: What is <code class="docutils literal notranslate"><span class="pre">mfghash</span></code>? How do I set <code class="docutils literal notranslate"><span class="pre">serial</span></code> and <code class="docutils literal notranslate"><span class="pre">mfghash</span></code> (currently blank in my app)?</p>
<p><strong>A</strong>: <code class="docutils literal notranslate"><span class="pre">mfghash</span></code> is computed if youâre using <code class="docutils literal notranslate"><span class="pre">newt</span> <span class="pre">mfg</span></code> to construct your flash image, and it identifies the build of your bootloader. <code class="docutils literal notranslate"><span class="pre">newt</span> <span class="pre">mfg</span></code> bundles togetherthe bootloader, target image, and other data youâd want to bundle when creating an image to burn to flash. See the <code class="docutils literal notranslate"><span class="pre">newt</span> <span class="pre">mfg</span></code> <span class="xref std std-doc">documentation</span> for the construction side of things and <code class="docutils literal notranslate"><span class="pre">apache-mynewt-core/sys/mfg/src/mfg.c</span></code> for the firmware side. <code class="docutils literal notranslate"><span class="pre">serial</span></code> was intended to be used if you want to have your own naming scheme per device when building products; i.e. you want something other than the mcu serial number, or if you donât have serial number available.</p>
</div>
<div class="section" id="leading-zeros-format-in-printf">
<h3><a class="toc-backref" href="#id29">Leading Zeros Format in <code class="docutils literal notranslate"><span class="pre">printf</span></code></a><a class="headerlink" href="#leading-zeros-format-in-printf" title="Permalink to this headline">Â¶</a></h3>
<p><strong>Q</strong>: Is there a way to make printf and console_printf honor the leading zeroes format? As in:</p>
<p><code class="docutils literal notranslate"><span class="pre">console_printf(&quot;%.2d&quot;,</span> <span class="pre">5);</span></code></p>
<p>outputting â05â instead of as for me now: â2dâ ?</p>
<p><strong>A</strong>: <code class="docutils literal notranslate"><span class="pre">console_printf(&quot;%02d&quot;,</span> <span class="pre">5);</span></code></p>
</div>
<div class="section" id="mynewt-equivalent-of-unix-sleep-3">
<h3><a class="toc-backref" href="#id30">Mynewt Equivalent of UNIX <code class="docutils literal notranslate"><span class="pre">sleep(3)</span></code></a><a class="headerlink" href="#mynewt-equivalent-of-unix-sleep-3" title="Permalink to this headline">Â¶</a></h3>
<p><strong>Q</strong>: Is there an equivalent to the UNIX sleep(3)?</p>
<p><strong>A</strong>: <code class="docutils literal notranslate"><span class="pre">os_time_delay(OS_TICKS_PER_SEC</span> <span class="pre">*</span> <span class="pre">secs)</span></code></p>
</div>
</div>
<div class="section" id="modules-in-mynewt">
<h2><a class="toc-backref" href="#id31">Modules in Mynewt</a><a class="headerlink" href="#modules-in-mynewt" title="Permalink to this headline">Â¶</a></h2>
<p><strong>Q</strong>: Can you tell me what the purpose of the module argument is in the Mynewt logging library? It looks like it just takes an int. Is this just to assign an integer ID for each module that logs?</p>
<p><strong>A</strong>: It is just an integer which accompanies each log entry.  It provides context for each log entry, and it allows a client to filter messages based on module (e.g. âgive me all the file system log entriesâ).</p>
<p><strong>Q</strong>: So, what is the conceptual difference between a log name, and a module number? It seems like a log type would be assigned the same name as the module that is using it, and that the module number is just a numerical ID for the module. Basically, I donât understand what the purpose of storing the name into the log type is, and passing the module number in as part of <code class="docutils literal notranslate"><span class="pre">LOG_&lt;LEVEL&gt;</span></code> macro.</p>
<p><strong>A</strong>: A log just represents a medium or region of storage (e.g., âconsoleâ, or âflash circular buffer in 12kB of flash, starting at 0x0007d000â).  Many parts of the system can write to the same log, so you may end up with Bluetooth, file system, and kernel scheduler entries all in the same log.  The module ID distinguishes these entries from one another. You can control level per module, so you can say, âgive me all bluetooth warnings, but only give me system level errorsâ.</p>
<p><strong>Q</strong>: Okay, so for something like console logging, we would likely register one log for the entire application, and give each module an ID?</p>
<p><strong>A</strong>: I think the thought is that would be the debug log, and during development you could pipe that to console. In production, that might go in the spare image slot. Iâm not sure if we support it yet, but we should make sure the log can write to multiple handlers at the same time.</p>
</div>
<div class="section" id="troubleshooting">
<h2><a class="toc-backref" href="#id32">Troubleshooting</a><a class="headerlink" href="#troubleshooting" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="error-unsatisfied-apis-detected">
<h3><a class="toc-backref" href="#id33">Error: Unsatisfied APIs detected</a><a class="headerlink" href="#error-unsatisfied-apis-detected" title="Permalink to this headline">Â¶</a></h3>
<p><strong>Q</strong>: I ran into the following error message:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Error: Unsatisfied APIs detected:</span>
<span class="go">* stats, required by: hw/drivers/sensors/bmp280, hw/drivers/sensors/ms5837, net/oic</span>
</pre></div>
</div>
<p>How do I resolve this?</p>
<p><strong>A</strong>: You may be missing some package dependencies in your <code class="docutils literal notranslate"><span class="pre">pkg.yml</span></code> file. In this case, you need to include <code class="docutils literal notranslate"><span class="pre">sys/stats</span></code> (either <code class="docutils literal notranslate"><span class="pre">sys/stats/full</span></code> or <code class="docutils literal notranslate"><span class="pre">sys/stats/stub</span></code>) to your <code class="docutils literal notranslate"><span class="pre">pkg.yml</span></code> file. You can add it to either your appâs or targetâs pkg.yml file, but if you have a custom app it is recommended that you add it to your appâs <code class="docutils literal notranslate"><span class="pre">pkg.yml</span></code>. That way you can have multiple targets for the same app, without having to add it to every target. Moreover, if you share your app package, others wonât run into the same error when building it.</p>
</div>
<div class="section" id="greyed-out-files-on-ios-11">
<h3><a class="toc-backref" href="#id34">Greyed out files on iOS 11</a><a class="headerlink" href="#greyed-out-files-on-ios-11" title="Permalink to this headline">Â¶</a></h3>
<p><strong>Q</strong>: Iâm trying to use the Adafruit Mynewt Manager to upload a custom image over BLE. Uploading one of the provided <code class="docutils literal notranslate"><span class="pre">bleuartx000.img</span></code> works fine and I can boot into them, confirm etc. However, when I try to upload a custom image I canât even seem to add it to the app. Images stored in the iCloud drive just appear as disabled icons. Anyone with a clue as to how to get that working?</p>
<p><strong>A</strong>: The new iOS version no longer allows files with unrecognized extensions to be selected. Try renaming the file to something more compatible (e.g. .txt).</p>
</div>
<div class="section" id="arm-none-eabi-gcc-build-error-for-project">
<h3><a class="toc-backref" href="#id35"><code class="docutils literal notranslate"><span class="pre">arm-none-eabi-gcc</span></code> Build Error for Project</a><a class="headerlink" href="#arm-none-eabi-gcc-build-error-for-project" title="Permalink to this headline">Â¶</a></h3>
<p><strong>Q</strong>: I am having this error when I try to build my project:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Building target targets/stm32l072czy6tr_boot</span>
<span class="go">Error: exec: &quot;arm-none-eabi-gcc&quot;: executable file not found in $PATH</span>
</pre></div>
</div>
<p>How do I add it?</p>
<p><strong>A</strong>: First, install the GNU Arm Embedded Toolchain if you havenât already. Then, depending on your OS, add the link to your <code class="docutils literal notranslate"><span class="pre">arm-none-eabi-gcc</span></code> executable path to your PATH environment variable.</p>
</div>
<div class="section" id="issues-running-image-on-boot">
<h3><a class="toc-backref" href="#id36">Issues Running Image on Boot</a><a class="headerlink" href="#issues-running-image-on-boot" title="Permalink to this headline">Â¶</a></h3>
<p><strong>Q</strong>: I was able to successfully create a BSP for my custom board (using nRF52 MCU), then build and run that image in the debugger. However, it does not run on boot. Any ideas to fix the issue?</p>
<p><strong>A</strong>: A good process in general is to do a full flash erase, then flash the bootloader and the running image. Make sure to dump the contents of flash and see that it actually gets written there as well. If you experience the issue again after a reboot, you will also want to set <code class="docutils literal notranslate"><span class="pre">MCU_DCDC_ENABLED:0</span></code> then redo the process of erase, rebuild, and reload.</p>
</div>
</div>
<div class="section" id="miscellaneous">
<h2><a class="toc-backref" href="#id37">Miscellaneous</a><a class="headerlink" href="#miscellaneous" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="enable-trace-in-mynewt">
<h3><a class="toc-backref" href="#id38">Enable Trace in Mynewt</a><a class="headerlink" href="#enable-trace-in-mynewt" title="Permalink to this headline">Â¶</a></h3>
<p><strong>Q</strong>: Iâm trying to use gdb with Trace, but do not know how to enable it. How do I do this in Mynewt?</p>
<p><strong>A</strong>: To enable Trace, you can add <code class="docutils literal notranslate"><span class="pre">cflags</span></code> to <code class="docutils literal notranslate"><span class="pre">pkg.yml</span></code> in your target directory:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">~/dev/mynewt $ cat targets/mytarget/pkg.yml</span>
<span class="gp">#</span><span class="c1">## Package: targets/mytarget</span>
<span class="go">pkg.name: âtargets/mytargetâ</span>
<span class="go">pkg.type: &quot;target&quot;</span>
<span class="go">pkg.description:</span>
<span class="go">pkg.author:</span>
<span class="go">pkg.homepage:</span>
<span class="go">â</span>
<span class="go">pkg.cflags:</span>
<span class="go">  - -DENABLE_TRACE</span>
</pre></div>
</div>
</div>
<div class="section" id="version-control-applications-with-git">
<h3><a class="toc-backref" href="#id39">Version Control Applications with Git</a><a class="headerlink" href="#version-control-applications-with-git" title="Permalink to this headline">Â¶</a></h3>
<p><strong>Q</strong>: Whatâs the recommended way to work with git when you want to version control your application? As <code class="docutils literal notranslate"><span class="pre">apache-mynewt-core</span></code> is already a repository, there is a repo in repo problem. Are there any good alternatives/tools to submodules, mirror, etc? Ideally, I want to version control everything from the top level project directory as well as upgrading apache-mynewt-core, pushing pull requests back to Mynewt if needed, etc.</p>
<p><strong>A</strong>: You can simply have a separate git for your app. For example, if you followed the Blinky tutorial, your git would be in <code class="docutils literal notranslate"><span class="pre">apps/foo</span></code>, while repos gits are in repos. You may also keep your app in the core repo, just have your own working branch for it.</p>
<p>Another option is to have your git repository with local packages (including apps) and have <code class="docutils literal notranslate"><span class="pre">repository.yml</span></code> there so <code class="docutils literal notranslate"><span class="pre">newt</span> <span class="pre">install</span></code> can download all dependencies. Just make sure to put e.g. <code class="docutils literal notranslate"><span class="pre">bin</span></code>, <code class="docutils literal notranslate"><span class="pre">repos</span></code>, and <code class="docutils literal notranslate"><span class="pre">project.state</span></code>, and others in <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code> so they are not in version control.</p>
</div>
<div class="section" id="alternatives-to-cmsis-nvic-c">
<h3><a class="toc-backref" href="#id40">Alternatives to <code class="docutils literal notranslate"><span class="pre">cmsis_nvic.c</span></code></a><a class="headerlink" href="#alternatives-to-cmsis-nvic-c" title="Permalink to this headline">Â¶</a></h3>
<p><strong>Q</strong>: What do I use instead of the full version of <code class="docutils literal notranslate"><span class="pre">cmsis_nvic.c</span></code> (i.e. for setting and getting irq priorities)?</p>
<p><strong>A</strong>: Those functions are in the <code class="docutils literal notranslate"><span class="pre">core_cmx.h</span></code> files in <code class="docutils literal notranslate"><span class="pre">hw/cmsis-core</span></code>.</p>
</div>
<div class="section" id="inverted-pin-value-on-nrf52-dk">
<h3><a class="toc-backref" href="#id41">Inverted Pin Value on nRF52-DK</a><a class="headerlink" href="#inverted-pin-value-on-nrf52-dk" title="Permalink to this headline">Â¶</a></h3>
<p><strong>Q</strong>: Iâve been experiencing what seems to be some oddities with <code class="docutils literal notranslate"><span class="pre">hal_gpio_write</span></code>. It appears as though the LED pin value on the nRF52-DK is inverted (0 sets the pin high, 1 sets it low). I am checking the GPIO state by turning an LED on and off. Why is this the case?</p>
<p><strong>A</strong>: LEDs on the nRF52-DK are connected to VDD and GPIO so you need to set GPIO to a low state in order to make it turn on.</p>
</div>
<div class="section" id="documentation-on-correct-values-for-ble-gap-disc-params">
<h3><a class="toc-backref" href="#id42">Documentation on Correct Values for <code class="docutils literal notranslate"><span class="pre">ble_gap_disc_params</span></code></a><a class="headerlink" href="#documentation-on-correct-values-for-ble-gap-disc-params" title="Permalink to this headline">Â¶</a></h3>
<p><strong>Q</strong>: Is there documentation somewhere on correct values for <code class="docutils literal notranslate"><span class="pre">ble_gap_disc_params</span></code>? Iâm trying to do a passive discovery and getting <code class="docutils literal notranslate"><span class="pre">BLE_HS_EINVAL</span></code>.</p>
<p><strong>A</strong>: Unfortunately, not at the moment. Here is a brief description of the fields:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">itvl</span></code>: This is defined as the time interval from when the Controller started its last LE scan until it begins the subsequent LE scan. (units=0.625 msec)</li>
<li><code class="docutils literal notranslate"><span class="pre">window</span></code>: The duration of the LE scan. <code class="docutils literal notranslate"><span class="pre">LE_Scan_Window</span></code> shall be less than or equal to <code class="docutils literal notranslate"><span class="pre">LE_Scan_Interval</span></code> (units=0.625 msec)</li>
<li><code class="docutils literal notranslate"><span class="pre">filter_policy</span></code>: The only useful documentation is the table in the Bluetooth spec (section 2.E.7.8.10).  This field controls which types of devices to listen for.</li>
<li><code class="docutils literal notranslate"><span class="pre">limited</span></code>: If set, only discover devices in limited discoverable mode.</li>
<li><code class="docutils literal notranslate"><span class="pre">passive</span></code>: If set, donât send scan requests to advertisers (i.e., donât request additional advertising data).</li>
<li><code class="docutils literal notranslate"><span class="pre">filter_duplicates</span></code>: If set, the controller ignores all but the first advertisement from each device.</li>
</ul>
</div>
<div class="section" id="time-precision-on-nrf52">
<h3><a class="toc-backref" href="#id43">Time Precision on nRF52</a><a class="headerlink" href="#time-precision-on-nrf52" title="Permalink to this headline">Â¶</a></h3>
<p><strong>Q</strong>: Can <code class="docutils literal notranslate"><span class="pre">OS_TICKS_PER_SEC</span></code> be changed per app? Iâm on the nRF52 and I need better time precision than 128Hz.</p>
<p><strong>A</strong>: No, it isnât possible to change the ticks per second for a single app.  That constant is defined to be most efficient for the particular MCU.</p>
<p>If you need precision, the OS tick timer is probably not the right thing to use.  Take a look at <a class="reference internal" href="os/core_os/cputime/os_cputime.html"><span class="doc">CPU Time</span></a> for timer documentation. <code class="docutils literal notranslate"><span class="pre">os_cputime</span></code> has 1MHz frequency by default, and is enabled by default. It is recommended to use this for higher precision applications.</p>
</div>
<div class="section" id="multicast-messaging-and-group-messaging">
<h3><a class="toc-backref" href="#id44">Multicast Messaging and Group Messaging</a><a class="headerlink" href="#multicast-messaging-and-group-messaging" title="Permalink to this headline">Â¶</a></h3>
<p><strong>Q</strong>: Is it possible to send a broadcast message by one of the devices present in the mesh (e.g. broadcast an event which happened)? Something like a push notification instead of continuously polling for it by a client.</p>
<p><strong>A</strong>: It is possible to do so with a publish model. Group address or virtual address should help here, according to the Mesh spec. There is no real documentation on it but you can try it out on our <code class="docutils literal notranslate"><span class="pre">btmesh_shell</span></code> app. There is a <code class="docutils literal notranslate"><span class="pre">shell.c</span></code> file which exposes configuration client which you can use for testing (e.g. you can subscribe to virtual addresses). You can also trigger sending messages to devices. By playing with the <code class="docutils literal notranslate"><span class="pre">dst</span></code> command, you probably should be able to set destination to some group. However, since we do not support the provisioner role, there is a command provision which sets fixed keys so you can create a mesh network out of a couple of nodes without the actual provisioner.</p>
</div>
<div class="section" id="difference-between-compiler-yml-vs-pkg-yml">
<h3><a class="toc-backref" href="#id45">Difference between <code class="docutils literal notranslate"><span class="pre">compiler.yml</span></code> vs. <code class="docutils literal notranslate"><span class="pre">pkg.yml</span></code></a><a class="headerlink" href="#difference-between-compiler-yml-vs-pkg-yml" title="Permalink to this headline">Â¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">compiler.yml</span></code> defines a compiler. <code class="docutils literal notranslate"><span class="pre">pkg.yml</span></code> contains metadata about the package. All packages have a <code class="docutils literal notranslate"><span class="pre">pkg.yml</span></code> file, even compiler packages.</p>
</div>
<div class="section" id="drivers-in-mynewt">
<h3><a class="toc-backref" href="#id46">Drivers in Mynewt</a><a class="headerlink" href="#drivers-in-mynewt" title="Permalink to this headline">Â¶</a></h3>
<p><strong>Q</strong>: Is this a correct assumption about Mynewt, that if there exists no driver implementation for a specific SoC, in <code class="docutils literal notranslate"><span class="pre">hw/drivers/</span></code>, then it is not supported. For instance, there exists a flash driver for <code class="docutils literal notranslate"><span class="pre">at45db</span></code>, this implies that the Nordic nRF52 SoC is not supported at the moment?</p>
<p><strong>A</strong>: <code class="docutils literal notranslate"><span class="pre">at45db</span></code> is SPI, and any SPI would work. You send SPI configuration info when initializing. SPI drivers are below the <code class="docutils literal notranslate"><span class="pre">hw/mcu/</span></code> tree. <code class="docutils literal notranslate"><span class="pre">hw/drivers/pwm</span></code> and <code class="docutils literal notranslate"><span class="pre">hw/drivers/adc</span></code> are SoC specific. In general, drivers are for peripherals that arenât universally supported. Features that all (or nearly all) MCUs support are implemented in the HAL. For example, internal flash support is a HAL feature. Visit the <a class="reference internal" href="os/modules/hal/hal.html"><span class="doc">HAL Documentation</span></a> for more information.</p>
</div>
<div class="section" id="reduce-code-size-for-mynewt-image">
<h3><a class="toc-backref" href="#id47">Reduce Code Size for Mynewt Image</a><a class="headerlink" href="#reduce-code-size-for-mynewt-image" title="Permalink to this headline">Â¶</a></h3>
<p><strong>Q</strong>: How do I reduce the code size for my Mynewt image?</p>
<p><strong>A</strong>: Please refer to the tutorial documentation on <a class="reference internal" href="tutorials/other/codesize.html"><span class="doc">reducing application code size</span></a>.</p>
</div>
</div>
</div>


                   </div>
                  </div>
                  
    <div class="rst-footer-buttons row" role="navigation" aria-label="footer navigation">
      
        <a href="misc/index.html" class="btn btn-neutral float-right" title="Appendix" accesskey="n">Next: Appendix <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="newtmgr/install/prev_releases.html" class="btn btn-neutral" title="Installing Previous Releases of Newtmgr" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous: Installing Previous Releases of Newtmgr</a>
      
    </div>

                </div>
              </div>
            </div>
            <!-- ENDS CONTENT SECTION -->
          </div>
          <!-- ENDS .content -->
        </div>
      </div>
      <footer>
  <div class="container">
    <div class="row">
      <div class="col-xs-12">
          
              <p class="copyright">Apache Mynewt is available under Apache License, version 2.0.</p>
          
      </div>
      <div class="col-xs-12">
          <div class="logos">
              <img src="_static/img/asf_logo_wide_small.png" alt="Apache" title="Apache">
              <small class="footnote">
                Apache Mynewt, Mynewt, Apache, the Apache feather logo, and the Apache Mynewt project logo are either
                registered trademarks or trademarks of the Apache Software Foundation in the United States and other countries.
              </small>
              <a href="https://join.slack.com/mynewt/shared_invite/MTkwMTg1ODM1NTg5LTE0OTYxNzQ4NzQtZTU1YmNhYjhkMg">
                <img src="_static/img/add_to_slack.png" alt="Slack Icon" title="Join our Slack Community" />
              </a>
          </div>
      </div>
    </div>
  </div>
</footer>
    </div>
    <!-- ENDS #wrapper -->

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.3.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/js/bootstrap-3.0.3.min.js"></script>
      <script type="text/javascript" src="_static/js/affix.js"></script>
      <script type="text/javascript" src="_static/js/main.js"></script>

   

  </body>
</html>