<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="http://mynewt.apache.org/os/tutorials/event_queue/">
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>Add task to manage multiple events - Apache Mynewt</title>
        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-72162311-1', 'auto');
            ga('send', 'pageview');
        </script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../../..">Apache Mynewt</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="../../..">Home</a>
                            </li>
                            <li >
                                <a href="../../../quick-start/">Quick Start</a>
                            </li>
                            <li >
                                <a href="../../../about/">About</a>
                            </li>
                            <li >
                                <a href="../../../download/">Download</a>
                            </li>
                            <li >
                                <a href="../../../community/">Community</a>
                            </li>
                            <li >
                                <a href="../../../events/">Events</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Mynewt Documentation <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../introduction/">toc</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Basic Setup</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../get_started/get_started/">toc</a>
</li>
            
<li >
    <a href="../../get_started/docker/">Docker Container Option</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Native install Option</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../get_started/native_tools/">toc</a>
</li>
            
<li >
    <a href="../../../newt/install/newt_mac/">Install Newt on Mac</a>
</li>
            
<li >
    <a href="../../../newt/install/newt_linux/">Install Newt on Linux</a>
</li>
            
<li >
    <a href="../../get_started/cross_tools/">Install Cross Tools for ARM</a>
</li>
    </ul>
  </li>
            
<li >
    <a href="../../get_started/project_create/">Create Your First Project</a>
</li>
    </ul>
  </li>
                                    
<li >
    <a href="../../get_started/vocabulary/">Concepts</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Tutorials</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../tutorials/">toc</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Project Blinky</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../arduino_zero/">Blinky on Arduino Zero</a>
</li>
            
<li >
    <a href="../blinky_primo/">Blinky on Arduino Primo</a>
</li>
            
<li >
    <a href="../olimex/">Blinky on Olimex</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Blinky on STM32F303</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../STM32F303/">toc</a>
</li>
            
<li >
    <a href="../pin-wheel-mods/">Pinwheel Blinky</a>
</li>
    </ul>
  </li>
            
<li >
    <a href="../nRF52/">Blinky on nRF52</a>
</li>
            
<li >
    <a href="../blinky_sram_olimex/">Run Blinky from SRAM, no bootloader</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Work with repositories</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../repo/add_repos/">toc</a>
</li>
            
<li >
    <a href="../repo/upgrade_repo/">Upgrade a repo</a>
</li>
            
<li >
    <a href="../repo/create_repo/">Turn project into a repo</a>
</li>
    </ul>
  </li>
            
<li >
    <a href="../unit_test/">Write a Test Suite for a Package</a>
</li>
            
<li >
    <a href="../air_quality_sensor/">Air-quality Sensor project</a>
</li>
            
<li class="active">
    <a href="./">Add task to manage multiple events</a>
</li>
            
<li >
    <a href="../project-slinky/">Enable remote comms on sim device</a>
</li>
            
<li >
    <a href="../project-target-slinky/">Enable remote comms on STM32 board</a>
</li>
            
<li >
    <a href="../bletiny_project/">BLE app to check stats via console</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">BLE peripheral project</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../bleprph/bleprph-intro/">toc</a>
</li>
            
<li >
    <a href="../bleprph/bleprph-svc-reg/">Service Registration</a>
</li>
            
<li >
    <a href="../bleprph/bleprph-chr-access/">Characteristic Access</a>
</li>
            
<li >
    <a href="../bleprph/bleprph-adv/">Advertising</a>
</li>
            
<li >
    <a href="../bleprph/bleprph-conn/">Connection Callbacks</a>
</li>
    </ul>
  </li>
            
<li >
    <a href="../ibeacon/">BLE iBeacon</a>
</li>
            
<li >
    <a href="../blehci_project/">BLE HCI interface</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">OS User Guide</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../os_user_guide/">toc</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">OS Core</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../core_os/mynewt_os/">toc</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">System-level Functions</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../core_os/os_init/">os_init</a>
</li>
            
<li >
    <a href="../../core_os/os_start/">os_start</a>
</li>
            
<li >
    <a href="../../core_os/os_started/">os_started</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Scheduler</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../core_os/context_switch/context_switch/">toc</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Functions</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../core_os/context_switch/os_sched/">os_sched</a>
</li>
            
<li >
    <a href="../../core_os/context_switch/os_arch_ctx_sw/">os_arch_ctx_sw</a>
</li>
            
<li >
    <a href="../../core_os/context_switch/os_sched_ctx_sw_hook/">os_sched_ctx_sw_hook</a>
</li>
            
<li >
    <a href="../../core_os/context_switch/os_sched_get_current_task/">os_sched_get_current_task</a>
</li>
            
<li >
    <a href="../../core_os/context_switch/os_sched_insert/">os_sched_insert</a>
</li>
            
<li >
    <a href="../../core_os/context_switch/os_sched_next_task/">os_sched_next_task</a>
</li>
            
<li >
    <a href="../../core_os/context_switch/os_sched_os_timer_exp/">os_sched_os_timer_exp</a>
</li>
            
<li >
    <a href="../../core_os/context_switch/os_sched_resort/">os_sched_resort</a>
</li>
            
<li >
    <a href="../../core_os/context_switch/os_sched_set_current_task/">os_sched_set_current_task</a>
</li>
            
<li >
    <a href="../../core_os/context_switch/os_sched_sleep/">os_sched_sleep</a>
</li>
            
<li >
    <a href="../../core_os/context_switch/os_sched_wakeup/">os_sched_wakeup</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Time</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../core_os/time/os_time/">toc</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Functions</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../core_os/time/os_time_delay/">os_time_delay</a>
</li>
            
<li >
    <a href="../../core_os/time/os_time_get/">os_time_get</a>
</li>
            
<li >
    <a href="../../core_os/time/os_time_tick/">os_time_tick</a>
</li>
            
<li >
    <a href="../../core_os/time/os_gettimeofday/">os_gettimeofday</a>
</li>
            
<li >
    <a href="../../core_os/time/os_settimeofday/">os_settimeofday</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Tasks</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../core_os/task/task/">toc</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Functions</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../core_os/task/os_task_count/">os_task_count</a>
</li>
            
<li >
    <a href="../../core_os/task/os_task_info_get_next/">os_task_info_get_next</a>
</li>
            
<li >
    <a href="../../core_os/task/os_task_init/">os_task_init</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Event Queues</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../core_os/event_queue/event_queue/">toc</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Functions</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../core_os/event_queue/os_eventq_get/">os_eventq_get</a>
</li>
            
<li >
    <a href="../../core_os/event_queue/os_eventq_init/">os_eventq_init</a>
</li>
            
<li >
    <a href="../../core_os/event_queue/os_eventq_put/">os_eventq_put</a>
</li>
            
<li >
    <a href="../../core_os/event_queue/os_eventq_remove/">os_eventq_remove</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Semaphores</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../core_os/semaphore/semaphore/">toc</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Functions</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../core_os/semaphore/os_sem_init/">os_sem_init</a>
</li>
            
<li >
    <a href="../../core_os/semaphore/os_sem_pend/">os_sem_pend</a>
</li>
            
<li >
    <a href="../../core_os/semaphore/os_sem_release/">os_sem_release</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Mutexes</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../core_os/mutex/mutex/">toc</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Functions</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../core_os/mutex/os_mutex_init/">os_mutex_init</a>
</li>
            
<li >
    <a href="../../core_os/mutex/os_mutex_pend/">os_mutex_pend</a>
</li>
            
<li >
    <a href="../../core_os/mutex/os_mutex_release/">os_mutex_release</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Memory Pools</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../core_os/memory_pool/memory_pool/">toc</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Functions/Macros</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../core_os/memory_pool/os_memblock_get/">os_memblock_get</a>
</li>
            
<li >
    <a href="../../core_os/memory_pool/os_mempool_init/">os_mempool_init</a>
</li>
            
<li >
    <a href="../../core_os/memory_pool/os_memblock_put/">os_memblock_put</a>
</li>
            
<li >
    <a href="../../core_os/memory_pool/OS_MEMPOOL_BYTES/">OS_MEMPOOL_BYTES</a>
</li>
            
<li >
    <a href="../../core_os/memory_pool/OS_MEMPOOL_SIZE/">OS_MEMPOOL_SIZE</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Heap</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../core_os/heap/heap/">toc</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Functions</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../core_os/heap/os_free/">os_free</a>
</li>
            
<li >
    <a href="../../core_os/heap/os_malloc/">os_malloc</a>
</li>
            
<li >
    <a href="../../core_os/heap/os_realloc/">os_realloc</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Memory Buffers</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">Mbuf</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../core_os/mbuf/mbuf/">toc</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Functions/Macros</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../core_os/mbuf/OS_MBUF_PKTHDR/">OS_MBUF_PKTHDR</a>
</li>
            
<li >
    <a href="../../core_os/mbuf/OS_MBUF_PKTHDR_TO_MBUF/">OS_MBUF_PKTHDR_TO_MBUF</a>
</li>
            
<li >
    <a href="../../core_os/mbuf/OS_MBUF_PKTLEN/">OS_MBUF_PKTLEN</a>
</li>
            
<li >
    <a href="../../core_os/mbuf/OS_MBUF_DATA/">OS_MBUF_DATA</a>
</li>
            
<li >
    <a href="../../core_os/mbuf/OS_MBUF_USRHDR/">OS_MBUF_USRHDR</a>
</li>
            
<li >
    <a href="../../core_os/mbuf/OS_MBUF_USRHDR_LEN/">OS_MBUF_USRHDR_LEN</a>
</li>
            
<li >
    <a href="../../core_os/mbuf/OS_MBUF_LEADINGSPACE/">OS_MBUF_LEADINGSPACE</a>
</li>
            
<li >
    <a href="../../core_os/mbuf/OS_MBUF_TRAILINGSPACE/">OS_MBUF_TRAILINGSPACE</a>
</li>
            
<li >
    <a href="../../core_os/mbuf/os_mbuf_adj/">os_mbuf_adj</a>
</li>
            
<li >
    <a href="../../core_os/mbuf/os_mbuf_append/">os_mbuf_append</a>
</li>
            
<li >
    <a href="../../core_os/mbuf/os_mbuf_concat/">os_mbuf_concat</a>
</li>
            
<li >
    <a href="../../core_os/mbuf/os_mbuf_copydata/">os_mbuf_copydata</a>
</li>
            
<li >
    <a href="../../core_os/mbuf/os_mbuf_copyinto/">os_mbuf_copyinto</a>
</li>
            
<li >
    <a href="../../core_os/mbuf/os_mbuf_dup/">os_mbuf_dup</a>
</li>
            
<li >
    <a href="../../core_os/mbuf/os_mbuf_extend/">os_mbuf_extend</a>
</li>
            
<li >
    <a href="../../core_os/mbuf/os_mbuf_free_chain/">os_mbuf_free_chain</a>
</li>
            
<li >
    <a href="../../core_os/mbuf/os_mbuf_get/">os_mbuf_get</a>
</li>
            
<li >
    <a href="../../core_os/mbuf/os_mbuf_get_pkthdr/">os_mbuf_get_pkthdr</a>
</li>
            
<li >
    <a href="../../core_os/mbuf/os_mbuf_memcmp/">os_mbuf_memcmp</a>
</li>
            
<li >
    <a href="../../core_os/mbuf/os_mbuf_off/">os_mbuf_off</a>
</li>
            
<li >
    <a href="../../core_os/mbuf/os_mbuf_pool_init/">os_mbuf_pool_init</a>
</li>
            
<li >
    <a href="../../core_os/mbuf/os_mbuf_prepend/">os_mbuf_prepend</a>
</li>
            
<li >
    <a href="../../core_os/mbuf/os_mbuf_pullup/">os_mbuf_pullup</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Msys</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../core_os/msys/msys/">toc</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Functions</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../core_os/msys/os_msys_get/">os_msys_get</a>
</li>
            
<li >
    <a href="../../core_os/msys/os_msys_get_pkthdr/">os_msys_get_pkthdr</a>
</li>
            
<li >
    <a href="../../core_os/msys/os_msys_register/">os_msys_register</a>
</li>
            
<li >
    <a href="../../core_os/msys/os_msys_reset/">os_msys_reset</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">MQueue</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../core_os/mqueue/mqueue/">toc</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Functions</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../core_os/mqueue/os_mqueue_init/">os_mqueue_init</a>
</li>
            
<li >
    <a href="../../core_os/mqueue/os_mqueue_get/">os_mqueue_get</a>
</li>
            
<li >
    <a href="../../core_os/mqueue/os_mqueue_put/">os_mqueue_put</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Sanity</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../core_os/sanity/sanity/">toc</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Functions</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../core_os/sanity/os_sanity_check_init/">os_sanity_check_init</a>
</li>
            
<li >
    <a href="../../core_os/sanity/os_sanity_check_register/">os_sanity_check_register</a>
</li>
            
<li >
    <a href="../../core_os/sanity/os_sanity_check_reset/">os_sanity_check_reset</a>
</li>
            
<li >
    <a href="../../core_os/sanity/os_sanity_task_checkin/">os_sanity_task_checkin</a>
</li>
            
<li >
    <a href="../../core_os/sanity/os_sanity_task_init/">os_sanity_task_init</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Callouts</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../core_os/callout/callout/">toc</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Functions</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../core_os/callout/os_callout_func_init/">os_callout_func_init</a>
</li>
            
<li >
    <a href="../../core_os/callout/os_callout_init/">os_callout_init</a>
</li>
            
<li >
    <a href="../../core_os/callout/os_callout_queued/">os_callout_queued</a>
</li>
            
<li >
    <a href="../../core_os/callout/os_callout_reset/">os_callout_reset</a>
</li>
            
<li >
    <a href="../../core_os/callout/os_callout_stop/">os_callout_stop</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Porting to your Platform</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../core_os/porting/port_os/">toc</a>
</li>
            
<li >
    <a href="../../core_os/porting/port_bsp/">BSP Porting</a>
</li>
            
<li >
    <a href="../../core_os/porting/port_mcu/">MCU Porting</a>
</li>
            
<li >
    <a href="../../core_os/porting/port_cpu/">CPU Porting</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Console</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../modules/console/console/">toc</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Functions</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../modules/console/console_blocking_mode/">console_blocking_mode</a>
</li>
            
<li >
    <a href="../../modules/console/console_echo/">console_echo</a>
</li>
            
<li >
    <a href="../../modules/console/console_init/">console_init</a>
</li>
            
<li >
    <a href="../../modules/console/console_is_init/">console_is_init</a>
</li>
            
<li >
    <a href="../../modules/console/console_printf/">console_printf</a>
</li>
            
<li >
    <a href="../../modules/console/console_read/">console_read</a>
</li>
            
<li >
    <a href="../../modules/console/console_write/">console_write</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Shell</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../modules/shell/shell/">toc</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Functions</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../modules/shell/shell_task_init/">shell_task_init</a>
</li>
            
<li >
    <a href="../../modules/shell/shell_cmd_register/">shell_cmd_register</a>
</li>
            
<li >
    <a href="../../modules/shell/shell_nlip_input_register/">shell_nlip_input_register</a>
</li>
            
<li >
    <a href="../../modules/shell/shell_nlip_output/">shell_nlip_output</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Bootloader</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../modules/bootloader/bootloader/">toc</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Functions</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../modules/bootloader/boot_build_status/">boot_build_status</a>
</li>
            
<li >
    <a href="../../modules/bootloader/boot_build_status_one/">boot_build_status_one</a>
</li>
            
<li >
    <a href="../../modules/bootloader/boot_clear_status/">boot_clear_status</a>
</li>
            
<li >
    <a href="../../modules/bootloader/boot_copy_area/">boot_copy_area</a>
</li>
            
<li >
    <a href="../../modules/bootloader/boot_copy_image/">boot_copy_image</a>
</li>
            
<li >
    <a href="../../modules/bootloader/boot_erase_area/">boot_erase_area</a>
</li>
            
<li >
    <a href="../../modules/bootloader/boot_fill_slot/">boot_fill_slot</a>
</li>
            
<li >
    <a href="../../modules/bootloader/boot_find_image_area_idx/">boot_find_image_area_idx</a>
</li>
            
<li >
    <a href="../../modules/bootloader/boot_find_image_part/">boot_find_image_part</a>
</li>
            
<li >
    <a href="../../modules/bootloader/boot_find_image_slot/">boot_find_image_slot</a>
</li>
            
<li >
    <a href="../../modules/bootloader/boot_go/">boot_go</a>
</li>
            
<li >
    <a href="../../modules/bootloader/boot_init_flash/">boot_init_flash</a>
</li>
            
<li >
    <a href="../../modules/bootloader/boot_move_area/">boot_move_area</a>
</li>
            
<li >
    <a href="../../modules/bootloader/boot_read_image_header/">boot_read_image_header</a>
</li>
            
<li >
    <a href="../../modules/bootloader/boot_read_image_headers/">boot_read_image_headers</a>
</li>
            
<li >
    <a href="../../modules/bootloader/boot_read_status/">boot_read_status</a>
</li>
            
<li >
    <a href="../../modules/bootloader/boot_select_image_slot/">boot_select_image_slot</a>
</li>
            
<li >
    <a href="../../modules/bootloader/boot_slot_addr/">boot_slot_addr</a>
</li>
            
<li >
    <a href="../../modules/bootloader/boot_slot_to_area_idx/">boot_slot_to_area_idx</a>
</li>
            
<li >
    <a href="../../modules/bootloader/boot_swap_areas/">boot_swap_areas</a>
</li>
            
<li >
    <a href="../../modules/bootloader/boot_vect_delete_main/">boot_vect_delete_main</a>
</li>
            
<li >
    <a href="../../modules/bootloader/boot_vect_delete_test/">boot_vect_delete_test</a>
</li>
            
<li >
    <a href="../../modules/bootloader/boot_vect_read_main/">boot_vect_read_main</a>
</li>
            
<li >
    <a href="../../modules/bootloader/boot_vect_read_one/">boot_vect_read_one</a>
</li>
            
<li >
    <a href="../../modules/bootloader/boot_vect_read_test/">boot_vect_read_test</a>
</li>
            
<li >
    <a href="../../modules/bootloader/boot_write_status/">boot_write_status</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">File System</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">File System Abstraction</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../modules/fs/fs/fs/">toc</a>
</li>
            
<li >
    <a href="../../modules/fs/fs/fs_return_codes/">Return Codes</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Data Structures</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../modules/fs/fs/fs_ops/">struct fs_ops</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Functions</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../modules/fs/fs/fs_close/">fs_close</a>
</li>
            
<li >
    <a href="../../modules/fs/fs/fs_closedir/">fs_closedir</a>
</li>
            
<li >
    <a href="../../modules/fs/fs/fs_dirent_is_dir/">fs_dirent_is_dir</a>
</li>
            
<li >
    <a href="../../modules/fs/fs/fs_dirent_name/">fs_dirent_name</a>
</li>
            
<li >
    <a href="../../modules/fs/fs/fs_filelen/">fs_filelen</a>
</li>
            
<li >
    <a href="../../modules/fs/fs/fs_getpos/">fs_getpos</a>
</li>
            
<li >
    <a href="../../modules/fs/fs/fs_mkdir/">fs_mkdir</a>
</li>
            
<li >
    <a href="../../modules/fs/fs/fs_open/">fs_open</a>
</li>
            
<li >
    <a href="../../modules/fs/fs/fs_opendir/">fs_opendir</a>
</li>
            
<li >
    <a href="../../modules/fs/fs/fs_read/">fs_read</a>
</li>
            
<li >
    <a href="../../modules/fs/fs/fs_readdir/">fs_readdir</a>
</li>
            
<li >
    <a href="../../modules/fs/fs/fs_register/">fs_register</a>
</li>
            
<li >
    <a href="../../modules/fs/fs/fs_rename/">fs_rename</a>
</li>
            
<li >
    <a href="../../modules/fs/fs/fs_seek/">fs_seek</a>
</li>
            
<li >
    <a href="../../modules/fs/fs/fs_unlink/">fs_unlink</a>
</li>
            
<li >
    <a href="../../modules/fs/fs/fs_write/">fs_write</a>
</li>
            
<li >
    <a href="../../modules/fs/fs/fsutil_read_file/">fsutil_read_file</a>
</li>
            
<li >
    <a href="../../modules/fs/fs/fsutil_write_file/">fsutil_write_file</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Newtron Flash File System</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../modules/fs/nffs/nffs/">toc</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Data Structures</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../modules/fs/nffs/nffs_area_desc/">struct nffs_area_desc</a>
</li>
            
<li >
    <a href="../../modules/fs/nffs/nffs_config/">struct nffs_config</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Functions</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../modules/fs/nffs/nffs_detect/">nffs_detect</a>
</li>
            
<li >
    <a href="../../modules/fs/nffs/nffs_format/">nffs_format</a>
</li>
            
<li >
    <a href="../../modules/fs/nffs/nffs_init/">nffs_init</a>
</li>
    </ul>
  </li>
            
<li >
    <a href="../../modules/fs/nffs/nffs_internals/">Internals</a>
</li>
    </ul>
  </li>
            
<li >
    <a href="../../modules/fs/otherfs/">Other File Systems</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Hardware Abstraction Layer</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../modules/hal/hal/">toc</a>
</li>
            
<li >
    <a href="../../modules/hal/hal_architecture/">Architecture</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">API</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../modules/hal/hal_api/">Summary</a>
</li>
            
<li >
    <a href="../../modules/hal/hal_adc/hal_adc/">ADC</a>
</li>
            
<li >
    <a href="../../modules/hal/hal_cputime/hal_cpu_timer/">CPU timer</a>
</li>
            
<li >
    <a href="../../modules/hal/hal_dac/hal_dac/">DAC</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Flash memory</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../modules/hal/hal_flash/hal_flash/">Overview</a>
</li>
            
<li >
    <a href="../../modules/hal/hal_flash/hal_flash_int/">flash_int</a>
</li>
            
<li >
    <a href="../../modules/hal/hal_flash/hal_flash_map/">flash_map</a>
</li>
    </ul>
  </li>
            
<li >
    <a href="../../modules/hal/hal_gpio/hal_gpio/">GPIO</a>
</li>
            
<li >
    <a href="../../modules/hal/hal_i2c/hal_i2c/">I2C</a>
</li>
            
<li >
    <a href="../../modules/hal/hal_pwm/hal_pwm/">PWM</a>
</li>
            
<li >
    <a href="../../modules/hal/hal_spi/hal_spi/">SPI</a>
</li>
            
<li >
    <a href="../../modules/hal/hal_system/hal_sys/">System</a>
</li>
            
<li >
    <a href="../../modules/hal/hal_uart/hal_uart/">UART</a>
</li>
    </ul>
  </li>
            
<li >
    <a href="../../modules/hal/hal_in_libraries/">Using HAL</a>
</li>
            
<li >
    <a href="../../modules/hal/hal_creation/">Creating HAL</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Test Utilities</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../modules/testutil/testutil/">toc</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Functions/Macros</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../modules/testutil/tu_init/">tu_init</a>
</li>
            
<li >
    <a href="../../modules/testutil/test_assert/">TEST_ASSERT</a>
</li>
            
<li >
    <a href="../../modules/testutil/test_pass/">TEST_PASS</a>
</li>
            
<li >
    <a href="../../modules/testutil/test_suite/">TEST_SUITE</a>
</li>
            
<li >
    <a href="../../modules/testutil/test_case/">TEST_CASE</a>
</li>
            
<li >
    <a href="../../modules/testutil/test_decl/">TEST_CASE_DECL</a>
</li>
            
<li >
    <a href="../../modules/testutil/tu_restart/">tu_restart</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Image Manager</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../modules/imgmgr/imgmgr/">toc</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Functions</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../modules/imgmgr/imgmgr_module_init/">imgmgr_module_init</a>
</li>
            
<li >
    <a href="../../modules/imgmgr/imgr_ver_parse/">imgr_ver_parse</a>
</li>
            
<li >
    <a href="../../modules/imgmgr/imgr_ver_str/">imgr_ver_str</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
<li >
    <a href="../../modules/baselibc/">Baselibc library</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Embedded Lua</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../modules/elua/elua/">toc</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Functions</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../modules/elua/lua_init/">lua_init</a>
</li>
            
<li >
    <a href="../../modules/elua/lua_main/">lua_main</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">JSON</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../modules/json/json/">toc</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Functions</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../modules/json/json_encode_object_entry/">json_encode_object_entry</a>
</li>
            
<li >
    <a href="../../modules/json/json_encode_object_finish/">json_encode_object_finish</a>
</li>
            
<li >
    <a href="../../modules/json/json_encode_object_key/">json_encode_object_key</a>
</li>
            
<li >
    <a href="../../modules/json/json_encode_object_start/">json_encode_object_start</a>
</li>
            
<li >
    <a href="../../modules/json/json_read_object/">json_read_object</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Stats</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../modules/stats/stats/">toc</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Logs</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../modules/logs/logs/">toc</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">BLE User Guide</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../network/ble/ble_intro/">NimBLE Introduction</a>
</li>
            
<li >
    <a href="../../../network/ble/ble_sec/">NimBLE Security</a>
</li>
            
<li >
    <a href="../../../network/ble/nimble_setup/">Set up application</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Initialize stack</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../network/ble/ini_stack/ble_ini_intro/">toc</a>
</li>
            
<li >
    <a href="../../../network/ble/ini_stack/ble_add_cpu/">Add cputime</a>
</li>
            
<li >
    <a href="../../../network/ble/ini_stack/ble_mempool/">Create mem pool</a>
</li>
            
<li >
    <a href="../../../network/ble/ini_stack/ble_devadd/">Initialize device addr</a>
</li>
            
<li >
    <a href="../../../network/ble/ini_stack/ble_statpkg/">Initialize stats pkg</a>
</li>
            
<li >
    <a href="../../../network/ble/ini_stack/ble_consolepkg/">Initialize console pkg</a>
</li>
            
<li >
    <a href="../../../network/ble/ini_stack/ble_controller_ini/">Initialize controller</a>
</li>
            
<li >
    <a href="../../../network/ble/ini_stack/ble_parent_ini/">Initialize parent task</a>
</li>
            
<li >
    <a href="../../../network/ble/ini_stack/ble_host_ini/">Initialize host</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">API for bletiny app</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../network/ble/bletiny_api/">toc</a>
</li>
            
<li >
    <a href="../../../network/ble/bletiny/bletiny_GAP/">GAP in bletiny</a>
</li>
            
<li >
    <a href="../../../network/ble/bletiny/bletiny_GATT/">GATT in bletiny</a>
</li>
            
<li >
    <a href="../../../network/ble/bletiny/bletiny_advdata/">Advertisement Data Fields</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Newt Tool Guide</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../newt/newt_intro/">toc</a>
</li>
            
<li >
    <a href="../../../newt/newt_operation/">Newt Theory of Ops</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Command Guide</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../newt/newt_ops/">toc</a>
</li>
            
<li >
    <a href="../../../newt/command_list/newt_build/">newt build</a>
</li>
            
<li >
    <a href="../../../newt/command_list/newt_clean/">newt clean</a>
</li>
            
<li >
    <a href="../../../newt/command_list/newt_create_image/">newt create-image</a>
</li>
            
<li >
    <a href="../../../newt/command_list/newt_debug/">newt debug</a>
</li>
            
<li >
    <a href="../../../newt/command_list/newt_help/">newt help</a>
</li>
            
<li >
    <a href="../../../newt/command_list/newt_info/">newt info</a>
</li>
            
<li >
    <a href="../../../newt/command_list/newt_install/">newt install</a>
</li>
            
<li >
    <a href="../../../newt/command_list/newt_load/">newt load</a>
</li>
            
<li >
    <a href="../../../newt/command_list/newt_new/">newt new</a>
</li>
            
<li >
    <a href="../../../newt/command_list/newt_run/">newt run</a>
</li>
            
<li >
    <a href="../../../newt/command_list/newt_size/">newt size</a>
</li>
            
<li >
    <a href="../../../newt/command_list/newt_target/">newt target</a>
</li>
            
<li >
    <a href="../../../newt/command_list/newt_test/">newt test</a>
</li>
            
<li >
    <a href="../../../newt/command_list/newt_upgrade/">newt upgrade</a>
</li>
            
<li >
    <a href="../../../newt/command_list/newt_version/">newt version</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Newt Manager Guide</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../newtmgr/overview/">toc</a>
</li>
            
<li >
    <a href="../../../newtmgr/installing/">Install</a>
</li>
    </ul>
  </li>
                                    
<li >
    <a href="../../../known_issues/">Known Issues</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Appendix <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../faq/how_to_edit_docs/">Edit Docs</a>
</li>
                                    
<li >
    <a href="../../../faq/answers/">FAQ</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../air_quality_sensor/">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../project-slinky/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#how-to-define-a-task-which-uses-event-queues-to-manage-multiple-events">How to define a task which uses event queues to manage multiple events</a></li>
            <li><a href="#introduction">Introduction</a></li>
            <li><a href="#example-app">Example app</a></li>
            <li><a href="#code-for-the-example">Code for the example</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h2 id="how-to-define-a-task-which-uses-event-queues-to-manage-multiple-events">How to define a task which uses event queues to manage multiple events</h2>
<h3 id="introduction">Introduction</h3>
<p>Event queue is a mechanism by which you can serialize incoming events for your task. You can use it to get info about arrived hardware interrupts, callout expirations and messages from other tasks.</p>
<p>The benefit of doing inter-task communication this way is that there should be less resources that need to be locked.</p>
<p>The benefit of doing interrupt processing in a task context instead of inside an interrupt context is that you are not blocking other HW interrupts when doing the work. The same goes for high priority tasks in the system; they're blocked until the interrupt handler returns. From the task context you'll also be able to access other OS facilities; you can sleep while waiting for a lock, for example.</p>
<p><br></p>
<h3 id="example-app">Example app</h3>
<p>Here you are going to write an app which demonstrates the use of event queues for communication between tasks. You will  also use OS callouts for timer expiration and another event from a GPIO interrupt.</p>
<p>You will  use inputs from 3 sources to toggle 3 GPIO outputs on my STM32F3discovery board.</p>
<p><br></p>
<h4 id="create-project">Create project</h4>
<p>You start by creating a project and populating it with repositories incubator-mynewt-core and mynewt_stm32f3. See <a href="../STM32F303/">STM32F3 tutorial</a> if you need help with this. You can also read the tutorial on <a href="../repo/add_repos/">Additional Repositories</a> for a more thorough understanding. </p>
<p><br> </p>
<h4 id="create-application">Create application</h4>
<p>Here's what the pkg.yml looks for the application.</p>
<div class="codehilite" style="background: #ffffff"><pre style="line-height: 125%"><span></span>[marko@IsMyLaptop:~/src/events]$ cat apps/event_sample/pkg.yml
pkg.name: apps/event_sample
pkg.type: app

pkg.deps:
    - &quot;@apache-mynewt-core/libs/os&quot;
    - &quot;@apache-mynewt-core/hw/hal&quot;
    - &quot;@apache-mynewt-core/libs/console/stub&quot;
</pre></div>


<p><br></p>
<h4 id="initialize-the-event-queue-structure">Initialize the event queue structure</h4>
<p>This must be done before anyone tries to place events to the queue. Here it's done before any task gets created. Initialization is done by calling <em>os_eventq_init()</em>.</p>
<div class="codehilite" style="background: #ffffff"><pre style="line-height: 125%"><span></span><span style="color: #633820">#define MY_TASK_PRIO        4</span>
<span style="color: #633820">#define MY_TASK_STACK_SZ    512</span>

<span style="color: #A90D91">static</span> <span style="color: #A90D91">struct</span> <span style="color: #000000">os_eventq</span> <span style="color: #000000">my_eventq</span>;
<span style="color: #A90D91">static</span> <span style="color: #000000">os_stack_t</span> <span style="color: #000000">my_task_stack</span>[<span style="color: #000000">MY_TASK_STACK_SZ</span>];
<span style="color: #A90D91">static</span> <span style="color: #A90D91">struct</span> <span style="color: #000000">os_task</span> <span style="color: #000000">my_task_str</span>;

<span style="color: #A90D91">void</span>
<span style="color: #000000">init_tasks</span>(<span style="color: #A90D91">void</span>)
{
    <span style="color: #A90D91">struct</span> <span style="color: #000000">os_task</span> <span style="color: #000000">taskid</span>;

    <span style="color: #000000">os_eventq_init</span>(<span style="color: #000000">&amp;my_eventq</span>);
    <span style="color: #000000">os_task_init</span>(<span style="color: #000000">&amp;my_task_str</span>, <span style="color: #C41A16">&quot;task&quot;</span>, <span style="color: #000000">my_task</span>, <span style="color: #A90D91">NULL</span>, <span style="color: #000000">MY_TASK_PRIO</span>,
        <span style="color: #000000">OS_WAIT_FOREVER</span>, <span style="color: #000000">my_task_stack</span>, <span style="color: #000000">MY_TASK_STACK_SZ</span>);
</pre></div>


<p><br></p>
<h4 id="processing-events">Processing events</h4>
<p>Here event processing is done inside <em>my_task</em>. The main loop of the task is pulling events from the queue, and then taking action. We look at the type of the event to figure out what to do.</p>
<p>The code snippet shows what the main loop of the event handler looks like. Events are removed from the head of the queue using os_eventq_get</p>
<div class="codehilite" style="background: #ffffff"><pre style="line-height: 125%"><span></span><span style="color: #A90D91">void</span>
<span style="color: #000000">my_task</span>(<span style="color: #A90D91">void</span> <span style="color: #000000">*arg</span>)
{
    <span style="color: #A90D91">struct</span> <span style="color: #000000">os_event</span> <span style="color: #000000">*ev</span>;

    <span style="color: #A90D91">while</span> (<span style="color: #1C01CE">1</span>) {
        <span style="color: #000000">ev</span> <span style="color: #000000">=</span> <span style="color: #000000">os_eventq_get</span>(<span style="color: #000000">&amp;my_eventq</span>);
        <span style="color: #A90D91">switch</span> (<span style="color: #000000">ev-&gt;ev_type</span>) {
        <span style="color: #177500">/* more event types here */</span>
        <span style="color: #A90D91">default</span><span style="color: #000000">:</span>
            <span style="color: #000000">assert</span>(<span style="color: #1C01CE">0</span>);
        }
    }
}
</pre></div>


<p><br></p>
<h4 id="event-types">Event types</h4>
<p>You can define your own event types. Some numbers are already reserved by the OS, so you should not use those as your own types.</p>
<p>Reserved event types are defined in <em>libs/os/include/os/os_eventq.h</em>. One example of a reserved type is OS_EVENT_T_TIMER, which is used as type in OS callouts.</p>
<p>You should start your event numbers from <em>OS_EVENT_T_PERUSER</em>, and go higher.</p>
<p>You are going to generate events from GPIO interrupt handler, from another task as well as from a callout. OS callout already has a type, but you'll need to define types for the other uses.</p>
<div class="codehilite" style="background: #ffffff"><pre style="line-height: 125%"><span></span><span style="color: #633820">#define MY_TASK_GPIO_EVENT  (OS_EVENT_T_PERUSER)</span>
<span style="color: #633820">#define MY_TASK_TASK_EVENT  (OS_EVENT_T_PERUSER + 1)</span>
</pre></div>


<p><br></p>
<h4 id="posting-events-from-another-task">Posting events from another task</h4>
<p>Events are posted to a queue by calling <em>os_eventq_put()</em>. You need to preallocate memory for the event structure. Here it's done by declaring the event structure as a global variable.</p>
<p>Note that you can call <em>os_eventq_put()</em> with an event which has already been queued. In that case, the call has no effect; the position of the event is not changed within the queue.</p>
<p>In the code snippet we declare the os_event structure, and initialize it. We also create the event generating task, and periodically post event to the event queue.</p>
<div class="codehilite" style="background: #ffffff"><pre style="line-height: 125%"><span></span><span style="color: #633820">#define GEN_TASK_PRIO       3</span>
<span style="color: #633820">#define GEN_TASK_STACK_SZ   512</span>

<span style="color: #A90D91">static</span> <span style="color: #A90D91">struct</span> <span style="color: #000000">os_event</span> <span style="color: #000000">gen_task_ev</span>;
<span style="color: #A90D91">static</span> <span style="color: #000000">os_stack_t</span> <span style="color: #000000">gen_task_stack</span>[<span style="color: #000000">GEN_TASK_STACK_SZ</span>];
<span style="color: #A90D91">static</span> <span style="color: #A90D91">struct</span> <span style="color: #000000">os_task</span> <span style="color: #000000">gen_task_str</span>;

<span style="color: #A90D91">void</span>
<span style="color: #000000">gen_task</span>(<span style="color: #A90D91">void</span> <span style="color: #000000">*arg</span>)
{
    <span style="color: #A90D91">while</span> (<span style="color: #1C01CE">1</span>) {
        <span style="color: #000000">os_time_delay</span>(<span style="color: #000000">OS_TICKS_PER_SEC</span> <span style="color: #000000">/</span> <span style="color: #1C01CE">4</span>);
        <span style="color: #000000">os_eventq_put</span>(<span style="color: #000000">&amp;my_eventq</span>, <span style="color: #000000">&amp;gen_task_ev</span>);
    }
}

<span style="color: #A90D91">void</span>
<span style="color: #000000">init_tasks</span>(<span style="color: #A90D91">void</span>)
{
    <span style="color: #177500">/* .... */</span>
    <span style="color: #000000">gen_task_ev</span>.<span style="color: #000000">ev_type</span> <span style="color: #000000">=</span> <span style="color: #000000">MY_TASK_TASK_EVENT</span>;
    <span style="color: #000000">os_task_init</span>(<span style="color: #000000">&amp;gen_task_str</span>, <span style="color: #C41A16">&quot;gen_task&quot;</span>, <span style="color: #000000">gen_task</span>, <span style="color: #A90D91">NULL</span>, <span style="color: #000000">GEN_TASK_PRIO</span>,
        <span style="color: #000000">OS_WAIT_FOREVER</span>, <span style="color: #000000">gen_task_stack</span>, <span style="color: #000000">GEN_TASK_STACK_SZ</span>);
}
</pre></div>


<p><br></p>
<h4 id="callout-events">Callout events</h4>
<p>You can get timer events delivered to your task's event queue with OS callout. Check <a href="../../core_os/callout/callout/">callout documentation</a> for description on how to use the API.</p>
<p>For this example, you'll use only one type of callout; so you can use the simpler structure.</p>
<p>In the code snippet we declare the os_callout structure and initialize it. Then we arm the timer.</p>
<div class="codehilite" style="background: #ffffff"><pre style="line-height: 125%"><span></span><span style="color: #A90D91">static</span> <span style="color: #A90D91">struct</span> <span style="color: #000000">os_callout</span> <span style="color: #000000">my_callout</span>;

<span style="color: #A90D91">void</span>
<span style="color: #000000">init_tasks</span>(<span style="color: #A90D91">void</span>)
{
    <span style="color: #177500">/* .... */</span>

    <span style="color: #000000">os_callout_init</span>(<span style="color: #000000">&amp;my_callout</span>, <span style="color: #000000">&amp;my_eventq</span>, <span style="color: #A90D91">NULL</span>);
    <span style="color: #000000">os_callout_reset</span>(<span style="color: #000000">&amp;my_callout</span>, <span style="color: #000000">OS_TICKS_PER_SEC</span>);
}
</pre></div>


<p><br></p>
<h4 id="posting-events-from-interrupt-handler">Posting events from interrupt handler</h4>
<p>Another place where posting events makes sense is from an interrupt handler. In this tutorial you will do it when GPIO changes state.</p>
<p>You'll use HAL GPIO interface to register a routine which is getting called from the interrupt handler context. This routine will then post event to your queue.</p>
<p>On STM32F3Discovery board, there is a button connected to PA0. The identifier for this GPIO pin is 0.</p>
<div class="codehilite" style="background: #ffffff"><pre style="line-height: 125%"><span></span><span style="color: #A90D91">static</span> <span style="color: #A90D91">struct</span> <span style="color: #000000">os_event</span> <span style="color: #000000">gpio_ev</span>;

<span style="color: #A90D91">void</span>
<span style="color: #000000">init_tasks</span>(<span style="color: #A90D91">void</span>)
{
    <span style="color: #177500">/* .... */</span>

    <span style="color: #000000">gpio_ev</span>.<span style="color: #000000">ev_type</span> <span style="color: #000000">=</span> <span style="color: #000000">MY_TASK_GPIO_EVENT</span>;
    <span style="color: #000000">hal_gpio_irq_init</span>(<span style="color: #1C01CE">0</span>, <span style="color: #000000">my_gpio_irq</span>, <span style="color: #A90D91">NULL</span>, <span style="color: #000000">GPIO_TRIG_RISING</span>,
        <span style="color: #000000">GPIO_PULL_NONE</span>);
    <span style="color: #000000">hal_gpio_irq_enable</span>(<span style="color: #1C01CE">0</span>);
}

<span style="color: #A90D91">static</span> <span style="color: #A90D91">void</span>
<span style="color: #000000">my_gpio_irq</span>(<span style="color: #A90D91">void</span> <span style="color: #000000">*arg</span>)
{
    <span style="color: #000000">os_eventq_put</span>(<span style="color: #000000">&amp;my_eventq</span>, <span style="color: #000000">&amp;gpio_ev</span>);
}
</pre></div>


<p><br></p>
<h4 id="event-processing-finalized">Event processing finalized</h4>
<p>Now that you are posting events from different sources, you will fill in the parts in the task main loop to trigger different behaviors depending on event type.</p>
<p>You'll drive different LEDs depending on what type of event arrived. LEDs on this board are connected to PE8, PE9, PE10 and so on. These have GPIO identifiers starting from 72 onwards.</p>
<div class="codehilite" style="background: #ffffff"><pre style="line-height: 125%"><span></span><span style="color: #633820">#define TASK_LED        72</span>
<span style="color: #633820">#define CALLOUT_LED     73</span>
<span style="color: #633820">#define GPIO_LED        74</span>

<span style="color: #A90D91">void</span>
<span style="color: #000000">init_tasks</span>(<span style="color: #A90D91">void</span>)
{
    <span style="color: #177500">/* .... */</span>
    <span style="color: #000000">hal_gpio_init_out</span>(<span style="color: #000000">TASK_LED</span>, <span style="color: #1C01CE">1</span>);
    <span style="color: #000000">hal_gpio_init_out</span>(<span style="color: #000000">CALLOUT_LED</span>, <span style="color: #1C01CE">1</span>);
    <span style="color: #000000">hal_gpio_init_out</span>(<span style="color: #000000">GPIO_LED</span>, <span style="color: #1C01CE">1</span>);
}
</pre></div>


<p>And here is the new main loop for your task. Note that when callout event arrives, we re-arm the callout.</p>
<div class="codehilite" style="background: #ffffff"><pre style="line-height: 125%"><span></span><span style="color: #A90D91">void</span>
<span style="color: #000000">my_task</span>(<span style="color: #A90D91">void</span> <span style="color: #000000">*arg</span>)
{
    <span style="color: #A90D91">struct</span> <span style="color: #000000">os_event</span> <span style="color: #000000">*ev</span>;

    <span style="color: #A90D91">while</span> (<span style="color: #1C01CE">1</span>) {
        <span style="color: #000000">ev</span> <span style="color: #000000">=</span> <span style="color: #000000">os_eventq_get</span>(<span style="color: #000000">&amp;my_eventq</span>);
        <span style="color: #A90D91">switch</span> (<span style="color: #000000">ev-&gt;ev_type</span>) {
        <span style="color: #A90D91">case</span> <span style="color: #000000">MY_TASK_TASK_EVENT</span>:
            <span style="color: #000000">hal_gpio_toggle</span>(<span style="color: #000000">TASK_LED</span>);
            <span style="color: #A90D91">break</span>;
        <span style="color: #A90D91">case</span> <span style="color: #000000">OS_EVENT_T_TIMER</span>:
            <span style="color: #000000">hal_gpio_toggle</span>(<span style="color: #000000">CALLOUT_LED</span>);
            <span style="color: #000000">os_callout_reset</span>(<span style="color: #000000">&amp;my_callout</span>, <span style="color: #000000">OS_TICKS_PER_SEC</span> <span style="color: #000000">/</span> <span style="color: #1C01CE">2</span>);
            <span style="color: #A90D91">break</span>;
        <span style="color: #A90D91">case</span> <span style="color: #000000">MY_TASK_GPIO_EVENT</span>:
            <span style="color: #000000">hal_gpio_toggle</span>(<span style="color: #000000">GPIO_LED</span>);
            <span style="color: #A90D91">break</span>;
        <span style="color: #A90D91">default</span><span style="color: #000000">:</span>
            <span style="color: #000000">assert</span>(<span style="color: #1C01CE">0</span>);
        }
    }
}
</pre></div>


<p><br></p>
<p>Now you're done. Once you load this to your board, the task LED will blink at an interval of 250ms, the callout LED with an interval of 500ms, and the GPIO LED every time you press the button.</p>
<p><br></p>
<h3 id="code-for-the-example">Code for the example</h3>
<div class="codehilite" style="background: #ffffff"><pre style="line-height: 125%"><span></span><span style="color: #633820">#include</span> <span style="color: #177500">&lt;os/os.h&gt;</span><span style="color: #633820"></span>
<span style="color: #633820">#include</span> <span style="color: #177500">&lt;bsp/bsp.h&gt;</span><span style="color: #633820"></span>
<span style="color: #633820">#include</span> <span style="color: #177500">&lt;hal/hal_gpio.h&gt;</span><span style="color: #633820"></span>
<span style="color: #633820">#include</span> <span style="color: #177500">&lt;assert.h&gt;</span><span style="color: #633820"></span>


<span style="color: #633820">#define MY_TASK_PRIO        4</span>
<span style="color: #633820">#define MY_TASK_STACK_SZ    512</span>

<span style="color: #633820">#define GEN_TASK_PRIO       3</span>
<span style="color: #633820">#define GEN_TASK_STACK_SZ   512</span>

<span style="color: #633820">#define MY_TASK_GPIO_EVENT  (OS_EVENT_T_PERUSER)</span>
<span style="color: #633820">#define MY_TASK_TASK_EVENT  (OS_EVENT_T_PERUSER + 1)</span>

<span style="color: #633820">#define TASK_LED        72</span>
<span style="color: #633820">#define CALLOUT_LED     73</span>
<span style="color: #633820">#define GPIO_LED        74</span>

<span style="color: #A90D91">static</span> <span style="color: #A90D91">struct</span> <span style="color: #000000">os_eventq</span> <span style="color: #000000">my_eventq</span>;
<span style="color: #A90D91">static</span> <span style="color: #000000">os_stack_t</span> <span style="color: #000000">my_task_stack</span>[<span style="color: #000000">MY_TASK_STACK_SZ</span>];
<span style="color: #A90D91">static</span> <span style="color: #A90D91">struct</span> <span style="color: #000000">os_task</span> <span style="color: #000000">my_task_str</span>;

<span style="color: #A90D91">static</span> <span style="color: #A90D91">struct</span> <span style="color: #000000">os_event</span> <span style="color: #000000">gen_task_ev</span>;
<span style="color: #A90D91">static</span> <span style="color: #000000">os_stack_t</span> <span style="color: #000000">gen_task_stack</span>[<span style="color: #000000">GEN_TASK_STACK_SZ</span>];
<span style="color: #A90D91">static</span> <span style="color: #A90D91">struct</span> <span style="color: #000000">os_task</span> <span style="color: #000000">gen_task_str</span>;

<span style="color: #A90D91">static</span> <span style="color: #A90D91">struct</span> <span style="color: #000000">os_callout</span> <span style="color: #000000">my_callout</span>;

<span style="color: #A90D91">static</span> <span style="color: #A90D91">struct</span> <span style="color: #000000">os_event</span> <span style="color: #000000">gpio_ev</span>;

<span style="color: #A90D91">void</span>
<span style="color: #000000">my_task</span>(<span style="color: #A90D91">void</span> <span style="color: #000000">*arg</span>)
{
    <span style="color: #A90D91">struct</span> <span style="color: #000000">os_event</span> <span style="color: #000000">*ev</span>;

    <span style="color: #A90D91">while</span> (<span style="color: #1C01CE">1</span>) {
        <span style="color: #000000">ev</span> <span style="color: #000000">=</span> <span style="color: #000000">os_eventq_get</span>(<span style="color: #000000">&amp;my_eventq</span>);
        <span style="color: #A90D91">switch</span> (<span style="color: #000000">ev-&gt;ev_type</span>) {
        <span style="color: #A90D91">case</span> <span style="color: #000000">MY_TASK_TASK_EVENT</span>:
            <span style="color: #000000">hal_gpio_toggle</span>(<span style="color: #000000">TASK_LED</span>);
            <span style="color: #A90D91">break</span>;
        <span style="color: #A90D91">case</span> <span style="color: #000000">OS_EVENT_T_TIMER</span>:
            <span style="color: #000000">hal_gpio_toggle</span>(<span style="color: #000000">CALLOUT_LED</span>);
            <span style="color: #000000">os_callout_reset</span>(<span style="color: #000000">&amp;my_callout</span>, <span style="color: #000000">OS_TICKS_PER_SEC</span> <span style="color: #000000">/</span> <span style="color: #1C01CE">2</span>);
            <span style="color: #A90D91">break</span>;
        <span style="color: #A90D91">case</span> <span style="color: #000000">MY_TASK_GPIO_EVENT</span>:
            <span style="color: #000000">hal_gpio_toggle</span>(<span style="color: #000000">GPIO_LED</span>);
            <span style="color: #A90D91">break</span>;
        <span style="color: #A90D91">default</span><span style="color: #000000">:</span>
            <span style="color: #000000">assert</span>(<span style="color: #1C01CE">0</span>);
        }
    }
}

<span style="color: #A90D91">static</span> <span style="color: #A90D91">void</span>
<span style="color: #000000">my_gpio_irq</span>(<span style="color: #A90D91">void</span> <span style="color: #000000">*arg</span>)
{
    <span style="color: #000000">os_eventq_put</span>(<span style="color: #000000">&amp;my_eventq</span>, <span style="color: #000000">&amp;gpio_ev</span>);
}

<span style="color: #A90D91">void</span>
<span style="color: #000000">gen_task</span>(<span style="color: #A90D91">void</span> <span style="color: #000000">*arg</span>)
{
    <span style="color: #A90D91">while</span> (<span style="color: #1C01CE">1</span>) {
        <span style="color: #000000">os_time_delay</span>(<span style="color: #000000">OS_TICKS_PER_SEC</span> <span style="color: #000000">/</span> <span style="color: #1C01CE">4</span>);
        <span style="color: #000000">os_eventq_put</span>(<span style="color: #000000">&amp;my_eventq</span>, <span style="color: #000000">&amp;gen_task_ev</span>);
    }
}

<span style="color: #A90D91">void</span>
<span style="color: #000000">init_tasks</span>(<span style="color: #A90D91">void</span>)
{
    <span style="color: #000000">os_eventq_init</span>(<span style="color: #000000">&amp;my_eventq</span>);
    <span style="color: #000000">os_task_init</span>(<span style="color: #000000">&amp;my_task_str</span>, <span style="color: #C41A16">&quot;task&quot;</span>, <span style="color: #000000">my_task</span>, <span style="color: #A90D91">NULL</span>, <span style="color: #000000">MY_TASK_PRIO</span>,
        <span style="color: #000000">OS_WAIT_FOREVER</span>, <span style="color: #000000">my_task_stack</span>, <span style="color: #000000">MY_TASK_STACK_SZ</span>);

    <span style="color: #000000">gen_task_ev</span>.<span style="color: #000000">ev_type</span> <span style="color: #000000">=</span> <span style="color: #000000">MY_TASK_TASK_EVENT</span>;
    <span style="color: #000000">os_task_init</span>(<span style="color: #000000">&amp;gen_task_str</span>, <span style="color: #C41A16">&quot;gen_task&quot;</span>, <span style="color: #000000">gen_task</span>, <span style="color: #A90D91">NULL</span>, <span style="color: #000000">GEN_TASK_PRIO</span>,
        <span style="color: #000000">OS_WAIT_FOREVER</span>, <span style="color: #000000">gen_task_stack</span>, <span style="color: #000000">GEN_TASK_STACK_SZ</span>);

    <span style="color: #000000">os_callout_init</span>(<span style="color: #000000">&amp;my_callout</span>, <span style="color: #000000">&amp;my_eventq</span>, <span style="color: #A90D91">NULL</span>);
    <span style="color: #000000">os_callout_reset</span>(<span style="color: #000000">&amp;my_callout</span>, <span style="color: #000000">OS_TICKS_PER_SEC</span>);

    <span style="color: #000000">gpio_ev</span>.<span style="color: #000000">ev_type</span> <span style="color: #000000">=</span> <span style="color: #000000">MY_TASK_GPIO_EVENT</span>;
    <span style="color: #000000">hal_gpio_irq_init</span>(<span style="color: #1C01CE">0</span>, <span style="color: #000000">my_gpio_irq</span>, <span style="color: #A90D91">NULL</span>, <span style="color: #000000">GPIO_TRIG_RISING</span>,
        <span style="color: #000000">GPIO_PULL_NONE</span>);
    <span style="color: #000000">hal_gpio_irq_enable</span>(<span style="color: #1C01CE">0</span>);

    <span style="color: #000000">hal_gpio_init_out</span>(<span style="color: #000000">TASK_LED</span>, <span style="color: #1C01CE">1</span>);
    <span style="color: #000000">hal_gpio_init_out</span>(<span style="color: #000000">CALLOUT_LED</span>, <span style="color: #1C01CE">1</span>);
    <span style="color: #000000">hal_gpio_init_out</span>(<span style="color: #000000">GPIO_LED</span>, <span style="color: #1C01CE">1</span>);
}

<span style="color: #A90D91">int</span>
<span style="color: #000000">main</span>(<span style="color: #A90D91">int</span> <span style="color: #000000">argc</span>, <span style="color: #A90D91">char</span> <span style="color: #000000">**argv</span>)
{
    <span style="color: #000000">os_init</span>();

    <span style="color: #000000">init_tasks</span>();
    <span style="color: #000000">os_start</span>();
    <span style="color: #000000">assert</span>(<span style="color: #1C01CE">0</span>);
    <span style="color: #A90D91">return</span> <span style="color: #1C01CE">0</span>;
}
</pre></div></div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Apache Mynewt (incubating) is available under Apache License, version 2.0.</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../js/base.js" defer></script>
        <script src="../../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
