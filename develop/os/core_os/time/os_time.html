

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    

    
    <title>OS Time &mdash; Apache Mynewt 1.3.0 documentation</title>
    

    
    
      <link rel="shortcut icon" href="../../../_static/mynewt-logo-only-newt32x32.png"/>
    

    

    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />

    
      <link rel="stylesheet" href="../../../_static/css/sphinx_theme.css" type="text/css" />
    
      <link rel="stylesheet" href="../../../_static/css/bootstrap-3.0.3.min.css" type="text/css" />
    
      <link rel="stylesheet" href="../../../_static/css/v2.css" type="text/css" />
    
      <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
    
      <link rel="stylesheet" href="../../../_static/css/restructuredtext.css" type="text/css" />
    

    

    <link rel="stylesheet" href="../../../_static/css/overrides.css" type="text/css" />
          <link rel="index" title="Index"
                href="../../../genindex.html"/>
          <link rel="search" title="Search" href="../../../search.html"/>
      <link rel="top" title="Apache Mynewt 1.3.0 documentation" href="../../../index.html"/>
          <link rel="up" title="Mynewt Core OS" href="../mynewt_os.html"/>
          <link rel="next" title="Task" href="../task/task.html"/>
          <link rel="prev" title="CPU Time" href="../cputime/os_cputime.html"/> 

    
    <script src="../../../_static/js/modernizr.min.js"></script>

    
    <script>
    (function(i, s, o, g, r, a, m) {
	i["GoogleAnalyticsObject"] = r;
	(i[r] =
		i[r] ||
		function() {
			(i[r].q = i[r].q || []).push(arguments);
		}),
		(i[r].l = 1 * new Date());
	(a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
	a.async = 1;
	a.src = g;
	m.parentNode.insertBefore(a, m);
})(window, document, "script", "//www.google-analytics.com/analytics.js", "ga");

ga("create", "UA-72162311-1", "auto");
ga("send", "pageview");
</script>
    

  </head>

  <body class="not-front page-documentation" role="document" >
    <div id="wrapper">
      <div class="container">
    <div id="banner" class="row v2-main-banner">
        <a class="logo-cell" href="/">
            <img class="logo" src="../../../_static/img/logo.png">
        </a>
        <div class="tagline-cell">
            <h4 class="tagline">An OS to build, deploy and securely manage billions of devices</h4>
        </div>
        <div class="news-cell">
            <div class="well">
              <h4>Latest News:</h4> <a href="/download">Apache Mynewt 1.3.0</a> released (December 13, 2017)
            </div>
        </div>
    </div>
</div>
      
<header>
    <nav id="navbar" class="navbar navbar-inverse" role="navigation">
        <div class="container">
            <!-- Collapsed navigation -->
            <div class="navbar-header">
                <!-- Expander button -->
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>

            </div>

            <!-- Expanded navigation -->
            <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/"><i class="fa fa-home" style="font-size: larger;"></i></a>
                    </li>
                    <li class="important">
                        <a href="/get_started/quick_start.html">Quick Start</a>
                    </li>
                    <li>
                        <a href="/about/">About</a>
                    </li>
                    <li>
                        <a href="/talks/">Talks</a>
                    </li>
                    <li class="active">
                        <a href="/documentation/">Documentation</a>
                    </li>
                    <li>
                        <a href="/download/">Download</a>
                    </li>
                    <li>
                        <a href="/community/">Community</a>
                    </li>
                    <li>
                        <a href="/events/">Events</a>
                    </li>
                </ul>

                <!-- Search, Navigation and Repo links -->
                <ul class="nav navbar-nav navbar-right">
                    
                </ul>
            </div>
        </div>
    </nav>
</header>
      <!-- STARTS MAIN CONTENT -->
      <div id="main-content">
        





<div id="breadcrumb">
  <div class="container">
    <a href="/documentation/">Docs</a> /
    
      <a href="../../os_user_guide.html">OS User Guide</a> /
    
      <a href="../mynewt_os.html">Mynewt Core OS</a> /
    
    OS Time
    
  <div class="sourcelink">
    <a href="https://github.com/apache/mynewt-core/edit/master/docs/os/core_os/time/os_time.rst" class="icon icon-github"
           rel="nofollow"> Edit on GitHub</a>
</div>
  </div>
</div>
        <!-- STARTS CONTAINER -->
        <div class="container">
          <!-- STARTS .content -->
          <div id="content" class="row">
            
            <!-- STARTS .container-sidebar -->
<div class="container-sidebar col-xs-12 col-sm-3">
  <div id="docSidebar" class="sticky-container">
    <div role="search" class="sphinx-search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search documentation" class="search-documentation" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
    
<!-- Note: only works when deployed -->
<select class="form-control" onchange="if (this.value) window.location.href=this.value">
    <option
      value="/develop"
      selected
      >
      Version: develop (latest - mynewt-documentation)
    </option>
    <option
      value="/latest/os/introduction"
      >
      Version: master (latest - mynewt-site)
    </option>
    <option
      value="/v1_2_0/os/introduction"
      >
      Version: 1.2.0
    </option>
    <option
      value="/v1_1_0/os/introduction">
      Version: 1.1.0
    </option>
    <option
      value="/v1_0_0/os/introduction">
      Version: 1.0.0
    </option>
    <option
      value="/v0_9_0/os/introduction">
      Version: 0_9_0
    </option>
</select>
    <div class="region region-sidebar">
      <div class="docs-menu">
      
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../get_started/index.html">Setup &amp; Get Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../concepts.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/tutorials.html">Tutorials</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../os_user_guide.html">OS User Guide</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../mynewt_os.html">OS Core</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../context_switch/context_switch.html">Scheduler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cputime/os_cputime.html">CPU Time</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">OS Time</a></li>
<li class="toctree-l3"><a class="reference internal" href="../task/task.html">Task</a></li>
<li class="toctree-l3"><a class="reference internal" href="../API.html">API</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../porting/port_os.html">Porting Mynewt OS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules/console/console.html">Console</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules/sysinitconfig/sysinitconfig.html">System Configuration and Initialization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../network/ble/ble_intro.html">BLE User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../newt/index.html">Newt Tool Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../newtmgr/index.html">Newt Manager Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/index.html">Appendix</a></li>
</ul>

        
      
      </div>
    </div>
  </div>
  <!-- ENDS STICKY CONTAINER -->
</div>
<!-- ENDS .container-sidebar -->

            <div class="col-xs-12 col-sm-9">
              <div class="alert alert-info" role="alert">
  <p>
    This is the development version of Apache Mynewt documentation. As such it may not be as complete as the latest
    stable version of the documentation found <a href="/latest/os/introduction/">here</a>.
  </p>
  <p>
    To improve this documentation please visit <a href="https://github.com/apache/mynewt-documentation">https://github.com/apache/mynewt-documentation</a>.
  </p>
</div>
              
              <div class="">
                <div class="rst-content">
                  <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
                   <div itemprop="articleBody">
                    
  <div class="section" id="os-time">
<h1>OS Time<a class="headerlink" href="#os-time" title="Permalink to this headline">Â¶</a></h1>
<p>The system time for the Mynewt OS.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#description" id="id1">Description</a></li>
<li><a class="reference internal" href="#data-structures" id="id2">Data Structures</a></li>
<li><a class="reference internal" href="#functions" id="id3">Functions</a></li>
<li><a class="reference internal" href="#macros" id="id4">Macros</a></li>
<li><a class="reference internal" href="#special-notes" id="id5">Special Notes</a></li>
</ul>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id1">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">Â¶</a></h2>
<p>The Mynewt OS contains an incrementing time that drives the OS scheduler
and time delays. The time is a fixed size (e.g. 32 bits) and will
eventually wrap back to zero. The time to wrap from zero back to zero is
called the <strong>OS time epoch</strong>.</p>
<p>The frequency of the OS time tick is specified in the
architecture-specific OS code <code class="docutils literal notranslate"><span class="pre">os_arch.h</span></code> and is named
<code class="docutils literal notranslate"><span class="pre">OS_TICKS_PER_SEC</span></code>.</p>
<p>The Mynewt OS also provides APIs for setting and retrieving the
wallclock time (also known as local time or time-of-day in other
operating systems).</p>
</div>
<div class="section" id="data-structures">
<h2><a class="toc-backref" href="#id2">Data Structures</a><a class="headerlink" href="#data-structures" title="Permalink to this headline">Â¶</a></h2>
<p>Time is stored in Mynewt as an <a class="reference internal" href="../API.html#c.os_time_t" title="os_time_t"><code class="xref c c-type docutils literal notranslate"><span class="pre">os_time_t</span></code></a> value.</p>
<p>Wallclock time is represented using the <a class="reference internal" href="../API.html#c.os_timeval" title="os_timeval"><code class="xref c c-data docutils literal notranslate"><span class="pre">struct</span> <span class="pre">os_timeval</span></code></a> and
<a class="reference internal" href="../API.html#c.os_timezone" title="os_timezone"><code class="xref c c-data docutils literal notranslate"><span class="pre">struct</span> <span class="pre">os_timezone</span></code></a> tuple.</p>
<p><a class="reference internal" href="../API.html#c.os_timeval" title="os_timeval"><code class="xref c c-data docutils literal notranslate"><span class="pre">struct</span> <span class="pre">os_timeval</span></code></a> represents the number of seconds elapsed since
00:00:00 Jan 1, 1970 UTC.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">os_timeval</span> <span class="p">{</span>
    <span class="kt">int64_t</span> <span class="n">tv_sec</span><span class="p">;</span>  <span class="cm">/* seconds since Jan 1 1970 UTC */</span>
    <span class="kt">int32_t</span> <span class="n">tv_usec</span><span class="p">;</span> <span class="cm">/* fractional seconds */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">os_timeval</span> <span class="n">tv</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">1457400000</span><span class="p">,</span> <span class="mi">0</span> <span class="p">};</span>  <span class="cm">/* 01:20:00 Mar 8 2016 UTC */</span>
</pre></div>
</div>
<p><a class="reference internal" href="../API.html#c.os_timezone" title="os_timezone"><code class="xref c c-data docutils literal notranslate"><span class="pre">struct</span> <span class="pre">os_timezone</span></code></a> is used to specify the offset of local time from
UTC and whether daylight savings is in effect. Note that <code class="docutils literal notranslate"><span class="pre">tz_minuteswest</span></code> is a positive number
if the local time is <em>behind</em> UTC and a negative number if the local time is <em>ahead</em> of UTC.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">os_timezone</span> <span class="p">{</span>
    <span class="kt">int16_t</span> <span class="n">tz_minuteswest</span><span class="p">;</span>
    <span class="kt">int16_t</span> <span class="n">tz_dsttime</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* Pacific Standard Time is 08:00 hours west of UTC */</span>
<span class="k">struct</span> <span class="n">os_timezone</span> <span class="n">PST</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">0</span> <span class="p">};</span>
<span class="k">struct</span> <span class="n">os_timezone</span> <span class="n">PDT</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">1</span> <span class="p">};</span>

<span class="cm">/* Indian Standard Time is 05:30 hours east of UTC */</span>
<span class="k">struct</span> <span class="n">os_timezone</span> <span class="n">IST</span> <span class="o">=</span> <span class="p">{</span> <span class="o">-</span><span class="mi">330</span><span class="p">,</span> <span class="mi">0</span> <span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="functions">
<h2><a class="toc-backref" href="#id3">Functions</a><a class="headerlink" href="#functions" title="Permalink to this headline">Â¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Function</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="reference internal" href="../API.html#c.os_time_advance" title="os_time_advance"><code class="xref c c-func docutils literal notranslate"><span class="pre">os_time_advance()</span></code></a></td>
<td>Increments the OS time tick for the system.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="../API.html#c.os_time_delay" title="os_time_delay"><code class="xref c c-func docutils literal notranslate"><span class="pre">os_time_delay()</span></code></a></td>
<td>Put the current task to sleep for the given number of ticks.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../API.html#c.os_time_get" title="os_time_get"><code class="xref c c-func docutils literal notranslate"><span class="pre">os_time_get()</span></code></a></td>
<td>Get the current value of OS time.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="../API.html#c.os_time_ms_to_ticks" title="os_time_ms_to_ticks"><code class="xref c c-func docutils literal notranslate"><span class="pre">os_time_ms_to_ticks()</span></code></a></td>
<td>Converts milliseconds to os ticks.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../API.html#c.os_get_uptime_usec" title="os_get_uptime_usec"><code class="xref c c-func docutils literal notranslate"><span class="pre">os_get_uptime_usec()</span></code></a></td>
<td>Gets the time duration since boot.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="../API.html#c.os_gettimeofday" title="os_gettimeofday"><code class="xref c c-func docutils literal notranslate"><span class="pre">os_gettimeofday()</span></code></a></td>
<td>Populate the given timeval and timezone structs with current time data.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../API.html#c.os_settimeofday" title="os_settimeofday"><code class="xref c c-func docutils literal notranslate"><span class="pre">os_settimeofday()</span></code></a></td>
<td>Set the current time of day to the given time structs.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="macros">
<h2><a class="toc-backref" href="#id4">Macros</a><a class="headerlink" href="#macros" title="Permalink to this headline">Â¶</a></h2>
<p>Several macros help with the evalution of times with respect to each
other.</p>
<ul class="simple">
<li><a class="reference internal" href="../API.html#c.OS_TIME_TICK_LT" title="OS_TIME_TICK_LT"><code class="xref c c-macro docutils literal notranslate"><span class="pre">OS_TIME_TICK_LT</span></code></a> â evaluates to true if t1 is before t2 in
time.</li>
<li><a class="reference internal" href="../API.html#c.OS_TIME_TICK_GT" title="OS_TIME_TICK_GT"><code class="xref c c-macro docutils literal notranslate"><span class="pre">OS_TIME_TICK_GT</span></code></a> â evaluates to true if t1 is after t2 in
time</li>
<li><a class="reference internal" href="../API.html#c.OS_TIME_TICK_GEQ" title="OS_TIME_TICK_GEQ"><code class="xref c c-macro docutils literal notranslate"><span class="pre">OS_TIME_TICK_GEQ</span></code></a> â evaluates to true if t1 is on or after
t2 in time.</li>
</ul>
<p>NOTE: For all of these macros the calculations are done modulo
âos_time_tâ.</p>
<p>Ensure that comparison of OS time always uses the macros above (to
compensate for the possible wrap of OS time).</p>
<p>The following macros help adding or subtracting time when represented as
<a class="reference internal" href="../API.html#c.os_timeval" title="os_timeval"><code class="xref c c-data docutils literal notranslate"><span class="pre">struct</span> <span class="pre">os_timeval</span></code></a>. All parameters to the following macros are
pointers to <a class="reference internal" href="../API.html#c.os_timeval" title="os_timeval"><code class="xref c c-data docutils literal notranslate"><span class="pre">struct</span> <span class="pre">os_timeval</span></code></a>.</p>
<ul class="simple">
<li><a class="reference internal" href="../API.html#c.os_timeradd" title="os_timeradd"><code class="xref c c-macro docutils literal notranslate"><span class="pre">os_timeradd</span></code></a> â Add <code class="docutils literal notranslate"><span class="pre">uvp</span></code> to <code class="docutils literal notranslate"><span class="pre">tvp</span></code> and store
result in <code class="docutils literal notranslate"><span class="pre">vvp</span></code>.</li>
<li><a class="reference internal" href="../API.html#c.os_timersub" title="os_timersub"><code class="xref c c-macro docutils literal notranslate"><span class="pre">os_timersub</span></code></a> â Subtract <code class="docutils literal notranslate"><span class="pre">uvp</span></code> from <code class="docutils literal notranslate"><span class="pre">tvp</span></code> and
store result in <code class="docutils literal notranslate"><span class="pre">vvp</span></code>.</li>
</ul>
</div>
<div class="section" id="special-notes">
<h2><a class="toc-backref" href="#id5">Special Notes</a><a class="headerlink" href="#special-notes" title="Permalink to this headline">Â¶</a></h2>
<p>Its important to understand how quickly the time wraps especially when
doing time comparison using the macros above (or by any other means).</p>
<p>For example, if a tick is 1 millisecond and <a class="reference internal" href="../API.html#c.os_time_t" title="os_time_t"><code class="xref c c-type docutils literal notranslate"><span class="pre">os_time_t</span></code></a> is 32-bits the
OS time will wrap back to zero in about 49.7 days or stated another way,
the OS time epoch is 49.7 days.</p>
<p>If two times are more than 1/2 the OS time epoch apart, any time
comparison will be incorrect. Ensure at design time that comparisons
will not occur between times that are more than half the OS time epoch.</p>
</div>
</div>


                   </div>
                  </div>
                  
    <div class="rst-footer-buttons row" role="navigation" aria-label="footer navigation">
      
        <a href="../task/task.html" class="btn btn-neutral float-right" title="Task" accesskey="n">Next: Task <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../cputime/os_cputime.html" class="btn btn-neutral" title="CPU Time" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous: CPU Time</a>
      
    </div>

                </div>
              </div>
            </div>
            <!-- ENDS CONTENT SECTION -->
          </div>
          <!-- ENDS .content -->
        </div>
      </div>
      <footer>
  <div class="container">
    <div class="row">
      <div class="col-xs-12">
          
              <p class="copyright">Apache Mynewt is available under Apache License, version 2.0.</p>
          
      </div>
      <div class="col-xs-12">
          <div class="logos">
              <img src="../../../_static/img/asf_logo_wide_small.png" alt="Apache" title="Apache">
              <small class="footnote">
                Apache Mynewt, Mynewt, Apache, the Apache feather logo, and the Apache Mynewt project logo are either
                registered trademarks or trademarks of the Apache Software Foundation in the United States and other countries.
              </small>
              <a href="https://join.slack.com/mynewt/shared_invite/MTkwMTg1ODM1NTg5LTE0OTYxNzQ4NzQtZTU1YmNhYjhkMg">
                <img src="../../../_static/img/add_to_slack.png" alt="Slack Icon" title="Join our Slack Community" />
              </a>
          </div>
      </div>
    </div>
  </div>
</footer>
    </div>
    <!-- ENDS #wrapper -->

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1.3.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../_static/js/bootstrap-3.0.3.min.js"></script>
      <script type="text/javascript" src="../../../_static/js/affix.js"></script>
      <script type="text/javascript" src="../../../_static/js/main.js"></script>

   

  </body>
</html>