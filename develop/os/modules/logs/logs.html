

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    

    
    <title>Logging &mdash; Apache Mynewt 1.3.0 documentation</title>
    

    
    
      <link rel="shortcut icon" href="../../../_static/mynewt-logo-only-newt32x32.png"/>
    

    

    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />

    
      <link rel="stylesheet" href="../../../_static/css/sphinx_theme.css" type="text/css" />
    
      <link rel="stylesheet" href="../../../_static/css/bootstrap-3.0.3.min.css" type="text/css" />
    
      <link rel="stylesheet" href="../../../_static/css/v2.css" type="text/css" />
    
      <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
    
      <link rel="stylesheet" href="../../../_static/css/restructuredtext.css" type="text/css" />
    

    

    <link rel="stylesheet" href="../../../_static/css/overrides.css" type="text/css" />
          <link rel="index" title="Index"
                href="../../../genindex.html"/>
          <link rel="search" title="Search" href="../../../search.html"/>
      <link rel="top" title="Apache Mynewt 1.3.0 documentation" href="../../../index.html"/> 

    
    <script src="../../../_static/js/modernizr.min.js"></script>

    
    <script>
    (function(i, s, o, g, r, a, m) {
	i["GoogleAnalyticsObject"] = r;
	(i[r] =
		i[r] ||
		function() {
			(i[r].q = i[r].q || []).push(arguments);
		}),
		(i[r].l = 1 * new Date());
	(a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
	a.async = 1;
	a.src = g;
	m.parentNode.insertBefore(a, m);
})(window, document, "script", "//www.google-analytics.com/analytics.js", "ga");

ga("create", "UA-72162311-1", "auto");
ga("send", "pageview");
</script>
    

  </head>

  <body class="not-front page-documentation" role="document" >
    <div id="wrapper">
      <div class="container">
    <div id="banner" class="row v2-main-banner">
        <a class="logo-cell" href="/">
            <img class="logo" src="../../../_static/img/logo.png">
        </a>
        <div class="tagline-cell">
            <h4 class="tagline">An OS to build, deploy and securely manage billions of devices</h4>
        </div>
        <div class="news-cell">
            <div class="well">
              <h4>Latest News:</h4> <a href="/download">Apache Mynewt 1.3.0</a> released (December 13, 2017)
            </div>
        </div>
    </div>
</div>
      
<header>
    <nav id="navbar" class="navbar navbar-inverse" role="navigation">
        <div class="container">
            <!-- Collapsed navigation -->
            <div class="navbar-header">
                <!-- Expander button -->
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>

            </div>

            <!-- Expanded navigation -->
            <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/"><i class="fa fa-home" style="font-size: larger;"></i></a>
                    </li>
                    <li class="important">
                        <a href="/get_started/quick_start.html">Quick Start</a>
                    </li>
                    <li>
                        <a href="/about/">About</a>
                    </li>
                    <li>
                        <a href="/talks/">Talks</a>
                    </li>
                    <li class="active">
                        <a href="/documentation/">Documentation</a>
                    </li>
                    <li>
                        <a href="/download/">Download</a>
                    </li>
                    <li>
                        <a href="/community/">Community</a>
                    </li>
                    <li>
                        <a href="/events/">Events</a>
                    </li>
                </ul>

                <!-- Search, Navigation and Repo links -->
                <ul class="nav navbar-nav navbar-right">
                    
                </ul>
            </div>
        </div>
    </nav>
</header>
      <!-- STARTS MAIN CONTENT -->
      <div id="main-content">
        





<div id="breadcrumb">
  <div class="container">
    <a href="/documentation/">Docs</a> /
    
    Logging
    
  <div class="sourcelink">
    <a href="https://github.com/apache/mynewt-core/edit/master/docs/os/modules/logs/logs.rst" class="icon icon-github"
           rel="nofollow"> Edit on GitHub</a>
</div>
  </div>
</div>
        <!-- STARTS CONTAINER -->
        <div class="container">
          <!-- STARTS .content -->
          <div id="content" class="row">
            
            <!-- STARTS .container-sidebar -->
<div class="container-sidebar col-xs-12 col-sm-3">
  <div id="docSidebar" class="sticky-container">
    <div role="search" class="sphinx-search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search documentation" class="search-documentation" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
    
<!-- Note: only works when deployed -->
<select class="form-control" onchange="if (this.value) window.location.href=this.value">
    <option
      value="/develop"
      selected
      >
      Version: develop (latest - mynewt-documentation)
    </option>
    <option
      value="/latest/os/introduction"
      >
      Version: master (latest - mynewt-site)
    </option>
    <option
      value="/v1_2_0/os/introduction"
      >
      Version: 1.2.0
    </option>
    <option
      value="/v1_1_0/os/introduction">
      Version: 1.1.0
    </option>
    <option
      value="/v1_0_0/os/introduction">
      Version: 1.0.0
    </option>
    <option
      value="/v0_9_0/os/introduction">
      Version: 0_9_0
    </option>
</select>
    <div class="region region-sidebar">
      <div class="docs-menu">
      
        
        
            <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../get_started/index.html">Setup &amp; Get Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../concepts.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../os_user_guide.html">OS User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../network/ble/ble_intro.html">BLE User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../newt/index.html">Newt Tool Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../newtmgr/index.html">Newt Manager Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/index.html">Appendix</a></li>
</ul>

        
      
      </div>
    </div>
  </div>
  <!-- ENDS STICKY CONTAINER -->
</div>
<!-- ENDS .container-sidebar -->

            <div class="col-xs-12 col-sm-9">
              <div class="alert alert-info" role="alert">
  <p>
    This is the development version of Apache Mynewt documentation. As such it may not be as complete as the latest
    stable version of the documentation found <a href="/latest/os/introduction/">here</a>.
  </p>
  <p>
    To improve this documentation please visit <a href="https://github.com/apache/mynewt-documentation">https://github.com/apache/mynewt-documentation</a>.
  </p>
</div>
              
              <div class="">
                <div class="rst-content">
                  <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
                   <div itemprop="articleBody">
                    
  <div class="section" id="logging">
<h1>Logging<a class="headerlink" href="#logging" title="Permalink to this headline">¶</a></h1>
<p>Mynewt log package supports logging of information within a Mynewt
application. It allows packages to define their own log streams with
separate names. It also allows an application to control the output
destination of logs. ### Description</p>
<p>In the Mynewt OS, the log package comes in two versions:</p>
<ul class="simple">
<li>The <code class="docutils literal notranslate"><span class="pre">sys/log/full</span></code> package implements the complete log
functionality and API.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">sys/log/stub</span></code> package implements stubs for the API.</li>
</ul>
<p>Both packages export the <code class="docutils literal notranslate"><span class="pre">log</span></code> API, and any package that uses the log
API must list <code class="docutils literal notranslate"><span class="pre">log</span></code> as a requirement in its <code class="docutils literal notranslate"><span class="pre">pkg.yml</span></code> file as
follows:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">pkg.req_apis:</span>
<span class="go">    - log</span>
</pre></div>
</div>
<p>The application’s <code class="docutils literal notranslate"><span class="pre">pkg.yml</span></code> file specifies the version of the log
package to use. A project that requires the full logging capability must
list the <code class="docutils literal notranslate"><span class="pre">sys/log/full</span></code> package as a dependency in its <code class="docutils literal notranslate"><span class="pre">pkg.yml</span></code>
file:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">pkg.deps:</span>
<span class="go">    - sys/log/full</span>
</pre></div>
</div>
<p>You can use the <code class="docutils literal notranslate"><span class="pre">sys/log/stub</span></code> package if you want to build your
application without logging to reduce code size.</p>
<div class="section" id="syscfg-settings">
<h2>Syscfg Settings<a class="headerlink" href="#syscfg-settings" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">LOG_LEVEL</span></code> syscfg setting allows you to specify the level of logs
to enable in your application. Only logs for levels higher or equal to
the value of <code class="docutils literal notranslate"><span class="pre">LOG_LEVEL</span></code> are enabled. The amount of logs you include
affects your application code size. <code class="docutils literal notranslate"><span class="pre">LOG_LEVEL:</span> <span class="pre">0</span></code> specifies
LOG_LEVEL_DEBUG and includes all logs. You set <code class="docutils literal notranslate"><span class="pre">LOG_LEVEL:</span> <span class="pre">255</span></code> to
disable all logging. The <code class="docutils literal notranslate"><span class="pre">#defines</span></code> for the log levels are specified
in the <code class="docutils literal notranslate"><span class="pre">sys/log/full/include/log/log.h</span></code> file. For example the
following setting corresponds to LOG_LEVEL_ERROR:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">syscfg.vals:</span>
<span class="go">    LOG_LEVEL: 3</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">LOG_LEVEL</span></code> setting applies to all modules registered with the log
package.</p>
<div class="section" id="log">
<h3>Log<a class="headerlink" href="#log" title="Permalink to this headline">¶</a></h3>
<p>Each log stream requires a <code class="docutils literal notranslate"><span class="pre">log</span></code> structure to define its logging
properties.</p>
</div>
<div class="section" id="log-handler">
<h3>Log Handler<a class="headerlink" href="#log-handler" title="Permalink to this headline">¶</a></h3>
<p>To use logs, a log handler that handles the I/O from the log is
required. The log package comes with three pre-built log handlers:</p>
<ul class="simple">
<li>console – streams log events directly to the console port. Does not
support walking and reading.</li>
<li>cbmem – writes/reads log events to a circular buffer. Supports
walking and reading for access by newtmgr and shell commands.</li>
<li>fcb – writes/reads log events to a <a class="reference external" href="/os/modules/fcb/fcb.html">flash circular
buffer</a>. Supports walking and reading for
access by newtmgr and shell commands.</li>
</ul>
<p>In addition, it is possible to create custom log handlers for other
methods. Examples may include</p>
<ul class="simple">
<li>Flash file system</li>
<li>Flat flash buffer</li>
<li>Streamed over some other interface</li>
</ul>
<p>To use logging, you typically do not need to create your own log
handler. You can use one of the pre-built ones.</p>
<p>A package or an application must define a variable of type
<code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">log</span></code> and register a log handler for it with the log package.
It must call the <code class="docutils literal notranslate"><span class="pre">log_register()</span></code> function to specify the log handler
to use:</p>
<div class="code c highlight-none notranslate"><div class="highlight"><pre><span></span>log_register(char *name, struct log *log, const struct log_handler *lh, void *arg, uint8_t level)
</pre></div>
</div>
<p>The parameters are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">name</span></code>- Name of the log stream.</li>
<li><code class="docutils literal notranslate"><span class="pre">log</span></code> - Log instance to register,</li>
<li><code class="docutils literal notranslate"><span class="pre">lh</span></code> - Pointer to the log handler. You can specify one of the
pre-built ones:<ul>
<li><code class="docutils literal notranslate"><span class="pre">&amp;log_console_handler</span></code> for console</li>
<li><code class="docutils literal notranslate"><span class="pre">&amp;log_cbm_handler</span></code> for circular buffer</li>
<li><code class="docutils literal notranslate"><span class="pre">&amp;log_fcb_handler</span></code> for flash circular buffer</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">arg</span></code> - Opaque argument that the specified log handler uses. The
value of this argument depends on the log handler you specify:<ul>
<li>NULL for the <code class="docutils literal notranslate"><span class="pre">log_console_handler</span></code>.</li>
<li>Pointer to an initialized <code class="docutils literal notranslate"><span class="pre">cbmem</span></code> structure (see <code class="docutils literal notranslate"><span class="pre">util/cbmem</span></code>
package) for the <code class="docutils literal notranslate"><span class="pre">log_cbm_handler</span></code>.</li>
<li>Pointer to an initialized <code class="docutils literal notranslate"><span class="pre">fcb_log</span></code> structure (see <code class="docutils literal notranslate"><span class="pre">fs/fcb</span></code>
package) for the <code class="docutils literal notranslate"><span class="pre">log_fcb_handler</span></code>.</li>
</ul>
</li>
</ul>
<p>Typically, a package that uses logging defines a global variable, such
as <code class="docutils literal notranslate"><span class="pre">my_package_log</span></code>, of type <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">log</span></code>. The package can call the
<code class="docutils literal notranslate"><span class="pre">log_register()</span></code> function with default values, but usually an
application will override the logging properties and where to log to.
There are two ways a package can allow an application to override the
values:</p>
<ul class="simple">
<li>Define system configuration settings that an application can set and
the package can then call the <code class="docutils literal notranslate"><span class="pre">log_register()</span></code> function with the
configuration values.</li>
<li>Make the <code class="docutils literal notranslate"><span class="pre">my_package_log</span></code> variable external and let the application
call the <code class="docutils literal notranslate"><span class="pre">log_register()</span></code> function to specify a log handler for its
specific purpose.</li>
</ul>
</div>
<div class="section" id="configuring-logging-for-packages-that-an-application-uses">
<h3>Configuring Logging for Packages that an Application Uses<a class="headerlink" href="#configuring-logging-for-packages-that-an-application-uses" title="Permalink to this headline">¶</a></h3>
<p>Here is an example of how an application can set the log handlers for
the logs of the packages that the application includes.</p>
<p>In this example, the <code class="docutils literal notranslate"><span class="pre">package1</span></code> package defines the variable
<code class="docutils literal notranslate"><span class="pre">package1_log</span></code> of type <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">log</span></code> and externs the variable.
Similarly, the <code class="docutils literal notranslate"><span class="pre">package2</span></code> package defines the variable
<code class="docutils literal notranslate"><span class="pre">package2_log</span></code> and externs the variable. The application sets logs for
<code class="docutils literal notranslate"><span class="pre">package1</span></code> to use console and sets logs for <code class="docutils literal notranslate"><span class="pre">package2</span></code> to use a
circular buffer.</p>
<div class="code c highlight-none notranslate"><div class="highlight"><pre><span></span>#include &lt;package1/package1.h&gt;
#include &lt;package2/package2.h&gt;
#include &lt;util/cbmem.h&gt;

#include &lt;log/log.h&gt;

static uint32_t cbmem_buf[MAX_CBMEM_BUF];
static struct cbmem cbmem;


void app_log_init(void)
{



    log_register(&quot;package1_log&quot;, &amp;package1_log, &amp;log_console_handler, NULL, LOG_SYSLEVEL);

    cbmem_init(&amp;cbmem, cbmem_buf, MAX_CBMEM_BUF);
    log_register(&quot;package2_log&quot;, &amp;package2_log, &amp;log_cbmem_handler, &amp;cbmem, LOG_SYSLEVEL);

}
</pre></div>
</div>
</div>
<div class="section" id="implementing-a-package-that-uses-logging">
<h3>Implementing a Package that Uses Logging<a class="headerlink" href="#implementing-a-package-that-uses-logging" title="Permalink to this headline">¶</a></h3>
<p>This example shows how a package logs to console. The package registers
default logging properties to use the console, but allows an application
to override the values. It defines the <code class="docutils literal notranslate"><span class="pre">my_package_log</span></code> variable and
makes it external so an application can override log handler.</p>
<p>Make the <code class="docutils literal notranslate"><span class="pre">my_package_log</span></code> variable external:</p>
<div class="code c highlight-none notranslate"><div class="highlight"><pre><span></span>/* my_package.h*/

/* pick a unique name here */
extern struct log my_package_log;
</pre></div>
</div>
<p>Define the <code class="docutils literal notranslate"><span class="pre">my_package_log</span></code> variable and register the console log
handler:</p>
<div class="code c highlight-none notranslate"><div class="highlight"><pre><span></span>/* my_package.c */

struct log my_package_log;

{
    ...

    /* register my log with a name to the system */
    log_register(&quot;log&quot;, &amp;my_package_log, &amp;log_console_handler, NULL, LOG_LEVEL_DEBUG);

    LOG_DEBUG(&amp;my_package_log, LOG_MODULE_DEFAULT, &quot;bla&quot;);
    LOG_DEBUG(&amp;my_package_log, LOG_MODULE_DEFAULT, &quot;bab&quot;);
}
</pre></div>
</div>
</div>
<div class="section" id="log-api-and-log-levels">
<h3>Log API and Log Levels<a class="headerlink" href="#log-api-and-log-levels" title="Permalink to this headline">¶</a></h3>
<p>For more information on the <code class="docutils literal notranslate"><span class="pre">log</span></code> API and log levels, see the
<code class="docutils literal notranslate"><span class="pre">sys/log/full/include/log/log.h</span></code> header file.</p>
</div>
</div>
</div>


                   </div>
                  </div>
                  
                </div>
              </div>
            </div>
            <!-- ENDS CONTENT SECTION -->
          </div>
          <!-- ENDS .content -->
        </div>
      </div>
      <footer>
  <div class="container">
    <div class="row">
      <div class="col-xs-12">
          
              <p class="copyright">Apache Mynewt is available under Apache License, version 2.0.</p>
          
      </div>
      <div class="col-xs-12">
          <div class="logos">
              <img src="../../../_static/img/asf_logo_wide_small.png" alt="Apache" title="Apache">
              <small class="footnote">
                Apache Mynewt, Mynewt, Apache, the Apache feather logo, and the Apache Mynewt project logo are either
                registered trademarks or trademarks of the Apache Software Foundation in the United States and other countries.
              </small>
              <a href="https://join.slack.com/mynewt/shared_invite/MTkwMTg1ODM1NTg5LTE0OTYxNzQ4NzQtZTU1YmNhYjhkMg">
                <img src="../../../_static/img/add_to_slack.png" alt="Slack Icon" title="Join our Slack Community" />
              </a>
          </div>
      </div>
    </div>
  </div>
</footer>
    </div>
    <!-- ENDS #wrapper -->

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1.3.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../_static/js/bootstrap-3.0.3.min.js"></script>
      <script type="text/javascript" src="../../../_static/js/affix.js"></script>
      <script type="text/javascript" src="../../../_static/js/main.js"></script>

   

  </body>
</html>