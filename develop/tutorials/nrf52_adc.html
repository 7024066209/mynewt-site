

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    

    
    <title>Adding an Analog Sensor on nRF52 &mdash; Apache Mynewt 1.3.0 documentation</title>
    

    
    
      <link rel="shortcut icon" href="../_static/mynewt-logo-only-newt32x32.png"/>
    

    

    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

    
      <link rel="stylesheet" href="../_static/css/sphinx_theme.css" type="text/css" />
    
      <link rel="stylesheet" href="../_static/css/bootstrap-3.0.3.min.css" type="text/css" />
    
      <link rel="stylesheet" href="../_static/css/v2.css" type="text/css" />
    
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    
      <link rel="stylesheet" href="../_static/css/restructuredtext.css" type="text/css" />
    

    

    <link rel="stylesheet" href="../_static/css/overrides.css" type="text/css" />
          <link rel="index" title="Index"
                href="../genindex.html"/>
          <link rel="search" title="Search" href="../search.html"/>
      <link rel="top" title="Apache Mynewt 1.3.0 documentation" href="../index.html"/> 

    
    <script src="../_static/js/modernizr.min.js"></script>

    
    <script>
    (function(i, s, o, g, r, a, m) {
	i["GoogleAnalyticsObject"] = r;
	(i[r] =
		i[r] ||
		function() {
			(i[r].q = i[r].q || []).push(arguments);
		}),
		(i[r].l = 1 * new Date());
	(a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
	a.async = 1;
	a.src = g;
	m.parentNode.insertBefore(a, m);
})(window, document, "script", "//www.google-analytics.com/analytics.js", "ga");

ga("create", "UA-72162311-1", "auto");
ga("send", "pageview");
</script>
    

  </head>

  <body class="not-front page-documentation" role="document" >
    <div id="wrapper">
      <div class="container">
    <div id="banner" class="row v2-main-banner">
        <a class="logo-cell" href="/">
            <img class="logo" src="../_static/img/logo.png">
        </a>
        <div class="tagline-cell">
            <h4 class="tagline">An OS to build, deploy and securely manage billions of devices</h4>
        </div>
        <div class="news-cell">
            <div class="well">
              <h4>Latest News:</h4> <a href="/download">Apache Mynewt 1.3.0</a> released (December 13, 2017)
            </div>
        </div>
    </div>
</div>
      
<header>
    <nav id="navbar" class="navbar navbar-inverse" role="navigation">
        <div class="container">
            <!-- Collapsed navigation -->
            <div class="navbar-header">
                <!-- Expander button -->
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>

            </div>

            <!-- Expanded navigation -->
            <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/"><i class="fa fa-home" style="font-size: larger;"></i></a>
                    </li>
                    <li class="important">
                        <a href="/get_started/quick_start.html">Quick Start</a>
                    </li>
                    <li>
                        <a href="/about/">About</a>
                    </li>
                    <li>
                        <a href="/talks/">Talks</a>
                    </li>
                    <li class="active">
                        <a href="/documentation/">Documentation</a>
                    </li>
                    <li>
                        <a href="/download/">Download</a>
                    </li>
                    <li>
                        <a href="/community/">Community</a>
                    </li>
                    <li>
                        <a href="/events/">Events</a>
                    </li>
                </ul>

                <!-- Search, Navigation and Repo links -->
                <ul class="nav navbar-nav navbar-right">
                    
                </ul>
            </div>
        </div>
    </nav>
</header>
      <!-- STARTS MAIN CONTENT -->
      <div id="main-content">
        





<div id="breadcrumb">
  <div class="container">
    <a href="/documentation/">Docs</a> /
    
    Adding an Analog Sensor on nRF52
    
  <div class="sourcelink">
    <a href="https://github.com/apache/mynewt-documentation/edit/master/docs/tutorials/nrf52_adc.rst" class="icon icon-github"
           rel="nofollow"> Edit on GitHub</a>
</div>
  </div>
</div>
        <!-- STARTS CONTAINER -->
        <div class="container">
          <!-- STARTS .content -->
          <div id="content" class="row">
            
            <!-- STARTS .container-sidebar -->
<div class="container-sidebar col-xs-12 col-sm-3">
  <div id="docSidebar" class="sticky-container">
    <div role="search" class="sphinx-search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search documentation" class="search-documentation" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
    
<!-- Note: only works when deployed -->
<select class="form-control" onchange="if (this.value) window.location.href=this.value">
    <option
      value="/develop"
      selected
      >
      Version: develop (latest - mynewt-documentation)
    </option>
    <option
      value="/latest/os/introduction"
      >
      Version: master (latest - mynewt-site)
    </option>
    <option
      value="/v1_2_0/os/introduction"
      >
      Version: 1.2.0
    </option>
    <option
      value="/v1_1_0/os/introduction">
      Version: 1.1.0
    </option>
    <option
      value="/v1_0_0/os/introduction">
      Version: 1.0.0
    </option>
    <option
      value="/v0_9_0/os/introduction">
      Version: 0_9_0
    </option>
</select>
    <div class="region region-sidebar">
      <div class="docs-menu">
      
        
        
            <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../get_started/index.html">Setup &amp; Get Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../os/os_user_guide.html">OS User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../network/ble/ble_intro.html">BLE User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../newt/index.html">Newt Tool Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../newtmgr/index.html">Newt Manager Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/index.html">Appendix</a></li>
</ul>

        
      
      </div>
    </div>
  </div>
  <!-- ENDS STICKY CONTAINER -->
</div>
<!-- ENDS .container-sidebar -->

            <div class="col-xs-12 col-sm-9">
              <div class="alert alert-info" role="alert">
  <p>
    This is the development version of Apache Mynewt documentation. As such it may not be as complete as the latest
    stable version of the documentation found <a href="/latest/os/introduction/">here</a>.
  </p>
  <p>
    To improve this documentation please visit <a href="https://github.com/apache/mynewt-documentation">https://github.com/apache/mynewt-documentation</a>.
  </p>
</div>
              
              <div class="">
                <div class="rst-content">
                  <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
                   <div itemprop="articleBody">
                    
  <div class="section" id="adding-an-analog-sensor-on-nrf52">
<h1>Adding an Analog Sensor on nRF52<a class="headerlink" href="#adding-an-analog-sensor-on-nrf52" title="Permalink to this headline">¶</a></h1>
<div class="section" id="objective">
<h2>Objective<a class="headerlink" href="#objective" title="Permalink to this headline">¶</a></h2>
<p>We will be adding an analog sensor to the NRF52DK development board and
using the Analog to Digital Converter (ADC) to read the values from the
sensor. It’s also using Bluetooth to allow you to connect to the app and
read the value of the sensor. Please see the following section for the
required hardware in order to complete this tutorial.</p>
</div>
<div class="section" id="hardware-needed">
<h2>Hardware needed<a class="headerlink" href="#hardware-needed" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>nRF52 Development Kit (one of the following)<ul>
<li>Dev Kit from Nordic - PCA 10040</li>
<li>Eval Kit from Rigado - BMD-300-EVAL-ES</li>
</ul>
</li>
<li>eTape Liquid Sensor – buy from
<a class="reference external" href="https://www.adafruit.com/products/1786">Adafruit</a></li>
<li>Laptop running Mac OS</li>
<li>It is assumed you have already installed newt tool.</li>
<li>It is assumed you already installed native tools as described
<a class="reference external" href="../get_started/native_tools.html">here</a></li>
</ul>
</div>
<div class="section" id="create-a-project">
<h2>Create a project.<a class="headerlink" href="#create-a-project" title="Permalink to this headline">¶</a></h2>
<p>Create a new project to hold your work. For a deeper understanding, you
can read about project creation in <a class="reference external" href="../get_started/project_create.html">Get Started – Creating Your First
Project</a> or just follow the
commands below.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ mkdir ~/dev
$ cd ~/dev
$ newt new myadc
Downloading project skeleton from apache/mynewt-blinky...
Installing skeleton in myadc...
Project myadc successfully created.
$ cd myadc
</pre></div>
</div>
</div>
<div class="section" id="add-additional-repositories">
<h2>Add Additional Repositories<a class="headerlink" href="#add-additional-repositories" title="Permalink to this headline">¶</a></h2>
<p>The board-specific libraries for the NRF52dk board are in an external
repository at present, so you’ll need to include that remote repository
and install it as well. If you’re not familiar with using repositories,
see the section on <a class="reference external" href="repo/add_repos.html">repositories</a> before
continuing. Or just copy and paste the following.</p>
<p>In your <code class="docutils literal notranslate"><span class="pre">project.yml</span></code> file, add <code class="docutils literal notranslate"><span class="pre">mynewt_nordic</span></code> to the
<code class="docutils literal notranslate"><span class="pre">project.repositories</span></code> section, and then add the proper repository
definition. When you’re done, your <code class="docutils literal notranslate"><span class="pre">project.yml</span></code> file should look like
this:</p>
<p>```hl_lines=”5 15 16 17 18 19” project.name: “my_project”</p>
<p>project.repositories: - apache-mynewt-core - mynewt_nordic</p>
<div class="section" id="use-github-s-distribution-mechanism-for-core-asf-libraries">
<h3>Use github’s distribution mechanism for core ASF libraries.<a class="headerlink" href="#use-github-s-distribution-mechanism-for-core-asf-libraries" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="this-provides-mirroring-automatically-for-us">
<h3>This provides mirroring automatically for us.<a class="headerlink" href="#this-provides-mirroring-automatically-for-us" title="Permalink to this headline">¶</a></h3>
<p>repository.apache-mynewt-core: type: github vers: 1-latest user: apache
repo: incubator-mynewt-core repository.mynewt_nordic: type: github
vers: 1-latest user: runtimeco repo: mynewt_nordic</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;br&gt;

### Install Everything

Now that you have defined the needed repositories, it&#39;s time to install everything so
that you can get started.
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ newt install -v
apache-mynewt-core
Downloading repository description for apache-mynewt-core... success!
...
apache-mynewt-core successfully installed version 0.9.0-none
...
mynewt_nordic
Downloading repository description for mynewt_nordic... success!
...
mynewt_nordic successfully installed version 0.9.9-none
</pre></div>
</div>
<p>```</p>
</div>
</div>
<div class="section" id="create-the-targets">
<h2>Create the targets<a class="headerlink" href="#create-the-targets" title="Permalink to this headline">¶</a></h2>
<p>Create two targets - one for the bootloader and one for the nrf52 board.</p>
<p>Note: The correct bsp must be chosen for the board you are using.</p>
<ul class="simple">
<li>For the Nordic Dev Kit choose &#64;apache-mynewt-core/hw/bsp/nrf52dk
instead (in the highlighted lines)</li>
<li>For the Rigado Eval Kit choose &#64;apache-mynewt-core/hw/bsp/bmd300eval
instead (in the highlighted lines)</li>
</ul>
<p>For the app itself we’re going to extend the
<a class="reference external" href="belpprph/bleprph-app.html">bleprph</a> app so that we get the Bluetooth
communications built in, so the first thing we’ll need to do is copy
that app into our own app directory:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> mkdir -p apps/nrf52_adc
<span class="gp">$</span> cp -Rp repos/apache-mynewt-core/apps/bleprph/* apps/nrf52_adc
</pre></div>
</div>
<p>Next, you’ll modify the <code class="docutils literal notranslate"><span class="pre">pkg.yml</span></code> file for your app. Note the change
in <code class="docutils literal notranslate"><span class="pre">pkg.name</span></code> and <code class="docutils literal notranslate"><span class="pre">pkg.description</span></code>. Also make sure that you specify
the full path of all the packages with the prefix
<code class="docutils literal notranslate"><span class="pre">&#64;apache-mynewt-core/</span></code> as shown in the third highlighted line.</p>
<p>```hl_lines=”3 5 11” $ cat apps/nrf52_adc/pkg.yml … pkg.name:
apps/nrf52_adc pkg.type: app pkg.description: Simple BLE peripheral
application for ADC Sensors. pkg.author: “Apache Mynewt
<a class="reference external" href="mailto:dev&#37;&#52;&#48;mynewt&#46;incubator&#46;apache&#46;org">dev<span>&#64;</span>mynewt<span>&#46;</span>incubator<span>&#46;</span>apache<span>&#46;</span>org</a>” pkg.homepage:
“<a class="reference external" href="http://mynewt.apache.org/">http://mynewt.apache.org/</a>” pkg.keywords:</p>
<p>pkg.deps: - “&#64;apache-mynewt-core/boot/split” -
“&#64;apache-mynewt-core/kernel/os” - “&#64;apache-mynewt-core/mgmt/imgmgr” -
“&#64;apache-mynewt-core/mgmt/newtmgr” -
“&#64;apache-mynewt-core/mgmt/newtmgr/transport/ble” -
“&#64;apache-mynewt-core/net/nimble/controller” -
“&#64;apache-mynewt-core/net/nimble/host” -
“&#64;apache-mynewt-core/net/nimble/host/services/ans” -
“&#64;apache-mynewt-core/net/nimble/host/services/gap” -
“&#64;apache-mynewt-core/net/nimble/host/services/gatt” -
“&#64;apache-mynewt-core/net/nimble/host/store/ram” -
“&#64;apache-mynewt-core/net/nimble/transport/ram” -
“&#64;apache-mynewt-core/sys/console/full” -
“&#64;apache-mynewt-core/sys/log/full” -
“&#64;apache-mynewt-core/sys/stats/full” - “&#64;apache-mynewt-core/sys/sysinit”
- “&#64;apache-mynewt-core/sys/id” ```</p>
<p>Great! We have our very own app so let’s make sure we have all of our
targets set correctly:</p>
<p>```hl_lines=”3 8” $ newt target create nrf52_adc $ newt target set
nrf52_adc app=apps/nrf52_adc Target targets/nrf52_adc successfully
set target.app to apps/nrf52_adc $ newt target set nrf52_adc
<a class="reference external" href="mailto:bsp=&#37;&#52;&#48;apache-mynewt-core/hw/bsp/nrf52dk">bsp=<span>&#64;</span>apache-mynewt-core/hw/bsp/nrf52dk</a> $ newt target set nrf52_adc
build_profile=debug</p>
<p>$ newt target create nrf52_boot $ newt target set nrf52_boot
<a class="reference external" href="mailto:app=&#37;&#52;&#48;apache-mynewt-core/apps/boot">app=<span>&#64;</span>apache-mynewt-core/apps/boot</a> $ newt target set nrf52_boot
<a class="reference external" href="mailto:bsp=&#37;&#52;&#48;apache-mynewt-core/hw/bsp/nrf52dk">bsp=<span>&#64;</span>apache-mynewt-core/hw/bsp/nrf52dk</a> $ newt target set nrf52_boot
build_profile=optimized</p>
<p>$ newt target show targets/nrf52_adc app=apps/nrf52_adc
<a class="reference external" href="mailto:bsp=&#37;&#52;&#48;apache-mynewt-core/hw/bsp/nrf52dk">bsp=<span>&#64;</span>apache-mynewt-core/hw/bsp/nrf52dk</a> build_profile=debug
targets/nrf52_boot <a class="reference external" href="mailto:app=&#37;&#52;&#48;apache-mynewt-core/apps/boot">app=<span>&#64;</span>apache-mynewt-core/apps/boot</a>
<a class="reference external" href="mailto:bsp=&#37;&#52;&#48;apache-mynewt-core/hw/bsp/nrf52dk">bsp=<span>&#64;</span>apache-mynewt-core/hw/bsp/nrf52dk</a> build_profile=optimized</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;font color=&quot;#F2853F&quot;&gt;
Note: If you&#39;ve already built and installed a bootloader for your NRF52dk then you do
not need to create a target for it here, or build and load it as below. &lt;/font&gt;
&lt;br&gt;

### Build the target executables
</pre></div>
</div>
<p>$ newt build nrf52_boot … Compiling boot.c Archiving boot.a Linking
boot.elf App successfully built:
~/dev/myadc/bin/nrf52_boot/apps/boot/boot.elf</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ newt build nrf52\_adc ... Compiling main.c Archiving nrf52\_adc.a
</pre></div>
</div>
<p>Linking nrf52_adc.elf App successfully built:
~/dev/myadc/bin/nrf52_adc/apps/nrf52_adc/nrf52_adc.elf</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;br&gt;

### Sign and create the nrf52_adc application image

You must sign and version your application image to download it using newt to the board.
Use the newt create-image command to perform this action. You may assign an arbitrary
version (e.g. 1.0.0) to the image.
</pre></div>
</div>
<p>$ newt create-image nrf52_adc 1.0.0 App image successfully generated:
~/dev/myadc/bin/nrf52_adc/apps/nrf52_adc/nrf52_adc.img Build
manifest: ~/dev/myadc/bin/nrf52_adc/apps/nrf52_adc/manifest.json</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;br&gt;

### Connect the board

Connect the evaluation board via micro-USB to your PC via USB cable.

&lt;br&gt;

### Download to the target

Download the bootloader first and then the nrf52_adc executable to the target platform.
Don&#39;t forget to reset the board if you don&#39;t see the LED blinking right away!
</pre></div>
</div>
<p>$ newt load nrf52_boot $ newt load nrf52_adc</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;br&gt;

**Note:** If you want to erase the flash and load the image again, you can use JLinkExe to issue an `erase` command.
</pre></div>
</div>
<p>$ JLinkExe -device nRF52 -speed 4000 -if SWD SEGGER J-Link Commander
V5.12c (Compiled Apr 21 2016 16:05:51) DLL version V5.12c, compiled Apr
21 2016 16:05:45</p>
<p>Connecting to J-Link via USB…O.K. Firmware: J-Link
OB-SAM3U128-V2-NordicSemi compiled Mar 15 2016 18:03:17 Hardware
version: V1.00 S/N: 682863966 VTref = 3.300V</p>
<p>Type “connect” to establish a target connection, ‘?’ for help
J-Link&gt;erase Cortex-M4 identified. Erasing device (0;?i?)… Comparing
flash [100%] Done. Erasing flash [100%] Done. Verifying flash [100%]
Done. J-Link: Flash download: Total time needed: 0.363s (Prepare:
0.093s, Compare: 0.000s, Erase: 0.262s, Program: 0.000s, Verify: 0.000s,
Restore: 0.008s) Erasing done. J-Link&gt;exit $ ```</p>
<p>So you have a BLE app, but really all you’ve done is change the name of
the <strong>bleprph</strong> app to <strong>nrf52_adc</strong> and load that. Not all that
impressive, and it certainly won’t read an Analog Sensor right now. So
let’s do that next. In order to read an ADC sensor, and since the ADC
package is in an external, licensed, repository, we’ll create a driver
for it here in our app that will leverage the existing driver in the
external repository. It adds another layer of indirection, but it will
also give us a look at building our own driver, so we’ll do it this way.</p>
</div>
<div class="section" id="building-a-driver">
<h2>Building a Driver<a class="headerlink" href="#building-a-driver" title="Permalink to this headline">¶</a></h2>
<p>The first thing to do is to create the directory structure for your
driver:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">[user@IsMyLaptop:~/src/air_quality]$</span> mkdir -p libs/my_drivers/myadc/include/myadc
<span class="gp">[user@IsMyLaptop:~/src/air_quality]$</span> mkdir -p libs/my_drivers/myadc/src
</pre></div>
</div>
<p>Now you can add the files you need. You’ll need a pkg.yml to describe
the driver, and then header stub followed by source stub.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">[user@IsMyLaptop:~/src/air_quality]$</span> cat libs/my_drivers/myadc/pkg.yml
</pre></div>
</div>
<div class="code c highlight-none notranslate"><div class="highlight"><pre><span></span>#
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# &quot;License&quot;); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#  http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.
#
pkg.name: libs/my_drivers/myadc
pkg.deps:
    - &quot;@apache-mynewt-core/hw/hal&quot;
    - &quot;@mynewt_nordic/hw/drivers/adc/adc_nrf52&quot;
</pre></div>
</div>
<p>First, let’s create the required header file <code class="docutils literal notranslate"><span class="pre">myadc.h</span></code> in the includes
directory i.e. <code class="docutils literal notranslate"><span class="pre">libs/my_drivers/myadc/include/myadc/myadc.h</span></code>. It’s a
pretty straightforward header file, since we only need to do 2 things:</p>
<ul class="simple">
<li>Initialize the ADC device</li>
<li>Read ADC Values</li>
</ul>
<div class="code c highlight-none notranslate"><div class="highlight"><pre><span></span>#ifndef _NRF52_ADC_H_
#define _NRF52_ADC_H_

void * adc_init(void);
int adc_read(void *buffer, int buffer_len);

#endif /* _NRF52_ADC_H_ */
</pre></div>
</div>
<p>Next we’ll need a corresponding source file <code class="docutils literal notranslate"><span class="pre">myadc.c</span></code> in the src
directory. This is where we’ll implement the specifics of the driver:</p>
<div class="code c highlight-none notranslate"><div class="highlight"><pre><span></span>#include &lt;assert.h&gt;
#include &lt;os/os.h&gt;
/* ADC */
#include &quot;myadc/myadc.h&quot;
#include &quot;nrf.h&quot;
#include &quot;app_util_platform.h&quot;
#include &quot;app_error.h&quot;
#include &lt;adc/adc.h&gt;
#include &lt;adc_nrf52/adc_nrf52.h&gt;
#include &quot;nrf_drv_saadc.h&quot;


#define ADC_NUMBER_SAMPLES (2)
#define ADC_NUMBER_CHANNELS (1)

nrf_drv_saadc_config_t adc_config = NRF_DRV_SAADC_DEFAULT_CONFIG;

struct adc_dev *adc;
uint8_t *sample_buffer1;
uint8_t *sample_buffer2;

static struct adc_dev os_bsp_adc0;
static nrf_drv_saadc_config_t os_bsp_adc0_config = {
    .resolution         = MYNEWT_VAL(ADC_0_RESOLUTION),
    .oversample         = MYNEWT_VAL(ADC_0_OVERSAMPLE),
    .interrupt_priority = MYNEWT_VAL(ADC_0_INTERRUPT_PRIORITY),
};
void *
adc_init(void)
{
    int rc = 0;

    rc = os_dev_create((struct os_dev *) &amp;os_bsp_adc0, &quot;adc0&quot;,
            OS_DEV_INIT_KERNEL, OS_DEV_INIT_PRIO_DEFAULT,
            nrf52_adc_dev_init, &amp;os_bsp_adc0_config);
    assert(rc == 0);
    nrf_saadc_channel_config_t cc = NRF_DRV_SAADC_DEFAULT_CHANNEL_CONFIG_SE(NRF_SAADC_INPUT_AIN1);
    cc.gain = NRF_SAADC_GAIN1_6;
    cc.reference = NRF_SAADC_REFERENCE_INTERNAL;
    adc = (struct adc_dev *) os_dev_open(&quot;adc0&quot;, 0, &amp;adc_config);
    assert(adc != NULL);
    adc_chan_config(adc, 0, &amp;cc);
    sample_buffer1 = malloc(adc_buf_size(adc, ADC_NUMBER_CHANNELS, ADC_NUMBER_SAMPLES));
    sample_buffer2 = malloc(adc_buf_size(adc, ADC_NUMBER_CHANNELS, ADC_NUMBER_SAMPLES));
    memset(sample_buffer1, 0, adc_buf_size(adc, ADC_NUMBER_CHANNELS, ADC_NUMBER_SAMPLES));
    memset(sample_buffer2, 0, adc_buf_size(adc, ADC_NUMBER_CHANNELS, ADC_NUMBER_SAMPLES));
    adc_buf_set(adc, sample_buffer1, sample_buffer2,
        adc_buf_size(adc, ADC_NUMBER_CHANNELS, ADC_NUMBER_SAMPLES));
    return adc;
}


int
adc_read(void *buffer, int buffer_len)
{
    int i;
    int adc_result;
    int my_result_mv = 0;
    int rc;
    for (i = 0; i &lt; ADC_NUMBER_SAMPLES; i++) {
        rc = adc_buf_read(adc, buffer, buffer_len, i, &amp;adc_result);
        if (rc != 0) {
            goto err;
        }
        my_result_mv = adc_result_mv(adc, 0, adc_result);
    }
    adc_buf_release(adc, buffer, buffer_len);
    return my_result_mv;
err:
    return (rc);
}
</pre></div>
</div>
<p>There’s a lot going on in here, so let’s walk through it step by step.</p>
<p>First, we define a default configuration, with the resolution,
oversample and interrupt priority. You’ll see that these are
<code class="docutils literal notranslate"><span class="pre">MYNEWT_VAL</span></code> values, which means that we’ll define them shortly in a
<code class="docutils literal notranslate"><span class="pre">syscfg.yml</span></code> file to be passed to the compiler at build time.</p>
<div class="code c highlight-none notranslate"><div class="highlight"><pre><span></span>static struct adc_dev os_bsp_adc0;
static nrf_drv_saadc_config_t os_bsp_adc0_config = {
    .resolution         = MYNEWT_VAL(ADC_0_RESOLUTION),
    .oversample         = MYNEWT_VAL(ADC_0_OVERSAMPLE),
    .interrupt_priority = MYNEWT_VAL(ADC_0_INTERRUPT_PRIORITY),
};
</pre></div>
</div>
<p>Next, in <code class="docutils literal notranslate"><span class="pre">adc_init()</span></code> , we need to tell the OS to create the device.</p>
<div class="code c highlight-none notranslate"><div class="highlight"><pre><span></span>void *
adc_init(void)
{
    int rc = 0;

    rc = os_dev_create((struct os_dev *) &amp;os_bsp_adc0, &quot;adc0&quot;,
            OS_DEV_INIT_KERNEL, OS_DEV_INIT_PRIO_DEFAULT,
            nrf52_adc_dev_init, &amp;os_bsp_adc0_config);
    assert(rc == 0);
    nrf_saadc_channel_config_t cc = NRF_DRV_SAADC_DEFAULT_CHANNEL_CONFIG_SE(NRF_SAADC_INPUT_AIN1);
    cc.gain = NRF_SAADC_GAIN1_6;
    cc.reference = NRF_SAADC_REFERENCE_INTERNAL;
    adc = (struct adc_dev *) os_dev_open(&quot;adc0&quot;, 0, &amp;adc_config);
    assert(adc != NULL);
    adc_chan_config(adc, 0, &amp;cc);
    sample_buffer1 = malloc(adc_buf_size(adc, ADC_NUMBER_CHANNELS, ADC_NUMBER_SAMPLES));
    sample_buffer2 = malloc(adc_buf_size(adc, ADC_NUMBER_CHANNELS, ADC_NUMBER_SAMPLES));
    memset(sample_buffer1, 0, adc_buf_size(adc, ADC_NUMBER_CHANNELS, ADC_NUMBER_SAMPLES));
    memset(sample_buffer2, 0, adc_buf_size(adc, ADC_NUMBER_CHANNELS, ADC_NUMBER_SAMPLES));
    adc_buf_set(adc, sample_buffer1, sample_buffer2,
        adc_buf_size(adc, ADC_NUMBER_CHANNELS, ADC_NUMBER_SAMPLES));
    return adc;
}
</pre></div>
</div>
<p>A few things need to be said about this part, as it is the most
confusing. First, we’re using a <strong>default</strong> configuration for the ADC
Channel via the <code class="docutils literal notranslate"><span class="pre">NRF_DRV_SAADC_DEFAULT_CHANNEL_CONFIG_SE</span></code> macro. The
important part here is that we’re actually using <code class="docutils literal notranslate"><span class="pre">AIN1</span></code>. I know what
you’re thinking, “But we want ADC-0!” and that’s true. The board is
actually labelled ‘A0, A1, A2’ etc., and the actual pin numbers are also
listed on the board, which seems handy. At first. But it gets messy very
quickly.</p>
<p>If you try to use AIN0, and then go poke around in the registers while
this is running,</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(gdb) p/x {NRF_SAADC_Type}0x40007000
...
 CH = {{
      PSELP = 0x1,
      PSELN = 0x0,
      CONFIG = 0x20000,
      LIMIT = 0x7fff8000
    },
</pre></div>
</div>
<p>You’ll see that the pin for channel 0 is set to 1, which corresponds to
AIN0, but that’s <strong>NOT</strong> the same as A0 – pin P0.03, the one we’re
using. For that, you use AIN1, which would set the pin value to 2.
Messy. Someone, somewhere, thought this made sense.</p>
<p>The only other thing to note here is that we’re using the internal
reference voltage, rather than setting our own. There’s nothing wrong
with that, but since we are, we’ll have to crank up the gain a bit by
using <code class="docutils literal notranslate"><span class="pre">NRF_SAADC_GAIN1_6</span></code>.</p>
<p>Then, in <code class="docutils literal notranslate"><span class="pre">adc_read()</span></code> we will take readings, convert the raw readings
to a millivolt equivalent, and return the result.</p>
<div class="code c highlight-none notranslate"><div class="highlight"><pre><span></span>int
adc_read(void *buffer, int buffer_len)
{
    int i;
    int adc_result;
    int my_result_mv = 0;
    int rc;
    for (i = 0; i &lt; ADC_NUMBER_SAMPLES; i++) {
        rc = adc_buf_read(adc, buffer, buffer_len, i, &amp;adc_result);
        if (rc != 0) {
            goto err;
        }
        my_result_mv = adc_result_mv(adc, 0, adc_result);
    }
    adc_buf_release(adc, buffer, buffer_len);
    return my_result_mv;
err:
    return (rc);
}
</pre></div>
</div>
<p>Finally, we’ll need some settings for our driver, as mentioned earlier.
In the <code class="docutils literal notranslate"><span class="pre">myadc</span></code> directory you’ll need to add a <code class="docutils literal notranslate"><span class="pre">syscfg.yml</span></code> file:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> Package: libs/my_driver/myadc

<span class="go">syscfg.defs:</span>
<span class="go">    ADC_0:</span>
<span class="go">        description: &#39;TBD&#39;</span>
<span class="go">        value:  1</span>
<span class="go">    ADC_0_RESOLUTION:</span>
<span class="go">        description: &#39;TBD&#39;</span>
<span class="go">        value: &#39;SAADC_CONFIG_RESOLUTION&#39;</span>
<span class="go">    ADC_0_OVERSAMPLE:</span>
<span class="go">        description: &#39;TBD&#39;</span>
<span class="go">        value: &#39;SAADC_CONFIG_OVERSAMPLE&#39;</span>
<span class="go">    ADC_0_INTERRUPT_PRIORITY:</span>
<span class="go">        description: &#39;TBD&#39;</span>
<span class="go">        value: &#39;SAADC_CONFIG_IRQ_PRIORITY&#39;</span>
</pre></div>
</div>
<p>Once that’s all done, you should have a working ADC Driver for your
NRF52DK board. The last step in getting the driver set up is to include
it in the package dependency defined by <code class="docutils literal notranslate"><span class="pre">pkg.deps</span></code> in the <code class="docutils literal notranslate"><span class="pre">pkg.yml</span></code>
file of your app. Add it in <code class="docutils literal notranslate"><span class="pre">apps/nrf52_adc/pkg.yml</span></code> as shown by the
highlighted line below.</p>
</div>
<div class="section" id="creating-the-adc-task">
<h2>Creating the ADC Task<a class="headerlink" href="#creating-the-adc-task" title="Permalink to this headline">¶</a></h2>
<p>Now that the driver is done, we’ll need to add calls to the main app’s
<code class="docutils literal notranslate"><span class="pre">main.c</span></code> file, as well as a few other things. First, we’ll need to
update the includes, and add a task for our ADC sampling.</p>
<div class="code c highlight-none notranslate"><div class="highlight"><pre><span></span>#include &quot;myadc/myadc.h&quot;
...
/* ADC Task settings */
#define ADC_TASK_PRIO           5
#define ADC_STACK_SIZE          (OS_STACK_ALIGN(336))
struct os_eventq adc_evq;
struct os_task adc_task;
bssnz_t os_stack_t adc_stack[ADC_STACK_SIZE];
</pre></div>
</div>
<p>Next we’ll need o initialize the task <code class="docutils literal notranslate"><span class="pre">event_q</span></code> so we’ll add the
highlighted code to <code class="docutils literal notranslate"><span class="pre">main()</span></code> as shown below:</p>
<p>```c hl_lines=”7 8 9 10 11 12 13 14 15” /* Set the default device
name. */ rc = ble_svc_gap_device_name_set(“nimble-adc”); assert(rc
== 0);</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>conf_load();

/* Initialize adc sensor task eventq */
os_eventq_init(&amp;adc_evq);

/* Create the ADC reader task.
 * All sensor operations are performed in this task.
 */
os_task_init(&amp;adc_task, &quot;sensor&quot;, adc_task_handler,
        NULL, ADC_TASK_PRIO, OS_WAIT_FOREVER,
        adc_stack, ADC_STACK_SIZE);
</pre></div>
</div>
<p>``<code class="docutils literal notranslate"><span class="pre">We'll</span> <span class="pre">need</span> <span class="pre">that</span></code>adc_task_handler()<code class="docutils literal notranslate"><span class="pre">function</span> <span class="pre">to</span> <span class="pre">exist,</span> <span class="pre">and</span> <span class="pre">that's</span> <span class="pre">where</span> <span class="pre">we'll</span> <span class="pre">initialize</span> <span class="pre">the</span> <span class="pre">ADC</span> <span class="pre">Device</span> <span class="pre">and</span> <span class="pre">set</span> <span class="pre">the</span> <span class="pre">event</span> <span class="pre">handler.</span> <span class="pre">In</span> <span class="pre">the</span> <span class="pre">task's</span> <span class="pre">while()</span> <span class="pre">loop,</span> <span class="pre">we'll</span> <span class="pre">just</span> <span class="pre">make</span> <span class="pre">a</span> <span class="pre">call</span> <span class="pre">to</span></code>adc_sample()`
to cause the ADC driver to sample the adc device.</p>
<div class="code c highlight-none notranslate"><div class="highlight"><pre><span></span>/**
 * Event loop for the sensor task.
 */
static void
adc_task_handler(void *unused)
{
    struct adc_dev *adc;
    int rc;
    /* ADC init */
    adc = adc_init();
    rc = adc_event_handler_set(adc, adc_read_event, (void *) NULL);
    assert(rc == 0);

    while (1) {
        adc_sample(adc);
        /* Wait 2 second */
        os_time_delay(OS_TICKS_PER_SEC * 2);
    }
}
</pre></div>
</div>
<p>Above the <code class="docutils literal notranslate"><span class="pre">adc_task_handler</span></code>, add code to handle the
<code class="docutils literal notranslate"><span class="pre">adc_read_event()</span></code> calls:</p>
<div class="code c highlight-none notranslate"><div class="highlight"><pre><span></span>int
adc_read_event(struct adc_dev *dev, void *arg, uint8_t etype,
        void *buffer, int buffer_len)
{
    int value;
    uint16_t chr_val_handle;
    int rc;

    value = adc_read(buffer, buffer_len);
    if (value &gt;= 0) {
        console_printf(&quot;Got %d\n&quot;, value);
    } else {
        console_printf(&quot;Error while reading: %d\n&quot;, value);
        goto err;
    }
    gatt_adc_val = value;
    rc = ble_gatts_find_chr(&amp;gatt_svr_svc_adc_uuid.u, BLE_UUID16_DECLARE(ADC_SNS_VAL), NULL, &amp;chr_val_handle);
    assert(rc == 0);
    ble_gatts_chr_updated(chr_val_handle);
    return (0);
err:
    return (rc);
}
</pre></div>
</div>
<p>This is where we actually read the ADC value and then update the BLE
Characteristic for that value.</p>
<p>But wait, we haven’t defined those BLE services and characteristics yet!
Right, so don’t try to build and run this app just yet or it will surely
fail. Instead, move on to the next section and get all of those services
defined.</p>
</div>
<div class="section" id="building-the-ble-services">
<h2>Building the BLE Services<a class="headerlink" href="#building-the-ble-services" title="Permalink to this headline">¶</a></h2>
<p>If the nrf52_adc app is going to be a Bluetooth-enabled sensor app that
will allow you to read the value of the eTape Water Level Sensor via
Bluetooth we’ll need to actually define those Services and
Characteristics.</p>
<p>As with the <a class="reference external" href="bleprph/bleprph-app.html">ble peripheral</a> app, we will
advertise a couple of values from our app. The first is not strictly
necessary, but it will help us build an iOS app later. We’ve defined a
service and the characteristics in that service in <code class="docutils literal notranslate"><span class="pre">bleadc.h</span></code> in the
<code class="docutils literal notranslate"><span class="pre">apps/nrf52_adc/src/</span></code> directory as follows:</p>
<div class="code c highlight-none notranslate"><div class="highlight"><pre><span></span>/* Sensor Data */
/* e761d2af-1c15-4fa7-af80-b5729002b340 */
static const ble_uuid128_t gatt_svr_svc_adc_uuid =
        BLE_UUID128_INIT(0x40, 0xb3, 0x20, 0x90, 0x72, 0xb5, 0x80, 0xaf,
                         0xa7, 0x4f, 0x15, 0x1c, 0xaf, 0xd2, 0x61, 0xe7);
#define ADC_SNS_TYPE          0xDEAD
#define ADC_SNS_STRING &quot;eTape Liquid Level Sensor&quot;
#define ADC_SNS_VAL           0xBEAD
extern uint16_t gatt_adc_val;
</pre></div>
</div>
<p>The first is the UUID of the service, followed by the 2 characteristics
we are going to offer. The first characteristic is going to advertise
the <em>type</em> of sensor we are advertising, and it will be a read-only
characteristic. The second characteristic will be the sensor value
itself, and we will allow connected devices to ‘subscribe’ to it in
order to get constantly-updated values.</p>
<p><strong>Note:</strong> You can choose any valid Characteristic UUIDs to go here.
We’re using these values for illustrative purposes only.</p>
<p>The value that we’ll be updating is also defined here as
<code class="docutils literal notranslate"><span class="pre">gatt_adc_val</span></code>.</p>
<p>If we then go look at <code class="docutils literal notranslate"><span class="pre">gatt_srv.c</span></code> we can see the structure of the
service and characteristic offering that we set up:</p>
<p>```c hl_lines=”21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37”
static const struct ble_gatt_svc_def gatt_svr_svcs` &lt;#section&gt;`__
= { { /*** Service: Security test. <em>/ .type =
BLE_GATT_SVC_TYPE_PRIMARY, .uuid =
&amp;gatt_svr_svc_sec_test_uuid.u, .characteristics = (struct
ble_gatt_chr_def` &lt;#section&gt;`__) { { /</em>** Characteristic:
Random number generator. <em>/ .uuid =
&amp;gatt_svr_chr_sec_test_rand_uuid.u, .access_cb =
gatt_svr_chr_access_sec_test, .flags = BLE_GATT_CHR_F_READ |
BLE_GATT_CHR_F_READ_ENC, }, { /</em>** Characteristic: Static
value. <em>/ .uuid = &amp;gatt_svr_chr_sec_test_static_uuid.u,
.access_cb = gatt_svr_chr_access_sec_test, .flags =
BLE_GATT_CHR_F_READ | BLE_GATT_CHR_F_WRITE |
BLE_GATT_CHR_F_WRITE_ENC, }, { 0, /</em> No more characteristics in
this service. <em>/ } }, }, { /</em>** ADC Level Notification Service. <em>/
.type = BLE_GATT_SVC_TYPE_PRIMARY, .uuid =
&amp;gatt_svr_svc_adc_uuid.u, .characteristics = (struct
ble_gatt_chr_def` &lt;#section&gt;`__) { { .uuid =
BLE_UUID16_DECLARE(ADC_SNS_TYPE), .access_cb =
gatt_svr_sns_access, .flags = BLE_GATT_CHR_F_READ, }, { .uuid =
BLE_UUID16_DECLARE(ADC_SNS_VAL), .access_cb =
gatt_svr_sns_access, .flags = BLE_GATT_CHR_F_NOTIFY, }, { 0, /</em>
No more characteristics in this service. */ } }, },</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{
    0, /* No more services. */
},
</pre></div>
</div>
<p>}; ```</p>
<p>You should recognize the first services from the <a class="reference external" href="bleprph/bleprph-intro.html">BLE
Peripheral</a> tutorial earlier. We’re just
adding another Service, with 2 new Characteristics, to that application.</p>
<p>We’ll need to fill in the function that will be called for this service,
<code class="docutils literal notranslate"><span class="pre">gatt_srv_sns_access</span></code> next so that the service knows what to do.</p>
<div class="code c highlight-none notranslate"><div class="highlight"><pre><span></span>static int
gatt_svr_sns_access(uint16_t conn_handle, uint16_t attr_handle,
                          struct ble_gatt_access_ctxt *ctxt,
                          void *arg)
{
    uint16_t uuid16;
    int rc;

    uuid16 = ble_uuid_u16(ctxt-&gt;chr-&gt;uuid);

    switch (uuid16) {
    case ADC_SNS_TYPE:
        assert(ctxt-&gt;op == BLE_GATT_ACCESS_OP_READ_CHR);
        rc = os_mbuf_append(ctxt-&gt;om, ADC_SNS_STRING, sizeof ADC_SNS_STRING);
        BLEPRPH_LOG(INFO, &quot;ADC SENSOR TYPE READ: %s\n&quot;, ADC_SNS_STRING);
        return rc == 0 ? 0 : BLE_ATT_ERR_INSUFFICIENT_RES;

    case ADC_SNS_VAL:
        if (ctxt-&gt;op == BLE_GATT_ACCESS_OP_WRITE_CHR) {
            rc = gatt_svr_chr_write(ctxt-&gt;om, 0,
                                    sizeof gatt_adc_val,
                                    &amp;gatt_adc_val,
                                    NULL);
            return rc;
        } else if (ctxt-&gt;op == BLE_GATT_ACCESS_OP_READ_CHR) {
            rc = os_mbuf_append(ctxt-&gt;om, &amp;gatt_adc_val,
                                sizeof gatt_adc_val);
            return rc == 0 ? 0 : BLE_ATT_ERR_INSUFFICIENT_RES;
        }

    default:
        assert(0);
        return BLE_ATT_ERR_UNLIKELY;
    }
}
</pre></div>
</div>
<p>You can see that when request is for the <code class="docutils literal notranslate"><span class="pre">ADC_SNS_TYPE</span></code>, we return the
Sensor Type we defined earlier. If the request if for <code class="docutils literal notranslate"><span class="pre">ADC_SNS_VAL</span></code>
we’ll return the <code class="docutils literal notranslate"><span class="pre">gatt_adc_val</span></code> value.</p>
<p>Don’t forget to include the <code class="docutils literal notranslate"><span class="pre">bleadc.h</span></code> include file at the top of the
<code class="docutils literal notranslate"><span class="pre">gatt_svr.c</span></code> file!</p>
<p>If you build, load and run this application now, you will see all those
Services and Characteristics advertised, and you will even be able to
read the “Sensor Type” String via the ADC_SNS_TYPE Characteristic.</p>
</div>
<div class="section" id="adding-the-etape-water-sensor">
<h2>Adding the eTape Water Sensor<a class="headerlink" href="#adding-the-etape-water-sensor" title="Permalink to this headline">¶</a></h2>
<p>Now that we have a fully functioning BLE App that we can subscribe to
sensor values from, it’s time to actually wire up the sensor!</p>
<p>As previously mentioned, we’re going to be using an eTape Water Level
Sensor. You can get one from
<a class="reference external" href="https://www.adafruit.com/products/1786">Adafruit</a>.</p>
<p>We’re going to use the sensor as a resistive sensor, and the setup is
very simple. I’ll be using a ‘breadboard` to put this all together for
illustrative purposes. First, attach a jumper-wire from Vdd on the board
to the breadboard. Next, attach a jumper wire from pin P0.03 on the
board to the breadboard. This will be our ADC-in. The sensor should have
come with a 560 ohm resistor, so plug that into the board between Vdd
and ADC-in holes. Finally, attach a jumper from GND on the board to your
breadboard. At this point, your breadboard should look like this:</p>
<div class="figure" id="id1">
<img alt="Bread Board Setup" src="../_images/breadboard.png" />
<p class="caption"><span class="caption-text">Bread Board Setup</span></p>
</div>
<p>Now attach one of the middle 2 leads from the sensor to ground on the
breadboard and the other middle lead to the ADC-in on the breadboard.
Your breadboard should now look like this:</p>
<div class="figure" id="id2">
<img alt="Bread Board Final" src="../_images/adc-demo-1.png" />
<p class="caption"><span class="caption-text">Bread Board Final</span></p>
</div>
<p>And your eTape Sensor should look like this (at least if you have it
mounted in a graduated cylinder as I do).</p>
<div class="figure" id="id3">
<img alt="eTape Sensor Setup" src="../_images/adc-demo-2.png" />
<p class="caption"><span class="caption-text">eTape Sensor Setup</span></p>
</div>
<p>That concludes the hardware portion. Easy!</p>
<p>At this point you should be able to build, create-image and load your
application and see it properly sending readings.</p>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>Congratulations, you’ve now completed both a hardware project and a
software project by connecting a sensor to your device and using Mynewt
to read data from that sensor and send it via Bluetooth to a connected
device. That’s no small feat!</p>
<p>If you see anything missing or want to send us feedback, please do so by
signing up for appropriate mailing lists on our <a class="reference external" href="../../community.html">Community
Page</a>.</p>
<p>Keep on hacking and sensing!</p>
</div>
<div class="section" id="note">
<h2>Note<a class="headerlink" href="#note" title="Permalink to this headline">¶</a></h2>
<p>If you’re wondering how to actually view these sensor readings via
Bluetooth, you have a couple of options. On Mac OS or iOS you can
download the <a class="reference external" href="https://itunes.apple.com/us/app/lightblue-explorer-bluetooth/id557428110?mt=8">LightBlue
app</a>.
This app lets you connect to, and interrogate, BLE devices like the one
you just built.</p>
<p>If you used the BLE Service and Characteristic UUIDs used in this
tutorial, you can also download and use a Mac OS <a class="reference external" href="https://dragonflyiot.com/MyNewtSensorReader.zip">MyNewt Sensor Reader
App</a> (Zip Archive)
that allows you to graph your data, etc. An iOS version is in Beta
testing and should be available soon.</p>
<div class="figure" id="id4">
<img alt="My Newt Sensor Reader" src="../_images/MyNewtSensorReader006.jpg" />
<p class="caption"><span class="caption-text">My Newt Sensor Reader</span></p>
</div>
<p>Enjoy!</p>
</div>
</div>


                   </div>
                  </div>
                  
                </div>
              </div>
            </div>
            <!-- ENDS CONTENT SECTION -->
          </div>
          <!-- ENDS .content -->
        </div>
      </div>
      <footer>
  <div class="container">
    <div class="row">
      <div class="col-xs-12">
          
              <p class="copyright">Apache Mynewt is available under Apache License, version 2.0.</p>
          
      </div>
      <div class="col-xs-12">
          <div class="logos">
              <img src="../_static/img/asf_logo_wide_small.png" alt="Apache" title="Apache">
              <small class="footnote">
                Apache Mynewt, Mynewt, Apache, the Apache feather logo, and the Apache Mynewt project logo are either
                registered trademarks or trademarks of the Apache Software Foundation in the United States and other countries.
              </small>
              <a href="https://join.slack.com/mynewt/shared_invite/MTkwMTg1ODM1NTg5LTE0OTYxNzQ4NzQtZTU1YmNhYjhkMg">
                <img src="../_static/img/add_to_slack.png" alt="Slack Icon" title="Join our Slack Community" />
              </a>
          </div>
      </div>
    </div>
  </div>
</footer>
    </div>
    <!-- ENDS #wrapper -->

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.3.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/js/bootstrap-3.0.3.min.js"></script>
      <script type="text/javascript" src="../_static/js/affix.js"></script>
      <script type="text/javascript" src="../_static/js/main.js"></script>

   

  </body>
</html>