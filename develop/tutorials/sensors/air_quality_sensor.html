

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    

    
    <title>Air quality sensor project &mdash; Apache Mynewt 1.3.0 documentation</title>
    

    
    
      <link rel="shortcut icon" href="../../_static/mynewt-logo-only-newt32x32.png"/>
    

    

    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />

    
      <link rel="stylesheet" href="../../_static/css/sphinx_theme.css" type="text/css" />
    
      <link rel="stylesheet" href="../../_static/css/bootstrap-3.0.3.min.css" type="text/css" />
    
      <link rel="stylesheet" href="../../_static/css/v2.css" type="text/css" />
    
      <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    
      <link rel="stylesheet" href="../../_static/css/restructuredtext.css" type="text/css" />
    

    

    <link rel="stylesheet" href="../../_static/css/overrides.css" type="text/css" />
          <link rel="index" title="Index"
                href="../../genindex.html"/>
          <link rel="search" title="Search" href="../../search.html"/>
      <link rel="top" title="Apache Mynewt 1.3.0 documentation" href="../../index.html"/>
          <link rel="up" title="Air Quality Sensor Project" href="air_quality.html"/>
          <link rel="next" title="Air quality sensor project via Bluetooth" href="air_quality_ble.html"/>
          <link rel="prev" title="Air Quality Sensor Project" href="air_quality.html"/> 

    
    <script src="../../_static/js/modernizr.min.js"></script>

    
    <script>
    (function(i, s, o, g, r, a, m) {
	i["GoogleAnalyticsObject"] = r;
	(i[r] =
		i[r] ||
		function() {
			(i[r].q = i[r].q || []).push(arguments);
		}),
		(i[r].l = 1 * new Date());
	(a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
	a.async = 1;
	a.src = g;
	m.parentNode.insertBefore(a, m);
})(window, document, "script", "//www.google-analytics.com/analytics.js", "ga");

ga("create", "UA-72162311-1", "auto");
ga("send", "pageview");
</script>
    

  </head>

  <body class="not-front page-documentation" role="document" >
    <div id="wrapper">
      <div class="container">
    <div id="banner" class="row v2-main-banner">
        <a class="logo-cell" href="/">
            <img class="logo" src="../../_static/img/logo.png">
        </a>
        <div class="tagline-cell">
            <h4 class="tagline">An OS to build, deploy and securely manage billions of devices</h4>
        </div>
        <div class="news-cell">
            <div class="well">
              <h4>Latest News:</h4> <a href="/download">Apache Mynewt 1.3.0</a> released (December 13, 2017)
            </div>
        </div>
    </div>
</div>
      
<header>
    <nav id="navbar" class="navbar navbar-inverse" role="navigation">
        <div class="container">
            <!-- Collapsed navigation -->
            <div class="navbar-header">
                <!-- Expander button -->
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>

            </div>

            <!-- Expanded navigation -->
            <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/"><i class="fa fa-home" style="font-size: larger;"></i></a>
                    </li>
                    <li class="important">
                        <a href="/get_started/quick_start.html">Quick Start</a>
                    </li>
                    <li>
                        <a href="/about/">About</a>
                    </li>
                    <li>
                        <a href="/talks/">Talks</a>
                    </li>
                    <li class="active">
                        <a href="/documentation/">Documentation</a>
                    </li>
                    <li>
                        <a href="/download/">Download</a>
                    </li>
                    <li>
                        <a href="/community/">Community</a>
                    </li>
                    <li>
                        <a href="/events/">Events</a>
                    </li>
                </ul>

                <!-- Search, Navigation and Repo links -->
                <ul class="nav navbar-nav navbar-right">
                    
                </ul>
            </div>
        </div>
    </nav>
</header>
      <!-- STARTS MAIN CONTENT -->
      <div id="main-content">
        





<div id="breadcrumb">
  <div class="container">
    <a href="/documentation/">Docs</a> /
    
      <a href="../tutorials.html">Tutorials</a> /
    
      <a href="sensors.html">Sensors</a> /
    
      <a href="air_quality.html">Air Quality Sensor Project</a> /
    
    Air quality sensor project
    
  <div class="sourcelink">
    <a href="https://github.com/apache/mynewt-documentation/edit/master/docs/tutorials/sensors/air_quality_sensor.rst" class="icon icon-github"
           rel="nofollow"> Edit on GitHub</a>
</div>
  </div>
</div>
        <!-- STARTS CONTAINER -->
        <div class="container">
          <!-- STARTS .content -->
          <div id="content" class="row">
            
            <!-- STARTS .container-sidebar -->
<div class="container-sidebar col-xs-12 col-sm-3">
  <div id="docSidebar" class="sticky-container">
    <div role="search" class="sphinx-search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search documentation" class="search-documentation" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
    
<!-- Note: only works when deployed -->
<select class="form-control" onchange="if (this.value) window.location.href=this.value">
    <option
      value="/develop"
      selected
      >
      Version: develop (latest - mynewt-documentation)
    </option>
    <option
      value="/latest/os/introduction"
      >
      Version: master (latest - mynewt-site)
    </option>
    <option
      value="/v1_2_0/os/introduction"
      >
      Version: 1.2.0
    </option>
    <option
      value="/v1_1_0/os/introduction">
      Version: 1.1.0
    </option>
    <option
      value="/v1_0_0/os/introduction">
      Version: 1.0.0
    </option>
    <option
      value="/v0_9_0/os/introduction">
      Version: 0_9_0
    </option>
</select>
    <div class="region region-sidebar">
      <div class="docs-menu">
      
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../get_started/index.html">Setup &amp; Get Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts.html">Concepts</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../blinky/blinky.html">Project Blinky</a></li>
<li class="toctree-l2"><a class="reference internal" href="../repo/add_repos.html">Working with repositories</a></li>
<li class="toctree-l2"><a class="reference internal" href="../slinky/project-slinky.html">Project Slinky for Remote Comms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ble/ble.html">Bluetooth Low Energy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lora/lorawanapp.html">LoRa</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="sensors.html">Sensors</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="sensors_framework.html">Sensor Framework</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="air_quality.html">Air Quality Sensor Project</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#"> Basic Air Quality Sensor</a></li>
<li class="toctree-l4"><a class="reference internal" href="air_quality_ble.html"> BLE-enabled Air Quality Sensor</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="nrf52_adc.html">Add an Analog Sensor</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tooling/tooling.html">Tooling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../other/other.html">Other</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../os/os_user_guide.html">OS User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../network/ble/ble_intro.html">BLE User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../newt/index.html">Newt Tool Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../newtmgr/index.html">Newt Manager Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mynewt_faq.html">Mynewt OS related FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc/index.html">Appendix</a></li>
</ul>

        
      
      </div>
    </div>
  </div>
  <!-- ENDS STICKY CONTAINER -->
</div>
<!-- ENDS .container-sidebar -->

            <div class="col-xs-12 col-sm-9">
              <div class="alert alert-info" role="alert">
  <p>
    This is the development version of Apache Mynewt documentation. As such it may not be as complete as the latest
    stable version of the documentation found <a href="/latest/os/introduction/">here</a>.
  </p>
  <p>
    To improve this documentation please visit <a href="https://github.com/apache/mynewt-documentation">https://github.com/apache/mynewt-documentation</a>.
  </p>
</div>
              
              <div class="">
                <div class="rst-content">
                  <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
                   <div itemprop="articleBody">
                    
  <div class="section" id="air-quality-sensor-project">
<h1>Air quality sensor project<a class="headerlink" href="#air-quality-sensor-project" title="Permalink to this headline">¶</a></h1>
<div class="section" id="setting-up-source-tree-for-stuff-you-need">
<h2>Setting up source tree for stuff you need<a class="headerlink" href="#setting-up-source-tree-for-stuff-you-need" title="Permalink to this headline">¶</a></h2>
<p>To start with, you need to create a new project under which you will do
this development. So you type in:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> mkdir <span class="nv">$HOME</span>/src
<span class="gp">$</span> <span class="nb">cd</span> <span class="nv">$HOME</span>/src
<span class="gp">$</span> newt new air_quality
</pre></div>
</div>
<p>Let’s say you are using Arduino Primo – which is based on the Nordic
Semi NRF52 chip – as the platform. You know you need the board support
package for that hardware. You can look up its location, add it your
project, and fetch that along with the core OS components. Luckily, the
Arduino Primo is supported in the Mynewt Core, so there’s nothing much
to do here.</p>
<p>Your project.yml file should look like this:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span>[user@IsMyLaptop:~/src/air_quality]$ emacs project.yml &amp;
[user@IsMyLaptop:~/src/air_quality]$ cat project.yml
project.name: &quot;air_quality&quot;

project.repositories:
    - apache-mynewt-core

# Use github&#39;s distribution mechanism for core ASF libraries.
# This provides mirroring automatically for us.
#
repository.apache-mynewt-core:
    type: github
    vers: 0-latest
    user: apache
    repo: mynewt-core

[user@IsMyLaptop:~/src/air_quality]$ newt install
apache-mynewt-core
[user@IsMyLaptop:~/src/air_quality]$ ls repos/
apache-mynewt-core
</pre></div>
</div>
<p>Good. You want to make sure you have all the needed bits for supporting
your board; so you decide to build the blinky project for the platform
first.</p>
<p>Now create a target for it and build it. Easiest way to proceed is to
copy the existing target for blinky, and modify it to build for Arduino
Primo board.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">[user@IsMyLaptop:~/src/air_quality]$</span> newt target copy my_blinky_sim blink_primo
<span class="go">Target successfully copied; targets/my_blinky_sim --&gt; targets/blink_primo</span>
<span class="gp">[user@IsMyLaptop:~/src/air_quality]$</span> newt target <span class="nb">set</span> blink_primo <span class="nv">bsp</span><span class="o">=</span>@apache-mynewt-core/hw/bsp/arduino_primo_nrf52
<span class="go">Target targets/blink_nrf successfully set target.bsp to @apache-mynewt-core/hw/bsp/arduino_primo_nrf52</span>
<span class="gp">[user@IsMyLaptop:~/src/air_quality]$</span> newt build blink_primo
<span class="go">Compiling hal_bsp.c</span>
<span class="go">...</span>
<span class="go">Linking blinky.elf</span>
<span class="go">App successfully built: /Users/user/src/air_quality/bin/blink_primo/apps/blinky/blinky.elf</span>
</pre></div>
</div>
<p>Good.</p>
<p>You know that this platform uses bootloader, which means you have to
create a target for that too.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">[user@IsMyLaptop:~/src/air_quality]$</span> newt target create boot_primo
<span class="go">Target targets/boot_nrf successfully created</span>
<span class="gp">[user@IsMyLaptop:~/src/air_quality]$</span> newt target show
<span class="go">@apache-mynewt-core/targets/unittest</span>
<span class="go">    bsp=hw/bsp/native</span>
<span class="go">    build_profile=debug</span>
<span class="go">    compiler=compiler/sim</span>
<span class="go">targets/blink_primo</span>
<span class="go">    app=apps/blinky</span>
<span class="go">    bsp=@apache-mynewt-core/hw/bsp/arduino_primo_nrf52</span>
<span class="go">    build_profile=debug</span>
<span class="go">targets/boot_primo</span>
<span class="go">targets/my_blinky_sim</span>
<span class="go">    app=apps/blinky</span>
<span class="go">    bsp=@apache-mynewt-core/hw/bsp/native</span>
<span class="go">    build_profile=debug</span>
<span class="gp">[user@IsMyLaptop:~/src/air_quality]$</span> newt target <span class="nb">set</span> boot_nrf <span class="nv">bsp</span><span class="o">=</span>@apache-mynewt-core/hw/bsp/arduino_primo_nrf52
<span class="go">Target targets/boot_nrf successfully set target.bsp to @apache-mynewt-core/hw/bsp/arduino_primo_nrf52</span>
<span class="gp">[user@IsMyLaptop:~/src/air_quality]$</span> newt target <span class="nb">set</span> boot_nrf <span class="nv">app</span><span class="o">=</span>@apache-mynewt-core/apps/boot
<span class="go">Target targets/boot_nrf successfully set target.app to @apache-mynewt-core/apps/boot</span>
<span class="gp">[user@IsMyLaptop:~/src/air_quality]$</span> newt target <span class="nb">set</span> boot_nrf <span class="nv">build_profile</span><span class="o">=</span>optimized
<span class="go">Target targets/boot_nrf successfully set target.build_profile to optimized</span>
</pre></div>
</div>
<p>And then build it, and load it onto the board.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">newt build boot_primo</span>
<span class="go">....</span>
<span class="go">Linking boot.elf</span>
<span class="go">App successfully built: /Users/user/src/air_quality/bin/boot_primo/apps/boot/boot.elf</span>
<span class="go">[user@IsMyLaptop:~/src/air_quality]</span>
<span class="gp">$</span> newt load boot_primo
</pre></div>
</div>
<p>At this point, you may (or may not) see a bunch of error messages about
not being able to connect to your board, not being able to load the
image, etc. If that’s the case, and you haven’t already, you should most
definitely go worth through the <a class="reference internal" href="../blinky/blinky_primo.html"><span class="doc">blinky_primo</span></a>
tutorial so that you can properly communicate with your board.</p>
<p>Next you must download the targets to board, and see that the LED
actually blinks. You plug in the Arduino Primo board to your laptop, and
say:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">[user@IsMyLaptop:~/src/air_quality]$</span> newt load blink_primo
<span class="go">Loading app image into slot 1</span>
<span class="go">Error: couldn&#39;t open /Users/user/src/air_quality/bin/blink_primo/apps/blinky/blinky.img</span>

<span class="go">Error: exit status 1</span>

<span class="go">load - Load app image to target for &lt;target-name&gt;.</span>

<span class="go">Usage:</span>
<span class="go">  newt load [flags]</span>

<span class="go">Examples:</span>
<span class="go">  newt load &lt;target-name&gt;</span>


<span class="go">Global Flags:</span>
<span class="go">  -l, --loglevel string   Log level, defaults to WARN. (default &quot;WARN&quot;)</span>
<span class="go">  -o, --outfile string    Filename to tee log output to</span>
<span class="go">  -q, --quiet             Be quiet; only display error output.</span>
<span class="go">  -s, --silent            Be silent; don&#39;t output anything.</span>
<span class="go">  -v, --verbose           Enable verbose output when executing commands.</span>
<span class="go">exit status 1</span>
</pre></div>
</div>
<p>Ah. Forgot to create an image out of the blinky binary. Note that every
time you want to build and load a new firmware image to a target board,
you need to run ‘create-image’ on it.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">[user@IsMyLaptop:~/src/air_quality]$</span> newt create-image blink_primo <span class="m">0</span>.0.1
<span class="go">App image successfully generated: /Users/user/src/air_quality/bin/blink_primo/apps/blinky/blinky.img</span>
<span class="go">Build manifest: /Users/user/src/air_quality/bin/blink_nrf/apps/blinky/manifest.json</span>
<span class="gp">[user@IsMyLaptop:~/src/air_quality]$</span> newt load blink_primo
</pre></div>
</div>
<p>And it’s blinking.</p>
<p>Shortcut for doing build/create-image/load/debug steps all in one is
‘newt run’ command. Check out the usage from command line help.</p>
</div>
<div class="section" id="create-test-project">
<h2>Create test project<a class="headerlink" href="#create-test-project" title="Permalink to this headline">¶</a></h2>
<p>Now that you have your system setup, you can start creating your own
stuff. First you want to create a project for yourself - you could start
by using blinky as a project template, but since we’re going to want to
be able to access the data via Bluetooth, let’s use the <code class="docutils literal notranslate"><span class="pre">bleprph</span></code>
Bluetooth Peripheral project instead.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">[user@IsMyLaptop:~/src/air_quality]$</span> mkdir apps/air_quality
<span class="gp">[user@IsMyLaptop:~/src/air_quality]$</span> cp repos/apache-mynewt-core/apps/bleprph/pkg.yml apps/air_quality/
<span class="gp">[user@IsMyLaptop:~/src/air_quality]$</span> cp -Rp repos/apache-mynewt-core/apps/bleprph/src apps/air_quality/
</pre></div>
</div>
<p>Then you modify the apps/air_quality/pkg.yml for air_quality in order
to change the <em>pkg.name</em> to be <em>apps/air_quality</em>. You’ll need to add
the <code class="docutils literal notranslate"><span class="pre">&#64;apache-mynewt-core/</span></code> path to all the package dependencies, since
the app no longer resides within the apache-mynewt-core repository.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">[user@IsMyLaptop:~/src/air_quality]$</span> cat apps/air_quality/pkg.yml
<span class="go">pkg.name: apps/air_quality</span>
<span class="go">pkg.type: app</span>
<span class="go">pkg.description: BLE Air Quality application.</span>
<span class="go">pkg.author: &quot;Apache Mynewt &lt;dev@mynewt.apache.org&gt;&quot;</span>
<span class="go">pkg.homepage: &quot;http://mynewt.apache.org/&quot;</span>
<span class="go">pkg.keywords:</span>

<span class="go">pkg.deps:</span>
<span class="go">    - &quot;@apache-mynewt-core/kernel/os&quot;</span>
<span class="go">    - &quot;@apache-mynewt-core/sys/shell&quot;</span>
<span class="go">    - &quot;@apache-mynewt-core/sys/stats/full&quot;</span>
<span class="go">    - &quot;@apache-mynewt-core/sys/log/full&quot;</span>
<span class="go">    - &quot;@apache-mynewt-core/mgmt/newtmgr&quot;</span>
<span class="go">    - &quot;@apache-mynewt-core/mgmt/newtmgr/transport/ble&quot;</span>
<span class="go">    - &quot;@apache-mynewt-core/net/nimble/controller&quot;</span>
<span class="go">    - &quot;@apache-mynewt-core/net/nimble/host&quot;</span>
<span class="go">    - &quot;@apache-mynewt-core/net/nimble/host/services/ans&quot;</span>
<span class="go">    - &quot;@apache-mynewt-core/net/nimble/host/services/gap&quot;</span>
<span class="go">    - &quot;@apache-mynewt-core/net/nimble/host/services/gatt&quot;</span>
<span class="go">    - &quot;@apache-mynewt-core/net/nimble/host/store/ram&quot;</span>
<span class="go">    - &quot;@apache-mynewt-core/net/nimble/transport/ram&quot;</span>
<span class="go">    - &quot;@apache-mynewt-core/sys/console/full&quot;</span>
<span class="go">    - &quot;@apache-mynewt-core/sys/sysinit&quot;</span>
<span class="go">    - &quot;@apache-mynewt-core/sys/id&quot;</span>
</pre></div>
</div>
<p>And create a target for it:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">[user@IsMyLaptop:~/src/air_quality]$</span> newt target create air_q
<span class="go">Target targets/air_q successfully created</span>
<span class="gp">[user@IsMyLaptop:~/src/air_quality]$</span> newt target <span class="nb">set</span> air_q <span class="nv">bsp</span><span class="o">=</span>@apache-mynewt-core/hw/bsp/arduino_primo_nrf52
<span class="go">Target targets/air_q successfully set target.bsp to @apache-mynewt-core/hw/bsp/arduino_primo_nrf52</span>
<span class="gp">[user@IsMyLaptop:~/src/air_quality]$</span> newt target <span class="nb">set</span> air_q <span class="nv">app</span><span class="o">=</span>apps/air_quality
<span class="go">Target targets/air_q successfully set target.app to apps/air_quality</span>
<span class="gp">[user@IsMyLaptop:~/src/air_quality]$</span> newt target <span class="nb">set</span> air_q <span class="nv">build_profile</span><span class="o">=</span>debug
<span class="go">Target targets/air_q successfully set target.build_profile to debug</span>
<span class="gp">[user@IsMyLaptop:~/src/air_quality]$</span> newt build air_q
<span class="go"> ....</span>
<span class="go">Linking /Users/dsimmons/dev/myproj/bin/targets/air_q/app/apps/air_quality/air_quality.elf</span>
<span class="go">Target successfully built: targets/air_q</span>
</pre></div>
</div>
</div>
<div class="section" id="create-packages-for-drivers">
<h2>Create packages for drivers<a class="headerlink" href="#create-packages-for-drivers" title="Permalink to this headline">¶</a></h2>
<p>One of the sensors you want to enable is SenseAir K30, which will
connect to the board over a serial port. To start development of the
driver, you first need to create a package description for it, and add
stubs for sources.</p>
<p>The first thing to do is to create the directory structure for your
driver:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">[user@IsMyLaptop:~/src/air_quality]$</span> mkdir -p libs/my_drivers/senseair/include/senseair
<span class="gp">[user@IsMyLaptop:~/src/air_quality]$</span> mkdir -p libs/my_drivers/senseair/src
</pre></div>
</div>
<p>Now you can add the files you need. You’ll need a pkg.yml to describe
the driver, and then header stub followed by source stub.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">[user@IsMyLaptop:~/src/air_quality]$</span> cat libs/my_drivers/senseair/pkg.yml
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#</span>
<span class="cp"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="cp"># or more contributor license agreements.  See the NOTICE file</span>
<span class="cp"># distributed with this work for additional information</span>
<span class="cp"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="cp"># to you under the Apache License, Version 2.0 (the</span>
<span class="cp"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="cp"># with the License.  You may obtain a copy of the License at</span>
<span class="cp">#</span>
<span class="cp">#  http:</span><span class="c1">//www.apache.org/licenses/LICENSE-2.0</span>
<span class="cp">#</span>
<span class="cp"># Unless required by applicable law or agreed to in writing,</span>
<span class="cp"># software distributed under the License is distributed on an</span>
<span class="cp"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="cp"># KIND, either express or implied.  See the License for the</span>
<span class="cp"># specific language governing permissions and limitations</span>
<span class="cp"># under the License.</span>
<span class="cp">#</span>
<span class="n">pkg</span><span class="p">.</span><span class="nl">name</span><span class="p">:</span> <span class="n">libs</span><span class="o">/</span><span class="n">my_drivers</span><span class="o">/</span><span class="n">senseair</span>
<span class="n">pkg</span><span class="p">.</span><span class="nl">description</span><span class="p">:</span> <span class="n">Host</span> <span class="n">side</span> <span class="n">of</span> <span class="n">the</span> <span class="n">nimble</span> <span class="n">Bluetooth</span> <span class="n">Smart</span> <span class="n">stack</span><span class="p">.</span>
<span class="n">pkg</span><span class="p">.</span><span class="nl">author</span><span class="p">:</span> <span class="s">&quot;Apache Mynewt &lt;dev@mynewt.apache.org&gt;&quot;</span>
<span class="n">pkg</span><span class="p">.</span><span class="nl">homepage</span><span class="p">:</span> <span class="s">&quot;http://mynewt.apache.org/&quot;</span>
<span class="n">pkg</span><span class="p">.</span><span class="nl">keywords</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">ble</span>
    <span class="o">-</span> <span class="n">bluetooth</span>

<span class="n">pkg</span><span class="p">.</span><span class="nl">deps</span><span class="p">:</span>
    <span class="o">-</span> <span class="s">&quot;@apache-mynewt-core/kernel/os&quot;</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">[user@IsMyLaptop:~/src/air_quality]$</span> cat libs/my_drivers/senseair/include/senseair/senseair.h
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> * Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="cm"> * or more contributor license agreements.  See the NOTICE file</span>
<span class="cm"> * distributed with this work for additional information</span>
<span class="cm"> * regarding copyright ownership.  The ASF licenses this file</span>
<span class="cm"> * to you under the Apache License, Version 2.0 (the</span>
<span class="cm"> * &quot;License&quot;); you may not use this file except in compliance</span>
<span class="cm"> * with the License.  You may obtain a copy of the License at</span>
<span class="cm"> *</span>
<span class="cm"> *  http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="cm"> *</span>
<span class="cm"> * Unless required by applicable law or agreed to in writing,</span>
<span class="cm"> * software distributed under the License is distributed on an</span>
<span class="cm"> * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="cm"> * KIND, either express or implied.  See the License for the</span>
<span class="cm"> * specific language governing permissions and limitations</span>
<span class="cm"> * under the License.</span>
<span class="cm">*/</span>
<span class="cp">#ifndef _SENSEAIR_H_</span>
<span class="cp">#define _SENSEAIR_H_</span>

<span class="kt">void</span> <span class="nf">senseair_init</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* _SENSEAIR_H_ */</span><span class="cp"></span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">[user@IsMyLaptop:~/src/air_quality]$</span> cat libs/my_drivers/senseair/src/senseair.c
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="cm"> * or more contributor license agreements.  See the NOTICE file</span>
<span class="cm"> * distributed with this work for additional information</span>
<span class="cm"> * regarding copyright ownership.  The ASF licenses this file</span>
<span class="cm"> * to you under the Apache License, Version 2.0 (the</span>
<span class="cm"> * &quot;License&quot;); you may not use this file except in compliance</span>
<span class="cm"> * with the License.  You may obtain a copy of the License at</span>
<span class="cm"> *</span>
<span class="cm"> *  http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="cm"> *</span>
<span class="cm"> * Unless required by applicable law or agreed to in writing,</span>
<span class="cm"> * software distributed under the License is distributed on an</span>
<span class="cm"> * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="cm"> * KIND, either express or implied.  See the License for the</span>
<span class="cm"> * specific language governing permissions and limitations</span>
<span class="cm"> * under the License.</span>
<span class="cm"> */</span>

<span class="kt">void</span>
<span class="nf">senseair_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>
</pre></div>
</div>
<p>And add dependency to this package in your project yml file.</p>
<p>Here’s the listing from apps/air_quality/pkg.yml</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">pkg.name: apps/air_quality</span>
<span class="go">pkg.type: app</span>
<span class="go">pkg.description: Air quality sensor test</span>
<span class="go">pkg.keywords:</span>

<span class="go">pkg.deps:</span>
<span class="go">    - &quot;@apache-mynewt-core/libs/console/full&quot;</span>
<span class="go">    - &quot;@apache-mynewt-core/libs/newtmgr&quot;</span>
<span class="go">    - &quot;@apache-mynewt-core/libs/os&quot;</span>
<span class="go">    - &quot;@apache-mynewt-core/libs/shell&quot;</span>
<span class="go">    - &quot;@apache-mynewt-core/sys/config&quot;</span>
<span class="go">    - &quot;@apache-mynewt-core/sys/log/full&quot;</span>
<span class="go">    - &quot;@apache-mynewt-core/sys/stats/full&quot;</span>
<span class="go">    - libs/my_drivers/senseair</span>
</pre></div>
</div>
<p>And add a call to your main() to initialize this driver.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">[user@IsMyLaptop:~/src/air_quality]$</span> diff project/blinky/src/main.c project/air_quality/src/main.c
<span class="go">28a29</span>
<span class="gp">&gt;</span> <span class="c1">#include &lt;senseair/senseair.h&gt;</span>
<span class="go">190a192</span>
<span class="gp">&gt;</span> senseair_init<span class="o">()</span><span class="p">;</span>
<span class="go">[user@IsMyLaptop:~/src/air_quality</span>
</pre></div>
</div>
<p>The ble_prph app runs everything in one task handler. For this project,
we’re going to add a second task handler to respond to the shell, and
then handle communicating with the senseair sensor for us.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/** shell task settings. */</span>
<span class="cp">#define SHELL_TASK_PRIO           2</span>
<span class="cp">#define SHELL_STACK_SIZE          (OS_STACK_ALIGN(336))</span>

<span class="k">struct</span> <span class="n">os_eventq</span> <span class="n">shell_evq</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">os_task</span> <span class="n">shell_task</span><span class="p">;</span>
<span class="n">bssnz_t</span> <span class="n">os_stack_t</span> <span class="n">shell_stack</span><span class="p">[</span><span class="n">SHELL_STACK_SIZE</span><span class="p">];</span>
</pre></div>
</div>
<p>That defines the task, now we need to initialize it, add a task handler,
and we’re going to use this task as our default task handler.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Event loop for the main shell task.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span>
<span class="nf">shell_task_handler</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">unused</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">os_eventq_run</span><span class="p">(</span><span class="o">&amp;</span><span class="n">shell_evq</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>And in your <code class="docutils literal notranslate"><span class="pre">main()</span></code> add:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Initialize shell eventq */</span>
<span class="n">os_eventq_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">shell_evq</span><span class="p">);</span>

<span class="cm">/* Create the shell task.</span>
<span class="cm"> * All shell operations are performed in this task.</span>
<span class="cm"> */</span>
<span class="n">os_task_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">shell_task</span><span class="p">,</span> <span class="s">&quot;shell&quot;</span><span class="p">,</span> <span class="n">shell_task_handler</span><span class="p">,</span>
                          <span class="nb">NULL</span><span class="p">,</span> <span class="n">SHELL_TASK_PRIO</span><span class="p">,</span> <span class="n">OS_WAIT_FOREVER</span><span class="p">,</span>
                          <span class="n">shell_stack</span><span class="p">,</span> <span class="n">SHELL_STACK_SIZE</span><span class="p">);</span>
</pre></div>
</div>
<p>Don’t forget to change your default task handler!</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">os_eventq_dflt_set</span><span class="p">(</span><span class="o">&amp;</span><span class="n">shell_evq</span><span class="p">);</span>
</pre></div>
</div>
<p>And then build it to make sure all goes well.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">[user@IsMyLaptop:~/src/air_quality]$</span> newt build air_q
<span class="go">Compiling senseair.c</span>
<span class="go">Archiving senseair.a</span>
<span class="go">Linking air_quality.elf</span>
<span class="go">App successfully built: /Users/user/src/air_quality/bin/air_q/apps/air_quality/air_quality.elf</span>
</pre></div>
</div>
<p>All looks good.</p>
</div>
<div class="section" id="add-cli-commands-for-testing-drivers">
<h2>Add CLI commands for testing drivers<a class="headerlink" href="#add-cli-commands-for-testing-drivers" title="Permalink to this headline">¶</a></h2>
<p>While developing the driver, you want to issue operations from console
asking it to do stuff. We’ll assume that you’ve already worked through
the tutorial on how to <a class="reference internal" href="../blinky/blinky_console.html"><span class="doc">enable the CLI</span></a>, so all
we’ll need to do is add the propper values to the project’s
<code class="docutils literal notranslate"><span class="pre">syscfg.yml</span></code> file:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">[user@IsMyLaptop:~/src/air_quality]$</span> cat targets/air_q/syscfg.yml
<span class="go">syscfg.vals:</span>
<span class="gp">    #</span> Set as per blinky_primo
<span class="go">    OPENOCD_DEBUG: 1</span>
<span class="gp">    #</span> Enable the shell task.
<span class="go">    SHELL_TASK: 1</span>
<span class="go">    STATS_CLI: 1</span>
<span class="go">    CONSOLE_TICKS: 1</span>
<span class="go">    CONSOLE_PROMPT: 1</span>
</pre></div>
</div>
<p>Then register your senseair command with the shell by adding the
following to <code class="docutils literal notranslate"><span class="pre">libs/my_drivers/senseair/src/senseair.c</span></code></p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;shell/shell.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;console/console.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;assert.h&gt;</span><span class="cp"></span>


<span class="k">static</span> <span class="kt">int</span> <span class="nf">senseair_shell_func</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">);</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">shell_cmd</span> <span class="n">senseair_cmd</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">.</span><span class="n">sc_cmd</span> <span class="o">=</span> <span class="s">&quot;senseair&quot;</span><span class="p">,</span>
    <span class="p">.</span><span class="n">sc_cmd_func</span> <span class="o">=</span> <span class="n">senseair_shell_func</span><span class="p">,</span>
<span class="p">};</span>

<span class="kt">void</span>
<span class="nf">senseair_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">rc</span><span class="p">;</span>

    <span class="n">rc</span> <span class="o">=</span> <span class="n">shell_cmd_register</span><span class="p">(</span><span class="o">&amp;</span><span class="n">senseair_cmd</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">senseair_shell_func</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">console_printf</span><span class="p">(</span><span class="s">&quot;Yay! Somebody called!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

<span class="p">}</span>
</pre></div>
</div>
<p>Now you can you build this, download to target, and start minicom on
your console port. If you haven’t already, familiarize yourself with the
tutorial on how to connect a serial port to your board
<a class="reference internal" href="../../get_started/serial_access.html"><span class="doc">here</span></a>.</p>
<p>You’ll need to wire up your Board to a Serial converter first. On the
Arduino Primo Board pin 1 is TX and pin 0 is RX so wire 1 to RX on your
serial board, and 0 to TX on your serial board.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">[user@IsMyLaptop:~]$</span> minicom -D /dev/tty.usbserial-AH02MIE2


<span class="go">Welcome to minicom 2.7</span>

<span class="go">OPTIONS:</span>
<span class="go">Compiled on Oct 12 2015, 07:48:30.</span>
<span class="go">Port /dev/tty.usbserial-AH02MIE2, 13:44:40</span>

<span class="go">Press CTRL-X Z for help on special keys</span>

<span class="go">?</span>
<span class="go">419: &gt; ?</span>
<span class="go">Commands:</span>
<span class="go">641:     stat      echo         ?    prompt     ticks     tasks</span>
<span class="go">643: mempools      date  senseair</span>
<span class="go">644: &gt; senseair</span>
<span class="go">Yay! Somebody called!</span>
<span class="go">1125: &gt;</span>
<span class="go">53611: &gt; tasks</span>
<span class="go">Tasks:</span>
<span class="go">54047:    task pri tid  runtime      csw    stksz   stkuse   lcheck   ncheck flg</span>
<span class="go">54057:    idle 255   0    54048    66890       64       30        0        0   0</span>
<span class="go">54068:  ble_ll   0   1        9    64986       80       58        0        0   0</span>
<span class="go">54079: bleprph   1   2        0        1      336       32        0        0   0</span>
<span class="go">54090:   shell   2   3        0     2077      336      262        0        0   0</span>
<span class="go">54101: &gt;</span>
</pre></div>
</div>
<p>That’s great. Your shell task is running, and is responding
appropriately! You can connect the hardware to your board and start
developing code for the driver itself.</p>
</div>
<div class="section" id="use-of-hal-for-drivers">
<h2>Use of HAL for drivers<a class="headerlink" href="#use-of-hal-for-drivers" title="Permalink to this headline">¶</a></h2>
<p>The sensor has a serial port connection, and that’s how you are going to
connect to it. Your original BSP, hw/bsp/arduino_primo_nrf52, has two
UARTs set up. We’re using one for our shell/console. It also has a
second UART set up as a ‘bit-bang’ UART but since the SenseAir only
needs to communicate at 9600 baud, this bit-banged uart is plenty fast
enough.</p>
<p>You’ll have to make a small change to the <code class="docutils literal notranslate"><span class="pre">syscfg.yml</span></code> file in your
project’s target directory to change the pin definitions for this second
UART. Those changes are as follows:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">UART_0_PIN_TX: 23</span>
<span class="go">UART_0_PIN_RX: 24</span>
</pre></div>
</div>
<p>With this in place, you can refer to serial port where your SenseAir
sensor by a logical number. This makes the code more platform
independent - you could connect this sensor to another board, like
Olimex. You will also use the HAL UART abstraction to do the UART port
setup and data transfer. That way you don’t need to have any platform
dependent pieces within your little driver.</p>
<p>You will now see what the driver code ends up looking like. Here’s the
header file, filled in from the stub you created earlier.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> * Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="cm"> * or more contributor license agreements.  See the NOTICE file</span>
<span class="cm"> * distributed with this work for additional information</span>
<span class="cm"> * regarding copyright ownership.  The ASF licenses this file</span>
<span class="cm"> * to you under the Apache License, Version 2.0 (the</span>
<span class="cm"> * &quot;License&quot;); you may not use this file except in compliance</span>
<span class="cm"> * with the License.  You may obtain a copy of the License at</span>
<span class="cm"> *</span>
<span class="cm"> *  http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="cm"> *</span>
<span class="cm"> * Unless required by applicable law or agreed to in writing,</span>
<span class="cm"> * software distributed under the License is distributed on an</span>
<span class="cm"> * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="cm"> * KIND, either express or implied.  See the License for the</span>
<span class="cm"> * specific language governing permissions and limitations</span>
<span class="cm"> * under the License.</span>
<span class="cm">*/</span>
<span class="cp">#ifndef _SENSEAIR_H_</span>
<span class="cp">#define _SENSEAIR_H_</span>

<span class="k">enum</span> <span class="n">senseair_read_type</span> <span class="p">{</span>
        <span class="n">SENSEAIR_CO2</span><span class="p">,</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">senseair_init</span><span class="p">(</span><span class="kt">int</span> <span class="n">uartno</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">senseair_read</span><span class="p">(</span><span class="k">enum</span> <span class="n">senseair_read_type</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* _SENSEAIR_H_ */</span><span class="cp"></span>
</pre></div>
</div>
<p>As you can see, logical UART number has been added to the init routine.
A ‘read’ function has been added, which is a blocking read. If you were
making a commercial product, you would probably have a callback for
reporting the results.</p>
<p>And here is the source for the driver.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="cm"> * or more contributor license agreements.  See the NOTICE file</span>
<span class="cm"> * distributed with this work for additional information</span>
<span class="cm"> * regarding copyright ownership.  The ASF licenses this file</span>
<span class="cm"> * to you under the Apache License, Version 2.0 (the</span>
<span class="cm"> * &quot;License&quot;); you may not use this file except in compliance</span>
<span class="cm"> * with the License.  You may obtain a copy of the License at</span>
<span class="cm"> *</span>
<span class="cm"> *  http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="cm"> *</span>
<span class="cm"> * Unless required by applicable law or agreed to in writing,</span>
<span class="cm"> * software distributed under the License is distributed on an</span>
<span class="cm"> * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="cm"> * KIND, either express or implied.  See the License for the</span>
<span class="cm"> * specific language governing permissions and limitations</span>
<span class="cm"> * under the License.</span>
<span class="cm"> */</span>
<span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&lt;shell/shell.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;console/console.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;os/os.h&gt;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&lt;hal/hal_uart.h&gt;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&quot;senseair/senseair.h&quot;</span><span class="cp"></span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">uint8_t</span> <span class="n">cmd_read_co2</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mh">0xFE</span><span class="p">,</span> <span class="mi">0</span><span class="n">X44</span><span class="p">,</span> <span class="mi">0</span><span class="n">X00</span><span class="p">,</span> <span class="mi">0</span><span class="n">X08</span><span class="p">,</span> <span class="mi">0</span><span class="n">X02</span><span class="p">,</span> <span class="mi">0</span><span class="n">X9F</span><span class="p">,</span> <span class="mi">0</span><span class="n">X25</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">senseair_shell_func</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">);</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">shell_cmd</span> <span class="n">senseair_cmd</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">.</span><span class="n">sc_cmd</span> <span class="o">=</span> <span class="s">&quot;senseair&quot;</span><span class="p">,</span>
    <span class="p">.</span><span class="n">sc_cmd_func</span> <span class="o">=</span> <span class="n">senseair_shell_func</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">senseair</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">uart</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">os_sem</span> <span class="n">sema</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">uint8_t</span> <span class="o">*</span><span class="n">tx_data</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">tx_off</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">tx_len</span><span class="p">;</span>
    <span class="kt">uint8_t</span> <span class="n">rx_data</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">rx_off</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">value</span><span class="p">;</span>
<span class="p">}</span> <span class="n">senseair</span><span class="p">;</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">senseair_tx_char</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">senseair</span> <span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">senseair</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">rc</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">tx_off</span> <span class="o">&gt;=</span> <span class="n">s</span><span class="o">-&gt;</span><span class="n">tx_len</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/*</span>
<span class="cm">         * Command tx finished.</span>
<span class="cm">         */</span>
        <span class="n">s</span><span class="o">-&gt;</span><span class="n">tx_data</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">rc</span> <span class="o">=</span> <span class="n">s</span><span class="o">-&gt;</span><span class="n">tx_data</span><span class="p">[</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">tx_off</span><span class="p">];</span>
    <span class="n">s</span><span class="o">-&gt;</span><span class="n">tx_off</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">rc</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * CRC for modbus over serial port.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">uint16_t</span> <span class="n">mb_crc_tbl</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mh">0x0000</span><span class="p">,</span> <span class="mh">0xcc01</span><span class="p">,</span> <span class="mh">0xd801</span><span class="p">,</span> <span class="mh">0x1400</span><span class="p">,</span> <span class="mh">0xf001</span><span class="p">,</span> <span class="mh">0x3c00</span><span class="p">,</span> <span class="mh">0x2800</span><span class="p">,</span> <span class="mh">0xe401</span><span class="p">,</span>
    <span class="mh">0xa001</span><span class="p">,</span> <span class="mh">0x6c00</span><span class="p">,</span> <span class="mh">0x7800</span><span class="p">,</span> <span class="mh">0xb401</span><span class="p">,</span> <span class="mh">0x5000</span><span class="p">,</span> <span class="mh">0x9c01</span><span class="p">,</span> <span class="mh">0x8801</span><span class="p">,</span> <span class="mh">0x4400</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">uint16_t</span>
<span class="nf">mb_crc</span><span class="p">(</span><span class="k">const</span> <span class="kt">uint8_t</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">,</span> <span class="kt">uint16_t</span> <span class="n">crc</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">len</span><span class="o">--</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">crc</span> <span class="o">^=</span> <span class="o">*</span><span class="n">data</span><span class="o">++</span><span class="p">;</span>
        <span class="n">crc</span> <span class="o">=</span> <span class="p">(</span><span class="n">crc</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">^</span> <span class="n">mb_crc_tbl</span><span class="p">[</span><span class="n">crc</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">];</span>
        <span class="n">crc</span> <span class="o">=</span> <span class="p">(</span><span class="n">crc</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">^</span> <span class="n">mb_crc_tbl</span><span class="p">[</span><span class="n">crc</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">crc</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">mb_crc_check</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">pkt</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">uint16_t</span> <span class="n">crc</span><span class="p">,</span> <span class="n">cmp</span><span class="p">;</span>
    <span class="kt">uint8_t</span> <span class="o">*</span><span class="n">bp</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint8_t</span> <span class="o">*</span><span class="p">)</span><span class="n">pkt</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">crc</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">crc</span> <span class="o">=</span> <span class="n">mb_crc</span><span class="p">(</span><span class="n">pkt</span><span class="p">,</span> <span class="n">len</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="mh">0xffff</span><span class="p">);</span>
    <span class="n">cmp</span> <span class="o">=</span> <span class="n">bp</span><span class="p">[</span><span class="n">len</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="o">|</span> <span class="p">(</span><span class="n">bp</span><span class="p">[</span><span class="n">len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">crc</span> <span class="o">!=</span> <span class="n">cmp</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">senseair_rx_char</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">senseair</span> <span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">senseair</span> <span class="o">*</span><span class="p">)</span><span class="n">arg</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">rc</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">rx_off</span> <span class="o">&gt;=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">rx_data</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">s</span><span class="o">-&gt;</span><span class="n">rx_off</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">s</span><span class="o">-&gt;</span><span class="n">rx_data</span><span class="p">[</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">rx_off</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">;</span>
    <span class="n">s</span><span class="o">-&gt;</span><span class="n">rx_off</span><span class="o">++</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">rx_off</span> <span class="o">==</span> <span class="mi">7</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="n">mb_crc_check</span><span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">rx_data</span><span class="p">,</span> <span class="n">s</span><span class="o">-&gt;</span><span class="n">rx_off</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">s</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">s</span><span class="o">-&gt;</span><span class="n">rx_data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="mi">256</span> <span class="o">+</span> <span class="n">s</span><span class="o">-&gt;</span><span class="n">rx_data</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
            <span class="n">os_sem_release</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">sema</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="nf">senseair_tx</span><span class="p">(</span><span class="k">struct</span> <span class="n">senseair</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="k">const</span> <span class="kt">uint8_t</span> <span class="o">*</span><span class="n">tx_data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">data_len</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">s</span><span class="o">-&gt;</span><span class="n">tx_data</span> <span class="o">=</span> <span class="n">tx_data</span><span class="p">;</span>
    <span class="n">s</span><span class="o">-&gt;</span><span class="n">tx_len</span> <span class="o">=</span> <span class="n">data_len</span><span class="p">;</span>
    <span class="n">s</span><span class="o">-&gt;</span><span class="n">tx_off</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">s</span><span class="o">-&gt;</span><span class="n">rx_off</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="n">hal_uart_start_tx</span><span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">uart</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span>
<span class="nf">senseair_read</span><span class="p">(</span><span class="k">enum</span> <span class="n">senseair_read_type</span> <span class="n">type</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">senseair</span> <span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">senseair</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">uint8_t</span> <span class="o">*</span><span class="n">cmd</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">cmd_len</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">rc</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">tx_data</span><span class="p">)</span> <span class="p">{</span>
        <span class="cm">/*</span>
<span class="cm">         * busy</span>
<span class="cm">         */</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nl">SENSEAIR_CO2</span><span class="p">:</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">cmd_read_co2</span><span class="p">;</span>
        <span class="n">cmd_len</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">cmd_read_co2</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">default</span><span class="o">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">senseair_tx</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">cmd_len</span><span class="p">);</span>
    <span class="n">rc</span> <span class="o">=</span> <span class="n">os_sem_pend</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">sema</span><span class="p">,</span> <span class="n">OS_TICKS_PER_SEC</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">==</span> <span class="n">OS_TIMEOUT</span><span class="p">)</span> <span class="p">{</span>
        <span class="cm">/*</span>
<span class="cm">         * timeout</span>
<span class="cm">         */</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">s</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">senseair_shell_func</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">value</span><span class="p">;</span>
    <span class="k">enum</span> <span class="n">senseair_read_type</span> <span class="n">type</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
<span class="nl">usage</span><span class="p">:</span>
        <span class="n">console_printf</span><span class="p">(</span><span class="s">&quot;%s co2</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&quot;co2&quot;</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">type</span> <span class="o">=</span> <span class="n">SENSEAIR_CO2</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">goto</span> <span class="n">usage</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">senseair_read</span><span class="p">(</span><span class="n">type</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">console_printf</span><span class="p">(</span><span class="s">&quot;Got %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">console_printf</span><span class="p">(</span><span class="s">&quot;Error while reading: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span>
<span class="nf">senseair_init</span><span class="p">(</span><span class="kt">int</span> <span class="n">uartno</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">rc</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">senseair</span> <span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">senseair</span><span class="p">;</span>

    <span class="n">rc</span> <span class="o">=</span> <span class="n">shell_cmd_register</span><span class="p">(</span><span class="o">&amp;</span><span class="n">senseair_cmd</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">rc</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">rc</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">rc</span> <span class="o">=</span> <span class="n">os_sem_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">sema</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">rc</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">rc</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">rc</span> <span class="o">=</span> <span class="n">hal_uart_init_cbs</span><span class="p">(</span><span class="n">uartno</span><span class="p">,</span> <span class="n">senseair_tx_char</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
      <span class="n">senseair_rx_char</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">senseair</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">rc</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">rc</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">rc</span> <span class="o">=</span> <span class="n">hal_uart_config</span><span class="p">(</span><span class="n">uartno</span><span class="p">,</span> <span class="mi">9600</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">HAL_UART_PARITY_NONE</span><span class="p">,</span>
      <span class="n">HAL_UART_FLOW_CTL_NONE</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">rc</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">rc</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">s</span><span class="o">-&gt;</span><span class="n">uart</span> <span class="o">=</span> <span class="n">uartno</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>And your modified main() for senseair driver init.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span>
<span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="p">....</span>
    <span class="n">senseair_init</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">....</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>You can see from the code that you are using the HAL interface to open a
UART port, and using OS semaphore as a way of blocking the task when
waiting for read response to come back from the sensor.</p>
<p>Now comes the fun part: Hooking up the sensor! It’s fun because a)
hooking up a sensor is always fun and b) the SenseAir sensor’s PCB is
entirely unlabeled, so you’ll have to trust us on how to hook it up.</p>
<p>So here we go.</p>
<p>You’ll have to do a little soldering. I soldered some header pins to the
SenseAir K30 board to make connecting wires easier using standard jumper
wires, but you can also just solder wires straight to the board if you
prefer.</p>
<p>Here’s what your SenseAir board should look like once it’s wired up:</p>
<div class="figure" id="id1">
<img alt="SenseAir Wiring" src="../../_images/Senseair1.png" />
<p class="caption"><span class="caption-text">SenseAir Wiring</span></p>
</div>
<p>Now that you have that wired up, let’s get the Arduino Primo wired up. A
couple of things to note:</p>
<ul class="simple">
<li>The Arduino Primo’s ‘console’ UART is actually UART1.</li>
<li>The secondary (bit-banged) UART is UART0, so that’s where we’ll have
to hook up the SenseAir.</li>
</ul>
<p>Here’s what your Arduino Primo should now look like with everything
wired in:</p>
<div class="figure" id="id2">
<img alt="SenseAir and Arduino Primo Wiring" src="../../_images/Senseair2.png" />
<p class="caption"><span class="caption-text">SenseAir and Arduino Primo Wiring</span></p>
</div>
<p>Everything is wired and you’re ready to go! Build and load your new app:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> newt build air_q
<span class="go">Building target targets/air_q</span>
<span class="go">Compiling apps/air_quality/src/main.c</span>
<span class="go">Archiving apps_air_quality.a</span>
<span class="go">Linking myproj/bin/targets/air_q/app/apps/air_quality/air_quality.elf</span>
<span class="go">Target successfully built: targets/air_q</span>
<span class="gp">$</span> newt create-image air_q <span class="m">1</span>.0.0
<span class="go">App image succesfully generated: myproj/bin/targets/air_q/app/apps/air_quality/air_quality.img</span>
<span class="gp">$</span> newt load air_q
<span class="go">Loading app image into slot 1</span>
</pre></div>
</div>
<p>Now, you should be able to connect to your serial port and read values:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">user@IsMyLaptop:~]$</span> minicom -D /dev/tty.usbserial-AH02MIE2


<span class="go">    Welcome to minicom 2.7</span>

<span class="go">    OPTIONS:</span>
<span class="go">    Compiled on Oct 12 2015, 07:48:30.</span>
<span class="go">    Port /dev/tty.usbserial-AH02MIE2, 13:44:40</span>

<span class="go">    Press CTRL-X Z for help on special keys</span>

<span class="go">    1185: &gt; ?</span>
<span class="go">    Commands:</span>
<span class="go">    1382:     stat      echo         ?    prompt     ticks     tasks</span>
<span class="go">    1390: mempools      date  senseair</span>
<span class="go">    1395: &gt; senseair</span>
<span class="go">    senseair co2</span>
<span class="go">    2143: &gt; senseair co2</span>
<span class="go">    Got 973</span>
</pre></div>
</div>
<p>And you’re getting valid readings! Congratulations!</p>
<p>Next we’ll hook this all up via Bluetooth so that you can read those
values remotely.</p>
</div>
</div>


                   </div>
                  </div>
                  
    <div class="rst-footer-buttons row" role="navigation" aria-label="footer navigation">
      
        <a href="air_quality_ble.html" class="btn btn-neutral float-right" title="Air quality sensor project via Bluetooth" accesskey="n">Next: Air quality sensor project via Bluetooth <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="air_quality.html" class="btn btn-neutral" title="Air Quality Sensor Project" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous: Air Quality Sensor Project</a>
      
    </div>

                </div>
              </div>
            </div>
            <!-- ENDS CONTENT SECTION -->
          </div>
          <!-- ENDS .content -->
        </div>
      </div>
      <footer>
  <div class="container">
    <div class="row">
      <div class="col-xs-12">
          
              <p class="copyright">Apache Mynewt is available under Apache License, version 2.0.</p>
          
      </div>
      <div class="col-xs-12">
          <div class="logos">
              <img src="../../_static/img/asf_logo_wide_small.png" alt="Apache" title="Apache">
              <small class="footnote">
                Apache Mynewt, Mynewt, Apache, the Apache feather logo, and the Apache Mynewt project logo are either
                registered trademarks or trademarks of the Apache Software Foundation in the United States and other countries.
              </small>
              <a href="https://join.slack.com/mynewt/shared_invite/MTkwMTg1ODM1NTg5LTE0OTYxNzQ4NzQtZTU1YmNhYjhkMg">
                <img src="../../_static/img/add_to_slack.png" alt="Slack Icon" title="Join our Slack Community" />
              </a>
          </div>
      </div>
    </div>
  </div>
</footer>
    </div>
    <!-- ENDS #wrapper -->

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.3.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/js/bootstrap-3.0.3.min.js"></script>
      <script type="text/javascript" src="../../_static/js/affix.js"></script>
      <script type="text/javascript" src="../../_static/js/main.js"></script>

   

  </body>
</html>